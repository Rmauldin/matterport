!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,(function(){return function(){"use strict";var e={331:function(e,t){var n,o,r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.RequestQueue=t.RequestStatus=t.RequestPriority=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(n=t.RequestPriority||(t.RequestPriority={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(o=t.RequestStatus||(t.RequestStatus={}));var i=function(){function e(e){var t=void 0===e?{}:e,n=t.retries,o=void 0===n?3:n,r=t.concurrency,i=void 0===r?6:r;this.totalBytesDownloaded=0,this.queue=[],this.retries=o,this.concurrency=i}return e.prototype.get=function(e,t){return this.request("GET",e,t)},e.prototype.head=function(e,t){return this.request("HEAD",e,t)},e.prototype.options=function(e,t){return this.request("OPTIONS",e,t)},e.prototype.post=function(e,t){return this.request("POST",e,t)},e.prototype.put=function(e,t){return this.request("PUT",e,t)},e.prototype.patch=function(e,t){return this.request("PATCH",e,t)},e.prototype.delete=function(e,t){return this.request("DELETE",e,t)},e.prototype.request=function(e,t,n){var o=new a(e,t,n);return this.enqueue(o),o.promise},e.prototype.update=function(){for(var e;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=o.PENDING;this.updateTimeout=null},e.prototype.enqueue=function(e){var t=this,n=0;for(n=0;n<this.queue.length&&!(this.queue[n].priority<e.priority);n++);this.queue.splice(n,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((function(){t.update()}),1))},e.prototype.dequeue=function(e){var t=this.queue.indexOf(e);if(-1===t)throw new Error("Can't dequeue request not in queue");this.queue.splice(t,1),this.update()},e.prototype.getNextPendingRequest=function(){for(var e=0;e<this.queue.length&&e<this.concurrency;e++){var t=this.queue[e];if(t.status===o.PENDING)return t}return null},e.prototype.getNextOverflowingGet=function(){for(var e=this.concurrency;e<this.queue.length;e++){var t=this.queue[e];if(t.status===o.SENDING&&t.priority!==n.HIGHEST&&"GET"===t.method)return t}return null},e.prototype.shouldRetryStatusCode=function(t){return!e.doNotRetryStatusCodes[t]},e.prototype.sendRequest=function(e){var t=this;e.status=o.SENDING,e.send().then((function(n){e.status=o.DONE,t.dequeue(e),e.contentLength&&e.contentLength>0&&(t.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(n)})).catch((function(n){var r=null!==e.maxRetries?e.maxRetries:t.retries,i=e.sendAttempts<r;if("object"==typeof n){var a=n.status_code||0;i=i&&t.shouldRetryStatusCode(a)}i?(e.status=o.PENDING,t.update(),console.warn("Retried "+e.url),console.warn(n)):(e.status=o.FAILED,t.dequeue(e),console.warn("Failed "+e.url),e.onFail(n))}))},e.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0},e}();t.RequestQueue=i;var a=function(){function e(e,t,r){var i=this;void 0===r&&(r={}),this.sendAttempts=0,this.status=o.PENDING,this.contentLength=0,this.url=t,this.method=e,this.auth=r.auth||null,this.withCredentials=r.withCredentials||!1,this.priority=r.priority||n.MEDIUM,this.responseType=r.responseType||null,this.body=r.body||null,this.headers=r.headers||{},this.maxRetries=r.maxRetries||null,this.onProgress=r.onProgress,this.promise=new Promise((function(e,t){i.onDone=e,i.onFail=t}))}return e.prototype.send=function(){var e=this,t=this.xhr=function(e,t,n){var o;if("undefined"!=typeof XMLHttpRequest)(o=new XMLHttpRequest).withCredentials=n;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");o=new XDomainRequest}return o.open(e,t,!0),o}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)t.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');t.responseType="blob"}for(var n in"json"===this.responseType&&t.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&t.setRequestHeader("Authorization",this.auth),this.headers)t.setRequestHeader(n,this.headers[n]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),t.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(t.onprogress=this.onProgress),new Promise((function(n,o){t.onreadystatechange=function(i){if(4===t.readyState){if(200===t.status||201===t.status||204===t.status)return e.parseResponse(e.xhr).then((function(e){n(e)}));if(0!==t.status)return e.parseResponse(e.xhr).then((function(e){o(r({status_code:t.status},e))})).catch((function(){o({status_code:t.status})}))}},t.onerror=function(e){o(e)},t.send(e.body),e.sendAttempts++}))},e.prototype.parseResponse=function(e){var t=this;return new Promise((function(n,o){try{var r=e.response;if(t.contentLength=e.getResponseHeader("Content-Length"),"json"===t.responseType&&"object"!=typeof r)n(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==t.responseType)n(r);else{var i=URL.createObjectURL(r);(r=new Image).src=i,r.crossOrigin="Anonymous",r.onload=function(){URL.revokeObjectURL(i),n(r)}}}catch(e){o({error:"Payload was not valid JSON"})}}))},e.prototype.abort=function(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.xhr.abort()},e}();t.Request=a}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return function(){var e,t,r,i,a,s,c;n.r(o),n.d(o,{IdOption:function(){return i},setup:function(){return Io}}),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(e||(e={}));class d{constructor(t){this.directionMap={[e.FORWARD]:t.FORWARD.clone(),[e.LEFT]:t.LEFT.clone(),[e.RIGHT]:t.RIGHT.clone(),[e.BACK]:t.BACK.clone(),[e.UP]:t.UP.clone(),[e.DOWN]:t.DOWN.clone()}}toVector(e){return this.directionMap[e]}}!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t||(t={}));class u{constructor(e){this.CwfViewmode=e}toSdk(e,n){switch(e){case this.CwfViewmode.Panorama:return n?t.INSIDE:t.OUTSIDE;case this.CwfViewmode.Dollhouse:return t.DOLLHOUSE;case this.CwfViewmode.Floorplan:return t.FLOORPLAN;case this.CwfViewmode.Transition:return t.TRANSITIONING;case this.CwfViewmode.Outdoor:return t.OUTSIDE;default:return t.INSIDE}}fromSdk(e){switch(e){case t.INSIDE:case t.OUTSIDE:return this.CwfViewmode.Panorama;case t.DOLLHOUSE:return this.CwfViewmode.Dollhouse;case t.FLOORPLAN:return this.CwfViewmode.Floorplan;case t.TRANSITIONING:return this.CwfViewmode.Transition}}}class h{constructor(e){this.CommandMode=e}toSdk(e,n){switch(e){case this.CommandMode.INSIDE:return n?t.INSIDE:t.OUTSIDE;case this.CommandMode.DOLLHOUSE:return t.DOLLHOUSE;case this.CommandMode.FLOORPLAN:return t.FLOORPLAN;case this.CommandMode.TRANSITIONING:return t.TRANSITIONING;case this.CommandMode.OUTSIDE:return t.OUTSIDE;default:return t.INSIDE}}fromSdk(e){switch(e){case t.INSIDE:return this.CommandMode.INSIDE;case t.OUTSIDE:return this.CommandMode.OUTSIDE;case t.DOLLHOUSE:return this.CommandMode.DOLLHOUSE;case t.FLOORPLAN:return this.CommandMode.FLOORPLAN;case t.TRANSITIONING:return this.CommandMode.TRANSITIONING}}}!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(r||(r={}));class p{constructor(e){this.toSdkTransitionMap={[e.Interpolate]:r.FLY,[e.FadeToBlack]:r.FADEOUT,[e.Instant]:r.INSTANT},this.fromSdkTransitionMap={[r.FLY]:e.Interpolate,[r.FADEOUT]:e.FadeToBlack,[r.INSTANT]:e.Instant}}toSdkTransition(e){return this.toSdkTransitionMap[e]}fromSdkTransition(e){return this.fromSdkTransitionMap[e]}}class l{constructor(e){this.THREE=e,this.tempEuler=new e.Euler}quaternionToRotation(e,t){const n=this.tempEuler.setFromQuaternion(e,l.eulerOrder),o=t||{};return o.x=this.THREE.MathUtils.radToDeg(n.x),o.y=this.THREE.MathUtils.radToDeg(n.y),o.z=this.THREE.MathUtils.radToDeg(n.z),o}rotationToQuaternion(e,t){const n=t||new this.THREE.Quaternion;return this.tempEuler.x=this.THREE.MathUtils.degToRad(e.x),this.tempEuler.y=this.THREE.MathUtils.degToRad(e.y),this.tempEuler.z=this.THREE.MathUtils.degToRad(e.z||0),this.tempEuler.order=l.eulerOrder,n.setFromEuler(this.tempEuler)}}l.eulerOrder="YXZ";class m{constructor(e){this.CwfSweepAlignmentType=e}isSweepAligned(e,t){if(!e||!t)return!1;const n=t&&e.getSweep(t);return!!n&&n.alignmentType===this.CwfSweepAlignmentType.ALIGNED}isCurrentSweepAligned(e){return this.isSweepAligned(e,e.currentSweep)}}!function(e){e.LEGACY="legacy",e.API="api"}(i||(i={}));class f{constructor(e){this.sweepData=e}getIdForSweep(e){return e.uuid}getSweepForId(e){return this.sweepData.getSweepByUuid(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class w{constructor(e){this.sweepData=e}getIdForSweep(e){return e.id}getSweepForId(e){return this.sweepData.getSweep(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class g{constructor(e){this.floorData=e}getIdForFloor(e){return String(e.index)}getFloorForId(e){return this.floorData.getFloorAtIndex(parseInt(e,10))}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class v{constructor(e){this.floorData=e}getIdForFloor(e){return e.id}getFloorForId(e){return this.floorData.getFloor(e)}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class y{constructor(e){this.roomData=e}getIdForRoom(e){return String(e.meshSubgroup)}getRoomForId(e){return this.roomData.getBySubgroup(parseInt(e,10))}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}class T{constructor(e){this.roomData=e}getIdForRoom(e){return e.id}getRoomForId(e){return this.roomData.get(e)}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}!function(e){e.PHASE_CHANGE="application.phasechange",e.APP_CHANGE="application.appchange"}(a||(a={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(s||(s={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(c||(c={}));class I{constructor(e){this.toSdkPhaseMap={[e.UNINITIALIZED]:c.UNINITIALIZED,[e.WAITING]:c.WAITING,[e.LOADING]:c.LOADING,[e.STARTING]:c.STARTING,[e.PLAYING]:c.PLAYING,[e.ERROR]:c.ERROR},this.fromSdkPhaseMap={[c.UNINITIALIZED]:e.UNINITIALIZED,[c.WAITING]:e.WAITING,[c.LOADING]:e.LOADING,[c.STARTING]:e.STARTING,[c.PLAYING]:e.PLAYING,[c.ERROR]:e.ERROR}}toSdkAppPhase(e){return this.toSdkPhaseMap[e]}fromSdkAppPhase(e){return this.fromSdkPhaseMap[e]}}class E{constructor(e){this.toSdkApplicationMap={[e.SHOWCASE]:s.SHOWCASE,[e.WORKSHOP]:s.WORKSHOP,[e.WEBVR]:s.WEBVR,[e.UNKNOWN]:s.UNKNOWN},this.fromSdkApplicationMap={[s.SHOWCASE]:e.SHOWCASE,[s.WORKSHOP]:e.WORKSHOP,[s.WEBVR]:e.WEBVR,[s.UNKNOWN]:e.UNKNOWN}}toSdkApplication(e){return this.toSdkApplicationMap[e]}fromSdkApplication(e){return this.fromSdkApplicationMap[e]}}class C{constructor(e,t,n){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=n.create(),this.freshDataCache=n.create()}static create(e,t,n){return o=this,r=void 0,a=function*(){const o=yield e.getDependencies();return new C(o,t,n)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class t{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}this.observers.add(e),1===this.observers.size&&(this.currentData.update(...this.dependencies),this.changeSubscription=this.subscriptionFactory.create(new t(this),...this.dependencies)),e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&this.changeSubscription.cancel())}onChanged(){if(this.freshDataCache.update(...this.dependencies),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}class S{constructor(e,...t){this.ctor=e,this.args=t}create(){return new this.ctor(...this.args)}}const b=(e,t=[])=>{if(void 0!==e){if(e in t)return{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if("object"==typeof e){const o=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const r in e){if("propertyObservers"===(n=r)||"changeObservers"===n||"isObservable"===n||"childChangeFunctions"===n||"isObservableProxy"===n||"diffRoot"===n||"elementChangedHandlers"===n||"knownKeysMap"===n||"knownKeysList"===n||"isVector2"===n||"isVector3"===n||"isQuaternion"===n||"onPropertyChanged"===n||"removeOnPropertyChanged"===n||"onChanged"===n||"target"===n)continue;const i=e[r];i instanceof Date?o[r]=new Date(i):"function"!=typeof i&&(o[r]="object"==typeof i?b(i,t.concat(e)):i)}return o}return e}var n},x=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const n in t)if(!(n in e))return!0;for(const n in e)if(x(e[n],t[n]))return!0;return!1};class N{create(e,t){return t.onChanged((()=>e.onChanged()))}}class A{constructor(e,t){this._data={phase:c.UNINITIALIZED,phaseTimes:{},application:s.SHOWCASE},this.AppPhase=e.AppPhase,this.appPhaseConverter=t.appPhaseConverter,this.applicationConverter=t.applicationConverter}get data(){return this._data}equals(e){return!x(this,e)}copy(e){this._data.phase=e.data.phase,function(e,t,...n){for(const o of n)e[o]=t[o]}(this.data.phaseTimes,e.data.phaseTimes),this._data.application=e.data.application}update(e){this._data.phase=this.appPhaseConverter.toSdkAppPhase(e.phase),this._data.application=this.applicationConverter.toSdkApplication(e.application),this._data.phaseTimes[c.WAITING]=e.phaseTimes[this.AppPhase.WAITING],this._data.phaseTimes[c.LOADING]=e.phaseTimes[this.AppPhase.LOADING],this._data.phaseTimes[c.PLAYING]=e.phaseTimes[this.AppPhase.PLAYING],this._data.phaseTimes[c.STARTING]=e.phaseTimes[this.AppPhase.STARTING],this._data.phaseTimes[c.UNINITIALIZED]=e.phaseTimes[this.AppPhase.UNINITIALIZED],this._data.phaseTimes[c.ERROR]=e.phaseTimes[this.AppPhase.ERROR]}}class O{}class P extends O{constructor(){super(),this.id="GET_APP_STATE"}}class D extends O{constructor(){super(),this.id="GET_APP_PHASE_TIMES"}}class R extends O{constructor(){super(),this.id="GET_POSE"}}const M=40*Math.PI/180/1e3;class _ extends O{constructor(e){super(),this.payload=e}}var F;!function(e){e.MOVE="camera.move"}(F||(F={}));const L=window.navigationStart||Date.now();var k;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(k||(k={}));class G{constructor(e){this.timers={},this.handlers={[k.DEBUG]:console.debug,[k.INFO]:console.info,[k.WARN]:console.warn,[k.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){return G.level>=e&&console?(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix()):()=>{}}get debug(){return this.message(k.DEBUG)}get debugWarn(){return this.message(G.level>=k.DEBUG?k.WARN:__PRODUCTION__?k.DEBUG:k.INFO)}get info(){return this.message(k.INFO)}get warn(){return this.message(k.WARN)}get error(){return this.message(k.ERROR)}time(e){G.level>=k.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(G.level>=k.DEBUG){const t=this.timers[e];if(!t)return;const n=(Date.now()-t)/1e3;this.debug(e,n+"s")}}getPrefix(){const e=(Date.now()-L)/1e3+"s";return`${this.prefix} ${e}`}}G.level=k.INFO;const V=new G("broadcast.move");function z(e,t){return Object.values(e).includes(t)}class U extends O{constructor(e){super(),this.id="MOVE_DIRECTION",this.payload=e}}class q extends O{constructor(e){super(),this.id="PAN",this.payload={x:e.x,z:e.z}}}class B{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}function H(e,t){e.x=t.x,e.y=t.y}function j(e,t){H(e,t),e.z=t.z}class W extends Error{constructor(e){super(e),this.name="BaseException",Object.setPrototypeOf(this,new.target.prototype)}}class $ extends W{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}const K=(e,t,n=1e-5)=>Math.abs(e-t)<=n,Y=(e,t,n=1e-5)=>K(e.x,t.x,n)&&K(e.y,t.y,n),X=(e,t,n=1e-5)=>Y(e,t,n)&&K(e.z,t.z,n);class Z{create(e,t,n,o){const r=()=>e.onChanged();return new B(t.onChanged(r),n.onChanged(r),o.onChanged(r))}}class Q{constructor(e,n){this._data={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:t.TRANSITIONING},this.THREE=e,this.viewmodeConverter=n,this.tempEuler=new e.Euler}get data(){return this._data}equals(e){const t=1e-5;return X(e._data.position,this._data.position,t)&&Y(e._data.rotation,this._data.rotation,t)&&((e,t,n=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,o)=>!K(e,t[o],n))))(e._data.projection,this._data.projection,t)&&e._data.sweep===this._data.sweep&&e._data.mode===this._data.mode}update(e,t,n,o){const r=this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ"),i=t.currentSweep&&t.isSweepUnaligned(t.currentSweep);j(this._data.position,e.pose.position),this._data.rotation.x=this.THREE.MathUtils.radToDeg(r.x),this._data.rotation.y=this.THREE.MathUtils.radToDeg(r.y),this._data.projection=Float32Array.from(e.pose.projection.asThreeMatrix4().transpose().elements),this._data.sweep=t.currentSweepObject?o.getIdForSweep(t.currentSweepObject):"",this._data.mode=this.viewmodeConverter.toSdk(n.currentMode,!i)}copy(e){j(this._data.position,e.data.position),H(this._data.rotation,e.data.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new $;const n=t.length;for(let o=0;o<n;++o)e[o]=t[o]}(this._data.projection,e.data.projection),this._data.sweep=e.data.sweep,this._data.mode=e.data.mode}}class J extends O{constructor(e){super(),this.id="ROTATE",this.payload={xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,rotationSpeed:e.rotationSpeed}}}function ee(e,t,n){const o=new e.Euler,r=new e.Euler;return function(e,i,a,s){return c=this,d=void 0,h=function*(){if(a.currentMode!==t.Panorama)throw Error("Camera.setRotation is only available in Panorama mode");const c=s.xAngle%(.5*Math.PI),d=s.yAngle%(2*Math.PI),u=e.pose.rotation;o.setFromQuaternion(u,"YXZ");let h=d-o.y;return Math.abs(h)>Math.PI&&(h-=2*Math.sign(h)*Math.PI),r.set(c-o.x,h,0,"YXZ"),r.y%=2*Math.PI,n(i,{xAngle:-r.y,yAngle:r.x,zAngle:0,rotationSpeed:s.rotationSpeed})},new((u=void 0)||(u=Promise))((function(e,t){function n(e){try{r(h.next(e))}catch(e){t(e)}}function o(e){try{r(h.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof u?r:new u((function(e){e(r)}))).then(n,o)}r((h=h.apply(c,d||[])).next())}));var c,d,u,h}}class te extends J{}var ne=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};const oe=new G("sdk command");class re{constructor(e,t){this.dependencies=e,this.executor=t.create()}static create(e,t){return n=this,o=void 0,i=function*(){const n=yield e.getDependencies();return new re(n,t)},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{c(i.next(e))}catch(e){t(e)}}function s(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i}exec(e,t){const n=this.executor.validateInput(e,...this.dependencies);this.executor.exec(n,t,...this.dependencies)}}class ie{constructor(e,t){this.deprecationWarning=t,this.executor=e.create()}validateInput(e,...t){return oe.warn(this.deprecationWarning),this.executor.validateInput(e,...t)}exec(e,t,...n){this.executor.exec(e,t,...n)}}const ae=function(e,t,n){return Math.max(t,Math.min(e,n))};function se(e,t,n){return t<=e&&e<=n}var ce=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};const de=new G("command.zoom");class ue{constructor(e,t){this.Viewmode=e.Viewmode,this.ZoomSetCommand=e.ZoomSetCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomPct-0;if(isNaN(t))throw Error(t+" is not a valid zoom level");return t<.7&&3<t&&(e.zoomPct=ae(t,.7,3),de.warn(t,"is outside the valid zoom range of [0.7, 3]")),e}exec(e,t,n,o){return ce(this,void 0,void 0,(function*(){le(this.Viewmode,o.currentMode),yield this.issueCommand(new this.ZoomSetCommand(e.zoomPct)),t.return(n.zoom())}))}}class he{constructor(e,t){this.Viewmode=e.Viewmode,this.ZoomInCommand=e.ZoomInCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomDelta-0;if(isNaN(t))throw Error(t+" is not a valid zoom delta");return e.zoomDelta=t||0,e}exec(e,t,n,o){return ce(this,void 0,void 0,(function*(){le(this.Viewmode,o.currentMode),yield this.issueCommand(new this.ZoomInCommand(e.zoomDelta)),t.return(n.zoom())}))}}class pe{constructor(e,t){this.Viewmode=e.Viewmode,this.ZoomResetCommand=e.ZoomResetCommand,this.issueCommand=t.issueCommand}validateInput(e){return e}exec(e,t,n,o){return ce(this,void 0,void 0,(function*(){le(this.Viewmode,o.currentMode),yield this.issueCommand(new this.ZoomResetCommand),t.return()}))}}function le(e,t){if(t!==e.Panorama)throw Error("Zoom controls are currently only supported in Panorama mode")}class me{create(e,t){return t.onChanged((()=>e.onChanged()))}}class fe{constructor(e){this._data={level:1},this.Viewmode=e.Viewmode}get data(){return this._data}equals(e){return this._data.level===e.data.level}copy(e){this._data.level=e.data.level}update(e,t){t.currentMode===this.Viewmode.Panorama&&(this._data.level=e.zoom())}}function we(e,t){const n=new e.Euler;return function(o,r,i,a,s){const c=n.setFromQuaternion(r.pose.rotation,"YXZ"),d=i.currentSweep&&i.isSweepUnaligned(i.currentSweep);return o.position.x=r.pose.position.x,o.position.y=r.pose.position.y,o.position.z=r.pose.position.z,o.rotation.x=e.MathUtils.radToDeg(c.x),o.rotation.y=e.MathUtils.radToDeg(c.y),o.projection=Float32Array.from(r.pose.projection.asThreeMatrix4().transpose().elements),o.sweep=i.currentSweepObject?s.getIdForSweep(i.currentSweepObject):"",o.mode=t.toSdk(a.currentMode,!d),o}}class ge{constructor(){this.wasInTransition=!1,this.currentFloor=""}create(e,t,n,o){return new B(t.makeFloorChangeSubscription((()=>this.throttleCurrentFloorChanges(e,t))),o.onChanged((()=>this.throttleCameraTranstionChanges(e,o,n))),n.onChanged((()=>this.throttleCameraTranstionChanges(e,o,n))))}throttleCameraTranstionChanges(e,t,n){const o=t.transition.active||n.transition.active;o!==this.wasInTransition&&(this.wasInTransition=o,e.onChanged())}throttleCurrentFloorChanges(e,t){const n=t.currentFloorId;n!==this.currentFloor&&(this.currentFloor=n,e.onChanged())}}class ve{constructor(e){this._data={id:void 0,sequence:void 0,name:""},this.SweepAlignmentType=e.SweepAlignmentType,this.SweepPlacementType=e.SweepPlacementType}get data(){return this._data}equals(e){const t=this.data,n=e.data;return t.id===n.id&&t.sequence===n.sequence&&t.name===n.name}copy(e){this._data.id=e.data.id,this._data.sequence=e.data.sequence,this._data.name=e.data.name}update(e,t,n,o){const r=e.currentFloor,i=t.currentSweep&&t.getSweep(t.currentSweep);n.transition.active&&!t.transitionActive||function(){if(t.transitionActive&&t.transition.to&&t.transition.from){const e=t.getSweep(t.transition.to),n=t.getSweep(t.transition.from);return e.floorId!==n.floorId}return!1}()?(this._data.id="",this._data.sequence=void 0,this._data.name=""):i&&i.alignmentType===this.SweepAlignmentType.UNALIGNED&&i.placementType===this.SweepPlacementType.UNPLACED?(this._data.id=void 0,this._data.sequence=void 0,this._data.name=""):r?(this._data.id=o.getIdFromCwfId(r.id),this._data.sequence=r.index,this._data.name=r.name):(this._data.id="",this._data.sequence=-1,this._data.name="all")}}var ye;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(ye||(ye={}));class Te{constructor(e,t,n){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=n.create(),this.freshData=n.create()}static create(e,t,n){return o=this,r=void 0,a=function*(){const o=yield e.getDependencies();return new Te(o,t,n)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}getData(){return this.currentData.data}observe(e){return this.addObserver(e),new class{constructor(e){this.sdkCollection=e,this.renew()}renew(){this.sdkCollection.addObserver(e)}cancel(){this.sdkCollection.removeObserver(e)}}(this)}addObserver(e){class t{constructor(e){this.sdkCollection=e}onChanged(){const{freshData:e,currentData:t,dependencies:n}=this.sdkCollection;e.update(...n);let o=!1;for(const n in e.data)if(t.data.hasOwnProperty(n)){if(!t.isItemEqual(e,n))for(const t of this.sdkCollection.observers)t.onUpdated(n,e.data[n]),o=!0}else for(const t of this.sdkCollection.observers)t.onAdded(n,e.data[n]),o=!0;for(const n in t.data)if(!e.data.hasOwnProperty(n))for(const e of this.sdkCollection.observers)e.onRemoved(n),o=!0;if(o)for(const e of this.sdkCollection.observers)e.onCollectionUpdated();const r=t;this.sdkCollection.currentData=this.sdkCollection.freshData,this.sdkCollection.freshData=r}}if(!this.observers.has(e))if(this.observers.add(e),1===this.observers.size){const e=new t(this);this.changeSubscription=this.subscriptionFactory.create(e,...this.dependencies),e.onChanged()}else for(const t in this.currentData.data)e.onAdded(t,this.currentData.data[t])}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&(this.changeSubscription.cancel(),this.currentData.clear()))}}class Ie{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Ee{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],o=e.data[t];return n.id===o.id&&n.name===o.name&&n.sequence===o.sequence}update(e,t){for(const n of e.getCollection()){const e=t.getIdFromCwfId(n.id),o=this._data[e]||{};o.id=e,o.sequence=n.index,o.name=n.name,this._data[e]=o}for(const e in this.data)t.getFloorForId(e)||delete this._data[e]}clear(){this._data={}}}var Ce=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};class Se extends O{constructor(){super(...arguments),this.id="GET_FLOORS_DATA"}}class be extends O{constructor(e){super(),this.id="MOVE_TO_FLOOR",this.payload=e}}class xe{constructor(e,t){this.issueCommand=t.issueCommand,this.ShowAllFloorsCommand=e.ShowAllFloorsCommand}validateInput(e){return e}exec(e,t,n){return o=this,r=void 0,a=function*(){try{yield this.issueCommand(new this.ShowAllFloorsCommand({moveCamera:!0}));const e=n.currentFloor;t.return(e?e.index:-1)}catch(e){t.throw("Could not show all floors")}},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}}var Ne,Ae,Oe,Pe,De;class Re extends O{constructor(){super(...arguments),this.id="LABEL_GET"}}function Me(e,t){return function(n,o,r,i){const a=r.getCollection(),s=[],c=new e.Vector2;for(const r of a){t(n,r.position,c);const{id:a,index:d}=o.getFloor(r.floorId),u=i.getIdFromCwfId(a),h=b(r);s.push(Object.assign(Object.assign({},h),{position:(new e.Vector3).copy(r.position),screenPosition:c,floor:d,floorInfo:{id:u,sequence:d}}))}return s}}!function(e){e.POSITION_UPDATED="label.positionupdated"}(Ne||(Ne={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(Ae||(Ae={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(Oe||(Oe={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(Pe||(Pe={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(De||(De={}));class _e{constructor(e,t){this.toSdkMediaMap={[e.PHOTO]:Oe.PHOTO,[e.VIDEO]:Oe.VIDEO,[e.RICH]:Oe.RICH},this.toSdkMediaFromChunk={[t.error]:Oe.NONE,[t.link]:Oe.NONE,[t.none]:Oe.NONE,[t.photo]:Oe.PHOTO,[t.rich]:Oe.RICH,[t.text]:Oe.NONE,[t.video]:Oe.VIDEO}}toSdkMedia(e){return this.toSdkMediaMap[e]}fromTagChunkType(e){return this.toSdkMediaFromChunk[e]}}class Fe{constructor(e){this.toSdkChunkTypeMap={[e.error]:Pe.NONE,[e.link]:Pe.LINK,[e.none]:Pe.NONE,[e.photo]:Pe.NONE,[e.rich]:Pe.NONE,[e.text]:Pe.TEXT,[e.video]:Pe.NONE}}toSdkChunkType(e){return this.toSdkChunkTypeMap[e]}}class Le{constructor(e){this.toSdkLinkTypeMap={[e.NAVIGATION]:De.NAVIGATION,[e.MODEL]:De.MODEL,[e.EXT_LINK]:De.EXT_LINK}}toSdkLinkType(e){return this.toSdkLinkTypeMap[e]}}function ke(e){return"string"==typeof e}class Ge extends W{constructor(e){super("Expected tagId parameter to be of type string; got "+(Array.isArray(e)?"Array":typeof e))}}var Ve=n(331),ze=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};const Ue=new G("sdk.editIcon");class qe extends O{constructor(e){super(),this.payload=e,this.id="REGISTER_MATTERTAG_ICON"}}class Be extends O{constructor(e){super(),this.payload=e,this.id="EDIT_MATTERTAG_ICON"}}class He extends O{constructor(e){super(),this.payload=e,this.id="RESET_MATTERTAG_ICON"}}class je{constructor(e){this.queue=e}load(e){return ze(this,void 0,void 0,(function*(){const t=yield this.queue.get(e,{responseType:"text"}),n=document.createElement("div");n.innerHTML=t;const o=n.querySelector("svg");if(!o)throw Error("Failed trying to load "+e+"as an svg.");const r=o.getAttribute("width"),i=o.getAttribute("height");return r||i?(i&&!r&&(Ue.warn(e,"does not have a defined width. Defaulting width equal to height"),o.setAttribute("width",i)),r&&!i&&(Ue.warn(e,"does not have a defined height. Defaulting height equal to width"),o.setAttribute("height",r))):(Ue.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),o.setAttribute("width",je.defaultResolution),o.setAttribute("height",je.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([o.outerHTML],{type:"image/svg+xml"}))}))}))}}function We(e){if(null==e||isNaN(e))return!1;if("number"==typeof e)return!0;const t=parseFloat(e);return!isNaN(t)&&"number"==typeof t}function $e(e){return e-0}function Ke(e){return!!e&&!!("object"==typeof e&&"x"in e&&"y"in e&&"z"in e&&We(e.x)&&We(e.y)&&We(e.z))}je.defaultResolution="128";const Ye=new G("util");function Xe(e){return!!((t=e)&&"object"==typeof t&&"r"in t&&"g"in t&&"b"in t&&We(t.r)&&We(t.g)&&We(t.b))&&(se(e.r,0,1)||Ye.warn("The color provided should have an r value be in the range of [0, 1]"),se(e.g,0,1)||Ye.warn("The color provided should have an g value be in the range of [0, 1]"),se(e.b,0,1)||Ye.warn("The color provided should have an b value be in the range of [0, 1]"),(n=e).r=ae(n.r,0,1),n.g=ae(n.g,0,1),n.b=ae(n.b,0,1),!0);var t,n}const Ze=new G("mattertag-util");function Qe(e,t,n){const o=n.roomIdsFromPoint(e);let r=1/0,i="";for(const t of o){const o=n.get(t),a=e.y-o.min.y;a<r&&(r=a,i=o.floorId)}try{return t.getFloor(i).index}catch(e){return Ze.debug("Unable to deduce floor index from position; defaulting to floor 0"),0}}class Je extends O{constructor(e){super(),this.payload=e,this.id="BATCH_ADD_MATTERTAG"}}function et(e,t,n,o,r){const i={[Oe.NONE]:n.TagDescriptionChunkType.none,[Oe.PHOTO]:n.TagDescriptionChunkType.photo,[Oe.VIDEO]:n.TagDescriptionChunkType.video,[Oe.RICH]:n.TagDescriptionChunkType.rich};function a(e,o,r){if(!Ke(e.anchorPosition))throw Error("anchorPosition is not a valid Vector3");if(!Ke(e.stemVector))throw Error("stemVector is not a valid Vector3");const a=(new t.Vector3).copy(e.anchorPosition),s=(new t.Vector3).copy(e.stemVector),c=s.length();s.normalize();let d=void 0!==e.floorIndex?e.floorIndex:e.floorId;void 0===d&&(d=Qe(a,o,r));const u=o.getFloorAtIndex(d);if(!u)throw new Error(`Could not add Mattertag on invalid floor with index: ${d}`);const h=Xe(e.color)?new t.Color(e.color.r,e.color.g,e.color.b):n.Color.MATTERTAG_BLUE,p=e.description,l=e.label,m=!e.hasOwnProperty("stemVisible")||e.stemVisible;let f;return e.media&&(f={mediaType:i[e.media.type]||n.TagDescriptionChunkType.none,mediaSrc:e.media.src||""}),new n.AddMattertagCommand({position:a,normal:s,floorId:u.id},{color:h,description:p,label:l,stemHeight:c,stemVisible:m,enabled:!0},f)}e.addCommandCreator({namespace:"Mattertag",name:"add",args:["tags"]},(e=>{const t=Array.isArray(e.tags)?e.tags:[e.tags];return new Je(t)})),o.addBinding(Je,(e=>{return t=this,n=void 0,s=function*(){const[t,n]=yield r.getDependencies(),i=function(e,t,n){const o=[],r=e,i=r.length;o.length=i;for(let e=0;e<r.length;++e)try{o[e]=a(r[e],t,n)}catch(t){throw Error(`Error in tag ${e} - ${t.message}`)}return o}(e,t,n),s=[];s.length=i.length;for(let t=0;t<i.length;++t){const n=yield o.issueCommand(i[t]);s[t]=n;const r=e[t];r.iconId&&(yield o.issueCommand(new Be({tagId:n,iconId:r.iconId})))}return s},new((i=void 0)||(i=Promise))((function(e,o){function r(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(t,n||[])).next())}));var t,n,i,s}))}class tt extends O{constructor(){super(...arguments),this.id="MATTERTAG_GET"}}function nt(e,t,n){function o(e){if(e)return{label:e.label,type:n.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const r=[];for(const n of e)r.push({type:t.toSdkChunkType(n.type),link:o(n.link),text:n.text});return r}var ot,rt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};!function(e){e.LABEL="label",e.DESCRIPTION="description",e.MEDIA="media"}(ot||(ot={}));class it extends O{constructor(e,t){super(),this.payload={tagId:e,properties:t}}}class at extends O{constructor(e,t){super(),this.payload={tagId:e,color:t}}}const st=new G("command.editOpacity");class ct{validateInput(e,t){const n=e.sid;if(!ke(n))throw new Ge(n);if(!t.getTag(n))throw Error(e.sid+" is not a valid Mattertag sid");if("number"!=typeof e.opacity||isNaN(e.opacity))throw Error(e.opacity+" is not a valid opacity value");let o=e.opacity;return(o<0||1<o)&&(st.warn(o,"is outside the valid range of [0, 1]"),o=ae(o,0,1)),{sid:n,opacity:o}}exec(e,t,n,o){o.changeDiscOpacity(e.sid,e.opacity),t.return()}}function dt(e,t,n){return(n=n||{}).x=e[t].x,n.y=e[t].y,n.z=e[t].z,n}function ut(e,t){return(t=t||{}).id=e.id,t.sequence=e.index,t}class ht{create(e,t){return t.onChanged((()=>e.onChanged()))}}class pt{constructor(e){this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!x(this.data[t],e.data[t])}update(e,t,n){for(const i of e.getTagList()){const a=e.getTag(i),s=t.getFloor(a.floorId),c=this.data[a.sid]||{};c.sid=a.sid,c.enabled=a.enabled,c.anchorPosition=dt(a,"anchorPosition",c.anchorPosition),c.stemVector=dt(a,"stemVector",c.stemVector),c.stemVisible=a.stemVisible,c.label=a.label,c.description=a.description,c.media=this.getMedia(a,c.media),c.color=(o=a,"color",(r=(r=c.color)||{}).r=o.color.r,r.g=o.color.g,r.b=o.color.b,r),c.floorIndex=s?s.index:-1,c.floorInfo=c.floorInfo||{},c.floorInfo.id=n.getIdFromCwfId(s.id),c.floorInfo.sequence=s.index,this.data[a.sid]=c}var o,r;for(const t in this.data)e.getTag(t)||delete this.data[t]}clear(){this._data={}}getMedia(e,t){const n=this.mediaConverter.toSdkMedia(e.mediaType);return(t=t||{}).src=e.mediaSrc,t.type=n||Oe.NONE,t}}const lt={namespace:"Mattertag",name:"injectHTML",subRoutine:"mattertag.inject",args:["tagId","html","options"]};var mt,ft;(ft=mt||(mt={})).LOADED="inject.loaded",ft.SETUP="inject.setup",ft.RESOLVE="inject.resolve";const wt=new Set;function gt(e){return!!e&&"string"==typeof e}var vt;wt.add(0),function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(vt||(vt={}));class yt{validateInput(e,t){const n=e.tagId;if(!gt(n))throw new Ge(n);if(!t.getTag(n))throw Error(e.tagId+" is not a valid tagId");if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!We(e.clientId))throw Error("Unexpected error: unable to create iframe");const o=e.options||{};let r="string"==typeof o.windowPath?o.windowPath:"";if(r&&r.split(".").filter((e=>"parent"!==e&&"opener"!==e)).length>0)throw Error(r+" is an unsupported window path");r.length>0&&"."!==r[0]&&(r="."+r);try{if(!Function("return window"+r)().postMessage)throw Error("invalid window")}catch(e){throw Error("problem finding a valid window with path: "+r)}const i={on:"on",off:"off",send:"send"};o.messageFcnMapping&&(gt(o.messageFcnMapping.on)&&(i.on=o.messageFcnMapping.on),gt(o.messageFcnMapping.off)&&(i.off=o.messageFcnMapping.off),gt(o.messageFcnMapping.send)&&(i.send=o.messageFcnMapping.send));const a={w:0,h:0};if(o.size){const e=$e(o.size.w+""),t=$e(o.size.h+"");isNaN(e)||isNaN(t)||(a.w=e,a.h=t)}return{tagId:n,clientId:e.clientId,html:e.html,options:{size:a,windowPath:r,messageFcnMapping:i}}}exec(e,t,n){const o=function(){let e;do{e=Math.floor(1e6*Math.random())}while(wt.has(e));return wt.add(e),e}(),r=function(){const e=document.createElement("iframe");return e.src="./mattertag/mattertag.postMessage.html",e.sandbox.add("allow-scripts"),e}();r.addEventListener("load",(function(){const n=r.contentWindow;t.return({messengerType:vt.POSTMESSAGE,iframeId:o}),n.postMessage({type:mt.SETUP,id:o,targetId:e.clientId,customHTML:e.html,windowPath:e.options.windowPath,messageFcnMapping:e.options.messageFcnMapping},"*")})),n.getTag(e.tagId).widgetFrame={size:{width:e.options.size.w,height:e.options.size.h},frame:new Tt(r)},n.commit()}}class Tt{constructor(e){this.iframe=e}mount(e){e.appendChild(this.iframe)}unmount(){this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe)}}class It extends O{constructor(e,t){super(),this.id="NAVIGATE_TO_MATTERTAG";const n=t;this.payload={sid:e,transition:n}}}class Et{validateInput(e,t){const n=e.sid;if(!ke(n))throw new Ge(n);if(!t.mattertags.getTag(n))throw Error(e.sid+" is not a valid tag sid");const o={opening:!1,navigating:!1};if("object"==typeof e.prevent&&e.prevent){const t=e.prevent;o.opening=!!t.opening,o.navigating=!!t.navigating}return{sid:n,prevent:o}}exec(e,t,n){e.prevent.opening=!e.prevent.opening,e.prevent.navigating=!e.prevent.navigating,n.setTagCapabilities(e.sid,e.prevent),t.return()}}class Ct extends O{constructor(e){super(),this.id="BATCH_REMOVE_MATTERTAG",this.payload={removeCommands:e}}}var St=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};class bt extends O{constructor(e){super(),this.id="MATTERTAG_OPEN",this.payload={tag:e}}}class xt extends O{constructor(e){super(),this.id="MATTERTAG_CLOSE",this.payload={tag:e}}}var Nt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};class At extends O{constructor(){super(...arguments),this.id="MEASUREMENTS_GET"}}class Ot{constructor(e){this.CwfMeasuringPhase=e}create(e,t){let n=t.groupCount,o=t.phase;const r=()=>{const r=t.groupCount,i=t.phase;n===r&&o!==this.CwfMeasuringPhase.EDITING||i!==this.CwfMeasuringPhase.IDLE||(e.onChanged(),n=r),o=i};return new B(t.onPhaseChanged(r),t.onSelectedGroupIndexChanged(r))}}class Pt{constructor(){this.data={}}update(e){for(const t of e.groups())this.createMeasurement(t);for(const t in this.data)e.getGroupInfoBySid(t)||delete this.data[t]}isItemEqual(e,t){return!x(this.data[t],e.data[t])}clear(){this.data={}}createMeasurement(e){const t=e.info.sid,n=this.data[t]||{},o=n.points||[];!function(e,t){let n=0;for(const o of t){const t=e[n]||{};t.x=o.x,t.y=o.y,t.z=o.z,e[n]=t,++n}e.length=n}(o,e),n.sid=t,n.points=o,this.data[t]=n}}class Dt{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Rt{constructor(){this._data={active:!1}}get data(){return this._data}equals(e){return this._data.active===e.data.active}copy(e){this._data.active=e.data.active}update(e){this._data.active=e.modeActive()}}var Mt;class _t extends O{constructor(e){super(),this.id="SDK_MEASUREMENT_TOGGLE",this.payload={active:e}}}!function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(Mt||(Mt={}));class Ft extends W{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}const Lt=new G("move-to-mode-command");class kt extends O{constructor(e){super(),this.id="MOVE_TO_MODE",this.payload=e}}class Gt{constructor(e,t,n,o){this.THREE=e,this.CmdViewmode=t,this.conversion=n,this.transitionTypeConverter=o}validateMoveToModeInput(e){if(!e)throw Error("Mode.moveTo -> no arguments provided -- mode is required");e.options||(e.options={});const t=e.mode;if(!z(this.CmdViewmode,e.mode))throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);if(t===this.CmdViewmode.TRANSITIONING)throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);e.options&&e.options.rotation&&(e.options.rotation.z=e.options.rotation.z||0);const n=this.validatePayloadOptions(e.options);return{mode:t,options:{transition:n.transition,position:n.position,rotation:n.rotation,zoom:n.zoom}}}validatePayloadOptions(e){let t,n,o,r;if(e){if(e.transition&&(o=this.transitionTypeConverter.fromSdkTransition(e.transition),void 0===o))throw Error(`Mode.moveTo -> ${e.transition} is not a valid transition style`);e.rotation&&Ke(e.rotation)&&(t=this.conversion.rotationToQuaternion(e.rotation)),e.position&&Ke(e.position)&&(n=new this.THREE.Vector3(parseFloat(e.position.x),parseFloat(e.position.y),parseFloat(e.position.z))),e.zoom&&!isNaN(e.zoom)&&(r=ae(e.zoom,1,30))}return{rotation:t,position:n,transition:o,zoom:r}}}class Vt extends O{constructor(){super(...arguments),this.id="GET_MODEL_DATA"}}function zt(e,t,n){t.addBinding(Vt,(()=>{return e=this,o=void 0,i=function*(){return function(e,n,o,r){const i={sid:"",sweeps:[],modelSupportsVr:!1};try{const a=n.getSweepList(),s=e.model;return t.makeModelData(s.sid,s.options.isVR,a,o,r,i),i}catch(e){throw Error("no model currently loaded")}}(...yield n.getDependencies())},new((r=void 0)||(r=Promise))((function(t,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,o||[])).next())}));var e,o,r,i})),e.addCommandCreator({namespace:"Model",name:"getData",args:[]},(()=>new Vt))}var Ut;class qt extends O{constructor(){super(...arguments),this.id="GET_MODEL_DETAILS"}}function Bt(e,t,n,o){o.getDependencies().then((e=>n.addBinding(qt,(()=>{return n=this,o=void 0,i=function*(){return function(e,n){function o(e,t){if(n.tryGetProperty(e,!0))return t}const r=e.model;return{sid:r.sid,name:o(t.OptionsKey.DetailsModelName,r.details.name),presentedBy:o(t.OptionsKey.PresentedBy,r.details.presentedBy),summary:o(t.OptionsKey.DetailsSummary,r.details.summary),formattedAddress:o(t.OptionsKey.DetailsAddress,r.details.formattedAddress),contactEmail:o(t.OptionsKey.DetailsEmail,r.details.contact.email),contactName:o(t.OptionsKey.DetailsName,r.details.contact.name),phone:o(t.OptionsKey.DetailsPhone,r.details.contact.phone),formattedContactPhone:o(t.OptionsKey.DetailsPhone,r.details.contact.formattedPhone),externalUrl:o(t.OptionsKey.DetailsExternalUrl,r.details.externalUrl)}}(...e)},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{c(i.next(e))}catch(e){t(e)}}function s(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i})))),e.addCommandCreator({namespace:"Model",name:"getDetails",args:[]},(()=>new qt))}!function(e){e.MODEL_LOADED="model.loaded"}(Ut||(Ut={}));var Ht,jt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};function Wt(e,t){return function(n,o,r,i,a,s){return jt(this,void 0,void 0,(function*(){s.sweeps=[];for(const n of r){const o=n.floorId?i.getFloor(n.floorId).index:-1;s.sweeps.push({uuid:a.getIdForSweep(n),sid:a.getIdForSweep(n),alignmentType:t.toSdkAlignment(n.alignmentType),placementType:t.toSdkPlacement(n.placementType),neighbors:yield Promise.all(n.neighbours.map((e=>jt(this,void 0,void 0,(function*(){return yield a.getIdFromCwfId(e)}))))),position:(c=n,null!==c.position?{x:c.position.x,y:c.position.y,z:c.position.z}:null),rotation:e.quaternionToRotation(n.rotation),floor:o})}var c;return s.sid=n,s.modelSupportsVr=o,s}))}}!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(Ht||(Ht={}));class $t{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Kt{constructor(e,t){this.colliderTypes=t,this.ZERO=new e.Vector3(0,0,0),this.tempVec=new e.Vector3,this._data={position:{x:0,y:0,z:0},normal:{x:0,y:0,z:0},object:Ht.NONE,floorId:void 0,floorIndex:void 0}}get data(){return this._data}equals(e){const t=1e-5,n=e.data.position,o=this._data.position,r=e.data.normal,i=this._data.normal;return X(n,o,t)&&X(r,i,t)&&e.data.object===this._data.object}update(e,t,n){const o=e.hit;o?(j(this._data.position,o.point),j(this._data.normal,o.face.normal),this._data.floorId=void 0,o.object instanceof this.colliderTypes.ModelColliderTarget?(this._data.object=Ht.MODEL,this._data.floorId=function(e,t,n,o){let r;if(function(e){const{object:t}=e;return"object"==typeof t&&"floorId"in t}(e))return r=t.getFloor(e.object.floorId),r.index;o.copy(e.point);const i=n.roomIdsFromPoint(o);if(!i.length)return;const a=i.find((t=>{const o=n.get(t);return o&&o.mesh===e.object}))||i[0];return r=t.getFloor(n.get(a).floorId),r.index}(o,t,n,this.tempVec)):o.object instanceof this.colliderTypes.PinHeadMesh?this._data.object=Ht.TAG:o.object instanceof this.colliderTypes.PuckCollider?this._data.object=Ht.SWEEP:this._data.object=Ht.UNKNOWN):(j(this._data.position,this.ZERO),j(this._data.normal,this.ZERO),this._data.object=Ht.NONE,this._data.floorId=void 0),this._data.floorIndex=this._data.floorId}copy(e){j(this._data.position,e.data.position),j(this._data.normal,e.data.normal),this._data.object=e.data.object,this._data.floorId=e.data.floorId,this._data.floorIndex=e.data.floorIndex}}class Yt{constructor(e,t){this.captureCamera=e,this.encodeRenderTarget=t}capture(e,t,n,o){return r=this,i=void 0,s=function*(){const{camera:r,scene:i}=t.getScene();return r.getWorldPosition(this.captureCamera.position),r.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(r.projectionMatrix),this.captureCamera.layers.mask=e.visibleObjects.mask,o.setSize(e.resolution.width,e.resolution.height),n.render(o.target,i,this.captureCamera),yield this.encodeRenderTarget(o)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function o(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,o)}c((s=s.apply(r,i||[])).next())}));var r,i,a,s}}var Xt;!function(e){e.Base64JPG="screenshot.base64.jpg",e.ArrayBufferJPG="screenshot.arraybuffer.jpg"}(Xt||(Xt={}));class Zt{constructor(e,t,n){this.RenderLayers=t.RenderLayers,this.screenCapturer=e,this.requestTarget=n.requestTarget,this.getRenderLayer=n.getRenderLayer,this.jpegAsBase64=n.jpegAsBase64}validateInput(e,t,n,o){return{resolution:this.validateResolution(e.resolution,t,n),visibleObjects:this.buildVisibilityOptions(e.visibleObjects),returnType:e.returnType===Xt.ArrayBufferJPG?Xt.ArrayBufferJPG:Xt.Base64JPG}}exec(e,t,n,o,r){return i=this,a=void 0,c=function*(){const n=yield this.requestTarget(),i=yield this.screenCapturer.capture({resolution:e.resolution,visibleObjects:this.buildVisibilityLayers(e.visibleObjects)},o,r,n);e.returnType===Xt.ArrayBufferJPG&&t.return(i.buffer),t.return(this.jpegAsBase64(i))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,o)}r((c=c.apply(i,a||[])).next())}));var i,a,s,c}validateResolution(e,t,n){const o={width:0,height:0};if(!e)return o.width=t.width,o.height=t.height,o;if(!function(e){const t=e;return!!t&&"number"==typeof t.width&&"number"==typeof t.height}(e))throw Error('"resolution" provided was not valid. Expected .width and .height to be numbers.');o.width=e.width,o.height=e.height;const r=n.maxTextureSize;if(e.width<=0||e.width>r)throw Error('"resolution.width" provided was outside the valid range of [0, '+r+"]");if(e.height<=0||e.height>r)throw Error('"resolution.height" provided was outside the valid range of [0, '+r+"]");return o}buildVisibilityOptions(e){const t=e||{};return{measurements:!!t.measurements,mattertags:!!t.mattertags,sweeps:!!t.sweeps,views:!!t.views}}buildVisibilityLayers(e){const t=this.RenderLayers.ALL;return e.mattertags||t.removeLayers(this.getRenderLayer("pins")),e.measurements||t.removeLayers(this.getRenderLayer("measurements")),e.sweeps||t.removeLayers(this.getRenderLayer("sweep-pucks")),e.views||(t.removeLayers(this.getRenderLayer("sweep-portal-mesh")),t.removeLayers(this.getRenderLayer("sweep-pin-mesh"))),t}}class Qt{constructor(e,t,n){this.Viewmode=t.Viewmode,this.requestTarget=n.requestTarget,this.encodeRenderTarget=n.encodeRenderTarget,this.jpegAsBase64=n.jpegAsBase64,this.getXmp=n.getXmp,this.getOrientedAngleTo=n.getOrientedAngleTo,this.forward=new e.Vector3(0,0,-1),this.sweepForward=new e.Vector3,this.viewForward=new e.Vector3}validateInput(e){return e}exec(e,t,n,o,r,i,a){return s=this,c=void 0,u=function*(){if(!i.currentSweep||r.currentMode!==this.Viewmode.Panorama)throw new Error("Can only capture equirectangular projections while stationary in a sweep");const e=n.getScene().camera,s=i.getSweep(i.currentSweep),c=yield a.load(s);this.sweepForward.copy(this.forward),this.sweepForward.copy(this.forward).applyQuaternion(s.rotation).setY(0);const d=this.getOrientedAngleTo(this.sweepForward,e.getWorldDirection(this.viewForward).setY(0))+Math.PI,u=yield this.requestTarget();u.setSize(Qt.equirectangularRes.width,Qt.equirectangularRes.height),o.renderEquirectangular(c,u.target,d);const h=yield this.encodeRenderTarget(u,this.getXmp(u.width,u.height,0,0));t.return(this.jpegAsBase64(h))},new((d=void 0)||(d=Promise))((function(e,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function o(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof d?r:new d((function(e){e(r)}))).then(n,o)}r((u=u.apply(s,c||[])).next())}));var s,c,d,u}}Qt.equirectangularRes={width:4096,height:2048};class Jt{constructor(e,t){this.issueCommand=t.issueCommand,this.GetScreenPositionCommand=e.GetScreenPositionCommand}validateInput(e){if(!Ke(e.worldPosition))throw Error(`Renderer.getScreenPosition: 'worldPosition' was specified but was not a valid Vector3; got ${e.worldPosition}`);return e}exec(e,t){return n=this,o=void 0,i=function*(){const n=yield this.issueCommand(new this.GetScreenPositionCommand(e));t.return(n)},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{c(i.next(e))}catch(e){t(e)}}function s(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i}}var en;class tn{constructor(e,t){this.GetFloorIntersectCommand=e.GetFloorIntersectCommand,this.issueCommand=t.issueCommand}validateInput(e){if(!function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e){const t=e;return We(t.x)&&We(t.y)}return!1}(e.screenPosition))throw Error(`Renderer.getWorldPositionData: 'screenPosition' was not a valid Vector2; got ${e.screenPosition}`);return e}exec(e,t,n){return o=this,r=void 0,a=function*(){const o=yield this.issueCommand(new this.GetFloorIntersectCommand(e)),r=n.getFloorAtIndex(o.floorIndex);r?t.return({position:o.position,floorInfo:{id:r.id,sequence:r.index},floor:o.floorIndex}):t.return({position:o.position,floorInfo:{id:"",sequence:-1},floor:-1})},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}}class nn{constructor(){this.wasTransitioning360=!1,this.cameraPosition={x:0,y:0,z:0}}create(e,t,n,o){return new B(n.onChanged((()=>this.throttleCameraPositionChanges(e,n))),o.onChanged((()=>this.throttleSweepChanges(e,o))))}throttleCameraPositionChanges(e,t){const n=t.pose.position;n.x===this.cameraPosition.x&&n.y===this.cameraPosition.y&&n.z===this.cameraPosition.z||(this.cameraPosition.x=n.x,this.cameraPosition.y=n.y,this.cameraPosition.z=n.z,e.onChanged())}throttleSweepChanges(e,t){const n=t.transition;t.transitionActive?(t.isSweepUnaligned(n.from)||t.isSweepUnaligned(n.to))&&(this.wasTransitioning360=!0):this.wasTransitioning360&&!t.isSweepUnaligned(t.currentSweep)&&(e.onChanged(),this.wasTransitioning360=!1)}}class on{constructor(){this.currentRooms={rooms:[]}}get data(){return this.currentRooms}equals(e){return this.data.rooms.length===e.data.rooms.length&&this.currentRooms.rooms.every((t=>e.data.rooms.findIndex((e=>e.id===t.id))>-1))}copy(e){this.currentRooms.rooms.length=e.data.rooms.length,function(e,t){const n=t.length;e.length=n;for(let o=0;o<n;++o)e[o]=t[o]}(this.currentRooms.rooms,e.data.rooms)}update(e,t,n,o,r,i){if(r.isPano()&&n.isSweepUnaligned(n.currentSweep)||n.transitionActive&&(n.isSweepUnaligned(n.transition.to)||n.isSweepUnaligned(n.transition.from)))return void(this.currentRooms.rooms.length=0);const a=e.roomIdsFromPoint(t.pose.position);this.currentRooms.rooms.length=a.length;for(let t=0;t<a.length;++t){const n=a[t],r=e.get(n),s=this.currentRooms.rooms[t]||{};s.id=i.getIdFromCwfId(r.id),s.bounds=s.bounds||{},s.bounds.min=dt(r,"min",s.bounds.min),s.bounds.max=dt(r,"max",s.bounds.max);const c=o.getFloor(r.floorId);s.floorInfo=ut(c,s.floorInfo),this.currentRooms.rooms[t]=s}}}class rn{create(e,t,n){return{renew(){},cancel(){}}}}class an{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],o=e.data[t];return n.id===o.id&&X(n.bounds.min,o.bounds.min)&&X(n.bounds.max,o.bounds.max)}update(e,t,n){for(const o of e.rooms()){const e=n.getIdFromCwfId(o.id),r=this._data[e]||{};r.id=e,r.bounds=r.bounds||{},r.bounds.min=dt(o,"min",r.bounds.min),r.bounds.max=dt(o,"max",r.bounds.max);const i=t.getFloor(o.floorId);r.floorInfo=ut(i,r.floorInfo),this._data[e]=r}for(const e in this.data)n.getRoomForId(e)||delete this._data[e]}clear(){this._data={}}}!function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(en||(en={}));class sn extends O{constructor(e){super(),this.id="SCENE_REGISTER",this.payload=e}}class cn extends O{constructor(e){super(),this.id="SCENE_CREATE_NODE",this.payload=e}}class dn extends O{constructor(e){super(),this.id="SCENE_QUERY",this.payload=e}}class un extends O{constructor(e){super(),this.id="SCENE_CONFIGURE",this.payload=e}}class hn extends O{constructor(e){super(),this.id="SCENE_GETIMAGE",this.payload=e}}class pn extends O{constructor(e){super(),this.id="SCENE_EXPORT",this.payload=e}}class ln extends O{constructor(e){super(),this.id="SCENE_EXPORT",this.payload=e}}class mn extends O{constructor(e){super(),this.id="SCENE_CREATE_NODES",this.payload=e}}class fn extends O{constructor(e){super(),this.id="SCENE_REGISTER_COMPONENTS",this.payload=e}}class wn extends O{constructor(e){super(),this.id="SCENE_CREATE_OBJECTS",this.payload=e}}class gn{validateInput(e,t,n){if(!gt(e.sensorId)||!n.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!function(e){return"boolean"==typeof e}(e.show))throw Error(`Sensor.showDebug: 'show' was not a boolean; got ${e.show}`);return{sensorId:e.sensorId,show:e.show}}exec(e,t,n,o){if(e.show){const t=o.get(e.sensorId);n.setDebugSensor(t)}else n.setDebugSensor(null);t.return()}}class vn{constructor(){this.sourceMap=new Map,this.reverseSourceLookup=new Map,this.sourceId=0,this._data={}}get data(){return this._data}isItemEqual(e,t){return e.data[t].inRange===this.data[t].inRange&&e.data[t].inView===this.data[t].inView}update(e){for(const[t,n]of e.readings){const e=this.addOrGetSourceId(t),o=this._data[e]||{};o.inRange=n.inRange,o.inView=n.inView,o.distanceSquared=n.distanceSq,o.direction=dt(n,"direction",o.direction),this._data[e]=o}for(const t in this.data){const n=this.reverseSourceLookup.get(t);n&&!e.readings.get(n)&&(this.sourceMap.delete(n),this.reverseSourceLookup.delete(t),delete this._data[t])}}clear(){this._data={}}addOrGetSourceId(e){const t=this.sourceMap.get(e);if(t)return t;const n="source-"+ ++this.sourceId;return this.sourceMap.set(e,n),this.reverseSourceLookup.set(n,e),n}}var yn;class Tn{constructor(...e){this.dependencies=e}getDependencies(){return e=this,t=void 0,o=function*(){return Promise.all(this.dependencies)},new((n=void 0)||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}static extend(e,...t){return new Tn(...e.dependencies,...t)}static combine(e,t){return new Tn(...e.dependencies,...t.dependencies)}}!function(e){e.CAMERA="sensor.sensortype.camera"}(yn||(yn={}));const In={namespace:"Sensor",name:"createSensor",subRoutine:"sensor.create",args:[]};class En{constructor(){this._data={origin:{x:0,y:0,z:0},forward:{x:0,y:0,z:-1}}}get data(){return this._data}equals(e){const t=1e-5;return X(this.data.origin,e.data.origin,t)&&X(this.data.forward,e.data.forward,t)}copy(e){j(this._data.origin,e.data.origin),j(this._data.forward,e.data.forward)}update(e){j(this._data.origin,e.frustum.origin),j(this._data.forward,e.frustum.forward)}}class Cn{constructor(e,t){this.sdkModule=e,this.sensorFactories=t}validateInput(e){if(!z(yn,e.type))throw Error(e.type+" is not a valid sensor type");return this.sensorFactories[e.type].validateInput(e)}exec(e,t,n,o,r){return i=this,a=void 0,c=function*(){const i=this.sensorFactories[e.type].create(e,n),a="sensor-"+ ++Cn.nextSensorId;o.set(a,i);const s=C.create(new Tn(i),new bn,new S(En)),c=this.sdkModule.addObservable(a,s),d=Te.create(new Tn(i),new xn,new S(vn)),u=this.sdkModule.addCollection(a,d);r.set(a,{dispose(){c.dispose(),u.dispose()}}),t.return({sensorId:a})},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,o)}r((c=c.apply(i,a||[])).next())}));var i,a,s,c}}Cn.nextSensorId=0;class Sn{validateInput(e){return e}create(e,t){return t.createCameraBoundSensor()}}class bn{create(e,t){return t.frustum.observe(new Nn(e))}}class xn{create(e,t){return t.onReadingsUpdated(new Nn(e))}}class Nn{constructor(e){this.dependencyObserver=e}notify(){this.dependencyObserver.onChanged()}}class An{validateInput(e,t,n){if(!gt(e.sensorId)||!t.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!function(e,t){return!!Array.isArray(e)&&e.every(t)}(e.sourceIds,gt))throw Error("dev error: this should not occur unless the sdk was not setup properly");for(const t of e.sourceIds)if(!n.has(t))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId,sourceIds:e.sourceIds}}exec(e,t,n,o){const r=n.get(e.sensorId),i=e.sourceIds.map(o.get,o);r.addSource(...i),t.return()}}class On{validateInput(e,t){if(!gt(e.sensorId)||!t.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId}}exec(e,t,n,o){o.get(e.sensorId).dispose(),n.get(e.sensorId).dispose(),t.return()}}const Pn={namespace:"Sensor",name:"createSource",subRoutine:"source.create",args:["type","options"]};var Dn;!function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(Dn||(Dn={}));class Rn{constructor(e,t,n){this.radius=1/0,this.type=e.SPHERE,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{origin:this._volume.origin,radius:this._volume.radius}}}const Mn=Math.PI/180;class _n{constructor(e,t,n){this.type=e.BOX,this._volume=t,this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{center:this._volume.center,size:this._volume.size,orientation:this.convertQuaternionToOrientation(this._volume.orientation)}}updateOrientation(e){this.eulerCache.set(e.pitch*Mn,e.yaw*Mn,e.roll*Mn,"YXZ"),this.quaternionCache.setFromEuler(this.eulerCache),this._volume.updateOrientation(this.quaternionCache)}convertQuaternionToOrientation(e){return this.eulerCache.setFromQuaternion(this.quaternionCache.set(e.x,e.y,e.z,e.w)).reorder("YXZ"),{yaw:this.eulerCache.y*Mn,pitch:this.eulerCache.x*Mn,roll:this.eulerCache.z*Mn}}}class Fn{constructor(e,t,n){this.type=e.CYLINDER,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{basePoint:this._volume.basePoint,height:this._volume.height,radius:this._volume.radius}}}function Ln(e){return!!e&&"object"==typeof e}function kn(e){if(e&&"object"==typeof e&&"yaw"in e&&"pitch"in e&&"roll"in e){const t=e;return We(t.yaw)&&We(t.pitch)&&We(t.roll)}return!1}class Gn{constructor(e){this.sourceFactories=e}validateInput(e,t){if(!z(Dn,e.type))throw Error(e.type+" is not a valid source type");return this.sourceFactories[e.type].validateInput(e)}exec(e,t,n){const o=this.sourceFactories[e.type].create(e),r="source-"+ ++Gn.nextSourceId;n.set(r,o),t.return({sourceId:r,type:e.type,volume:o.describeVolume()})}}Gn.nextSourceId=0;class Vn{constructor(e,t,n){this.sourceType=e,this.sphereVolumeFactory=t,this.THREE=n}validateInput(e){if(Ln(e.options)){if(e.options.origin&&!Ke(e.options.origin))throw Error(`Source.Box: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(e.options.radius&&(!We(e.options.radius)||e.options.radius<0))throw Error(`Source.Sphere: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`)}const t=e.options||{};return{type:e.type,options:{origin:t.origin||{x:0,y:0,z:0},radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Rn(this.sourceType,new this.sphereVolumeFactory,this.THREE),n=t.volume;return n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),t}}class zn{constructor(e,t,n){this.sourceType=e,this.boxVolumeFactory=t,this.THREE=n}validateInput(e){if(Ln(e.options)){if(e.options.center&&!Ke(e.options.center))throw Error(`Source.Box: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&(!Ke(e.options.size)||e.options.size.x<0||e.options.size.y<0||e.options.size.z<0))throw Error(`Source.Box: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!kn(e.options.orientation))throw Error(`Source.Box: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`)}const t=e.options||{};return{type:e.type,options:{center:t.center||{x:0,y:0,z:0},size:t.size||{x:1/0,y:1/0,z:1/0},orientation:t.orientation||{yaw:0,pitch:0,roll:0}}}}create(e){const t=new _n(this.sourceType,new this.boxVolumeFactory,this.THREE),n=t.volume;return n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),t}}class Un{constructor(e,t,n){this.sourceType=e,this.cylinderVolumeFactory=t,this.THREE=n}validateInput(e){if(Ln(e.options)){if(e.options.basePoint&&!Ke(e.options.basePoint))throw Error(`Source.Cylinder: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&!(We(e.options.height)&&e.options.height>0))throw Error(`Source.Cylinder: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&!(We(e.options.radius)&&e.options.radius>0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{basePoint:t.basePoint||{x:0,y:0,z:0},height:t.hasOwnProperty("height")?t.height:1/0,radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Fn(this.sourceType,new this.cylinderVolumeFactory,this.THREE),n=t.volume;return n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),t}}class qn{constructor(e){this.sourceUpdaters=e}validateInput(e,t){if(!gt(e.sourceId)||!t.has(e.sourceId))throw Error("dev error: this should not occur unless the sdk was not setup properly");const n=t.get(e.sourceId);return this.sourceUpdaters[n.type].validateInput(e)}exec(e,t,n){const o=n.get(e.sourceId);this.sourceUpdaters[o.type].update(e,o),t.return()}}class Bn{validateInput(e){if(!Ln(e.options))throw Error("Source.Sphere.update: invalid options provided to .update");if(!Ke(e.options.origin))throw Error(`Source.Sphere.update: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(!We(e.options.radius)||e.options.radius<0)throw Error(`Source.Sphere.update: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),n.notify()}}class Hn{validateInput(e){if(!Ln(e.options))throw Error("Source.Box.update: invalid options provided to .update");if(e.options.center&&!Ke(e.options.center))throw Error(`Source.Box.update: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&!(Ke(e.options.size)&&e.options.size.x<0&&e.options.size.y<0&&e.options.size.z<0))throw Error(`Source.Box.update: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!kn(e.options.orientation))throw Error(`Source.Box.update: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`);return e}update(e,t){const n=t.volume;n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),n.notify()}}class jn{validateInput(e){if(!Ln(e.options))throw Error("Source.Cylinder.update: invalid options provided to .update");if(e.options.basePoint&&!Ke(e.options.basePoint))throw Error(`Source.Cylinder.update: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&!We(e.options.height))throw Error(`Source.Cylinder.update: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&!We(e.options.radius))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),n.notify()}}var Wn;!function(e){e.FPS="stat.fps"}(Wn||(Wn={}));var $n,Kn;class Yn{constructor(e,t){this.perfStatInterval=1e3,this.elapsedTime=0,this.frameCount=0,this.lastCalcTime=0,this.fps=[0],this.waitForUpdate=e,this.perfStatInterval=t.tryGetProperty("perfInterval",this.perfStatInterval)}calcAndBroadcast(e){return t=this,n=void 0,r=function*(){yield this.waitForUpdate();const t=Date.now(),n=t-this.lastCalcTime;this.lastCalcTime=t,this.elapsedTime+=n,this.frameCount++,this.elapsedTime>=this.perfStatInterval&&(this.fps[0]=1e3*this.frameCount/this.elapsedTime,this.elapsedTime=0,this.frameCount=0,e.broadcast(Wn.FPS,(()=>this.fps))),this.calcAndBroadcast(e)},new((o=void 0)||(o=Promise))((function(e,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(a,s)}c((r=r.apply(t,n||[])).next())}));var t,n,o,r}}!function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}($n||($n={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(Kn||(Kn={}));class Xn{constructor(e,t){this.toSdkAlignmentMap={[e.ALIGNED]:$n.ALIGNED,[e.UNALIGNED]:$n.UNALIGNED},this.toSdkPlacementMap={[t.UNPLACED]:Kn.UNPLACED,[t.AUTO]:Kn.AUTO,[t.MANUAL]:Kn.MANUAL}}toSdkAlignment(e){return this.toSdkAlignmentMap[e]}toSdkPlacement(e){return this.toSdkPlacementMap[e]}}var Zn,Qn=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"});class Jn{constructor(){this.currentSweep="",this.sweepTransitionActive=!1,this.currentMode=null,this.modeTransitionActive=!1}create(e,t,n){return new B(t.onChanged((()=>this.throttleSweepDataChanges(e,t))),n.onChanged((()=>this.throttleViewmodeDataChanges(e,n))))}throttleSweepDataChanges(e,t){const n=t.currentSweep||"",o=t.transition.active&&t.transition.to!==t.transition.from;this.currentSweep===n&&this.sweepTransitionActive===o||(this.currentSweep=n,this.sweepTransitionActive=o,e.onChanged())}throttleViewmodeDataChanges(e,t){const n=t.currentMode,o=t.transition.active;this.currentMode===n&&this.modeTransitionActive===o||(this.currentMode=n,this.modeTransitionActive=o,e.onChanged())}}class eo{constructor(e,t){this.currentSweep=Object.assign(Object.assign({},eo.empty),{floorInfo:Object.assign({},eo.empty.floorInfo),neighbors:[],position:Object.assign({},eo.empty.position),rotation:Object.assign({},eo.empty.rotation)}),this.Viewmode=e.Viewmode,this.sweepPlacementConverter=t.sweepPlacementConverter}get data(){return this.currentSweep}equals(e){const t=Qn.epsilon;return this.currentSweep.id===e.data.id&&this.currentSweep.enabled===e.data.enabled&&this.currentSweep.alignmentType===e.data.alignmentType&&this.currentSweep.placementType===e.data.placementType&&this.currentSweep.floorInfo.id===e.data.floorInfo.id&&this.currentSweep.floorInfo.sequence===e.data.floorInfo.sequence&&this.compareNeighbors(e.currentSweep)&&X(this.currentSweep.position,e.data.position,t)&&X(this.currentSweep.rotation,e.data.rotation,t)}copy(e){this.copySweep(e.data)}update(e,t,n,o,r){const i=e.currentSweepObject;if(!i||e.transition.active||t.transition.active||t.currentMode!==this.Viewmode.Panorama&&t.currentMode!==this.Viewmode.Outdoor)return void this.copySweep(eo.empty);let a;try{a=n.getFloor(i.floorId||"")}catch(e){a={id:void 0,index:void 0}}const s=o.getIdForSweep(i);this.currentSweep.uuid=i.uuid,this.currentSweep.sid=s,this.currentSweep.id=s,this.currentSweep.enabled=i.enabled,this.currentSweep.alignmentType=this.sweepPlacementConverter.toSdkAlignment(i.alignmentType),this.currentSweep.placementType=this.sweepPlacementConverter.toSdkPlacement(i.placementType),this.currentSweep.neighbors=[...i.neighbours],j(this.currentSweep.position,i.position),j(this.currentSweep.rotation,i.rotation),this.currentSweep.alignmentType===$n.UNALIGNED&&this.currentSweep.placementType===Kn.UNPLACED?(this.currentSweep.floorInfo.id=void 0,this.currentSweep.floorInfo.sequence=void 0):(this.currentSweep.floorInfo.id=a.id?r.getIdFromCwfId(a.id):a.id,this.currentSweep.floorInfo.sequence=a.index)}copySweep(e){this.currentSweep.uuid=e.uuid,this.currentSweep.sid=e.sid,this.currentSweep.id=e.id,this.currentSweep.enabled=e.enabled,this.currentSweep.alignmentType=e.alignmentType,this.currentSweep.placementType=e.placementType,this.currentSweep.floorInfo.id=e.floorInfo.id,this.currentSweep.floorInfo.sequence=e.floorInfo.sequence,this.currentSweep.neighbors=[...e.neighbors],j(this.currentSweep.position,e.position),j(this.currentSweep.rotation,e.rotation)}compareNeighbors(e){const t=this.currentSweep.neighbors.length;for(let n=0;n<t;++n)if(this.currentSweep.neighbors[n]!==e.neighbors[n])return!1;return t===e.neighbors.length}}eo.empty={uuid:"",sid:"",id:"",enabled:!1,alignmentType:$n.ALIGNED,placementType:Kn.UNPLACED,floorInfo:{id:void 0,sequence:void 0},neighbors:[],position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(Zn||(Zn={}));var to,no=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};class oo{constructor(e,t){this.NavigateToSweepCommand=e.NavigateToSweepCommand,this.issueCommand=t.issueCommand,this.cameraTransitionConverter=t.cameraTransitionConverter,this.conversion=t.conversionUtils}validateInputSweepId(e,t,n){if(!e||!gt(e))throw Error(`Sweep.moveTo: 'sweep' was not a valid sweep id; got ${e}`);const o=n.getSweepForId(e);if(!o)throw Error(e+" does not map to a valid sweep in this model");return o.id}validateInput(e,t,n){const o=this.validateInputSweepId(e.sweep,t,n),i=e.options||{};if(i.rotation&&!function(e){const t=e;return!!t&&!("z"in t&&!We(t.z))&&We(t.x)&&We(t.y)}(i.rotation))throw Error(`Sweep.moveTo: 'options.rotation' was specified but was not a valid Rotation; got ${i.rotation}`);if(i.transition&&!z(r,i.transition))throw Error(`Sweep.moveTo: options.transition was specified but was not a valid transition type; got ${i.transition}`);if(i.transitionTime&&(!We(i.transitionTime)||i.transitionTime<=0))throw Error(`Sweep.moveTo: options.transitionTime was specified but was not a valid, positive time; got ${i.transitionTime}`);return{sweep:o,options:{rotation:i.rotation,transition:i.transition,transitionTime:i.transitionTime||void 0}}}exec(e,t,n){return o=this,r=void 0,a=function*(){const n=e.options.rotation?this.conversion.rotationToQuaternion(e.options.rotation):void 0,o=e.options.transition,r=e.options.transition?this.cameraTransitionConverter.fromSdkTransition(o):void 0,i=e.options.transitionTime,a=yield this.issueCommand(new this.NavigateToSweepCommand({sweep:e.sweep,rotation:n,transition:r,transitionTime:i}));t.return(a)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}}class ro{create(e,t){return t.onChanged((()=>e.onChanged()))}}class io{constructor(e,t){this._data={},this.conversionUtils=e,this.sweepPlacementConverter=t}get data(){return this._data}isItemEqual(e,t){return!x(this.data[t],e.data[t])}update(e,t,n,o){for(const r of e.sweeps()){const{id:e,index:i}=r.floorId?t.getFloor(r.floorId):{id:"",index:-1},a=e?o.getIdFromCwfId(e):void 0,s=n.getIdFromCwfId(r.id),c=this.data[s]||{};c.uuid=r.uuid,c.sid=s,c.id=s,c.enabled=r.enabled,c.alignmentType=this.sweepPlacementConverter.toSdkAlignment(r.alignmentType),c.neighbors=r.neighbours.map((e=>n.getIdFromCwfId(e))),c.position=ao(r,c.position),c.rotation=this.conversionUtils.quaternionToRotation(r.rotation,c.rotation),c.floorInfo=a?{id:a,sequence:i}:{id:"",sequence:-1},this.data[c.id]=c}for(const e in this.data)n.getSweepForId(e)||delete this.data[e]}clear(){this._data={}}}function ao(e,t){return(t=t||{}).x=e.position.x,t.y=e.position.y,t.z=e.position.z,t}class so{validateInput(e,t,n,o){return{sweepIds:ho(e.sweepIds,0,o)}}exec(e,t,n,o){for(const t of e.sweepIds)po(t,!0,n,o);t.return()}}class co{validateInput(e,t,n,o){return{sweepIds:ho(e.sweepIds,0,o)}}exec(e,t,n,o){for(const t of e.sweepIds)po(t,!1,n,o);t.return()}}function uo(e,t,n){if(!gt(e))throw Error(e+" is not a valid string input");const o=n.getSweepForId(e);if(!o)throw Error(e+" does not map to a valid sweep in this model");return o.id}function ho(e,t,n){if(!Array.isArray(e))throw Error();for(const t of e)uo(t,0,n);return e}function po(e,t,n,o){o.setVisible(e,t);const r=n.getSweep(e);r.enabled=t,r.commit()}!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(to||(to={}));const lo=new G("sdk: tours");class mo{validateInput(e){return void 0!==e.index&&isNaN(e.index)&&(lo.warn(e.index,"is not a valid number"),e.index=void 0),void 0!==e.steps&&isNaN(e.steps)&&(lo.warn(e.steps,"is not a valid number"),e.steps=void 0),e}exec(e,t,n,o){if(0===o.getSnapshotCount())throw Error("No tour data found");if(!n.canChangeTourLocation())throw Error("TourStart ignored, cannot change location at this time, another transition is active");try{n.startTour(e.index,e.steps,e.loop),t.return()}catch(e){t.throw(`Error occurred while starting tour - ${e}`)}}}class fo{validateInput(e){return e}exec(e,t,n){n.stopTour().then((()=>t.return())).catch((e=>{t.throw(`Error occurred while stopping tour - ${e}`)}))}}class wo{validateInput(e,t,n){const o=e.index;if(!We(o))throw Error(o+" is not a valid tour snapshot index");if(o<0||o>n.getSnapshotCount())throw Error(`${o} is outside of the range of tour snapshots: [0 , ${n.getSnapshotCount()-1}]`);return{index:o}}exec(e,t,n,o){if(0===o.getSnapshotCount())throw Error("No tour data found");if(!n.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");n.tourGoTo(e.index).then((()=>t.return())).catch((e=>{t.throw(`Error occurred while jumping to new tour location - ${e}`)}))}}class go{constructor(e){this.forward=e}validateInput(e){return e}exec(e,t,n,o){if(0===o.getSnapshotCount())throw Error("No tour data found");if(!n.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");(this.forward?n.tourGoNext(!1):n.tourGoPrevious(!1)).then((()=>t.return())).catch((e=>{t.throw(`Error while trying to travel to the next tour snapshot - ${e}`)}))}}var vo=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};class yo extends O{constructor(){super(...arguments),this.id="GET_TOUR_DATA"}}var To=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))};function Io(n,o,b,x,O,L={}){const{THREE:k}=o,{appPhaseModule:G,applicationData:B,cameraData:H,canvasData:j,floorData:W,floorViewData:$,labelData:K,mattertagData:Y,mattertagViewData:X,measurementModeData:oe,modelData:ae,raycasterData:se,roomData:ce,settingsData:de,sweepData:le,sweepViewData:Ue,tourData:$e,viewmodeData:Ke,commonControlsModule:Ye,floorCasterModule:Ze,mattertagDataModule:Je,mattertagMeshModule:st,mattertagViewDataModule:dt,modelDataModule:ut,modelMeshModule:mt,navigationModule:ft,renderToTextureModule:wt,sceneModule:gt,sensorModule:vt,settingsModule:Tt,tourControlsModule:Vt,webglRendererModule:qt,zoomControlModule:jt,sweepTextureLoader:Xt}=O;L.idOption=L.idOption||i.LEGACY;const vn=new l(k),En=new u(b.Viewmode),bn=function(e){return function(t,n){return o=this,r=void 0,a=function*(){const o=n.rotationSpeed;let r=0;const i=Math.abs(n.xAngle),a=Math.abs(n.yAngle),s=Math.max(i,a);if(s>=Math.PI){const e=s/Math.PI,t=Math.floor(e),n=i/e,o=a/e,c=i-n*t,d=a-o*t;r=Math.acos(Math.cos(n)*Math.cos(o))*t+Math.acos(Math.cos(c)*Math.cos(d))}else r=Math.acos(Math.cos(Math.abs(n.xAngle))*Math.cos(Math.abs(n.yAngle)));if(r){const i=new e.Vector2(-n.xAngle,n.yAngle);return i.multiplyScalar(o/r),t.startRotateTransition(r/o,i,!1)}},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}}(k),xn=new Xn(b.SweepAlignmentType,b.SweepPlacementType),Nn=function(){return To(this,void 0,void 0,(function*(){const e=yield le;return L.idOption===i.LEGACY?new f(e):new w(e)}))}(),Rn=function(){return To(this,void 0,void 0,(function*(){const e=yield W;return L.idOption===i.LEGACY?new g(e):new v(e)}))}(),Mn=function(){return To(this,void 0,void 0,(function*(){const e=yield ce;return L.idOption===i.LEGACY?new y(e):new T(e)}))}(),_n=Object.assign(Object.assign({},x),{conversionUtils:new l(k),directionConverter:new d(b.Vectors),getPose:we(k,En),rotateCamera:bn,orientCamera:ee(k,b.Viewmode,bn),appPhaseConverter:new I(b.AppPhase),applicationConverter:new E(b.Application),mediaConverter:new _e(b.MattertagMediaType,b.TagDescriptionChunkType),chunkTypeConverter:new Fe(b.TagDescriptionChunkType),linkTypeConverter:new Le(b.TagLinkType),sweepPlacementConverter:xn,viewmodeConverter:En,commandModeConverter:new h(b.CommandViewmode),cameraTransitionConverter:new p(b.CameraTransitionType),makeLabelData:Me(k,x.worldToScreenPosition),makeModelData:Wt(vn,xn),sweepUtils:new m(b.SweepAlignmentType)});var Fn;(Fn=n).addEnumToInterface({namespace:"App",name:"Phase",values:c}),Fn.addEnumToInterface({namespace:"App",name:"Event",values:a}),Fn.addEnumToInterface({namespace:"App",name:"Application",values:s}),function(e,t,n){const o=[void 0],r=e=>(o[0]=n.appPhaseConverter.toSdkAppPhase(e.phase),o);n.subscribe(t.AppPhaseChangeMessage,(t=>{e.broadcast(a.PHASE_CHANGE,r,t)}))}(n,b,_n),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(P,(()=>{return n=this,o=void 0,i=function*(){try{const n=e.getData();return{phase:t.appPhaseConverter.toSdkAppPhase(n.phase),application:t.applicationConverter.toSdkApplication(n.application)}}catch(e){throw Error("Error: Can't get application data at this time")}},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{c(i.next(e))}catch(e){t(e)}}function s(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i}))})),e.addCommandCreator({namespace:"App",name:"getState",args:[]},(()=>new P))}(n,_n,new Tn(G)),function(e,t,n){t.addBinding(D,(()=>{return e=this,o=void 0,i=function*(){const e={[c.WAITING]:null,[c.LOADING]:null,[c.STARTING]:null,[c.PLAYING]:null,[c.ERROR]:null},[o]=yield n.getDependencies();for(const n in o.phaseTimes){const r=Number(n);e[t.appPhaseConverter.toSdkAppPhase(r)]=o.phaseTimes[r]}return e},new((r=void 0)||(r=Promise))((function(t,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,o||[])).next())}));var e,o,r,i})),e.addCommandCreator({namespace:"App",name:"getLoadTimes",args:[]},(()=>new D))}(n,_n,new Tn(B)),function(e,t,n,o){const r=C.create(o,new N,new S(A,t,n));e.addObservableToInterface({namespace:"App",name:"state"},r)}(n,b,_n,new Tn(B)),function(e,n,o){o.getDependencies().then((([e,o,r,i])=>{const a={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:t.TRANSITIONING};n.addBinding(R,(()=>{return t=this,s=void 0,d=function*(){return n.getPose(a,e,o,r,i)},new((c=void 0)||(c=Promise))((function(e,n){function o(e){try{i(d.next(e))}catch(e){n(e)}}function r(e){try{i(d.throw(e))}catch(e){n(e)}}function i(t){var n;t.done?e(t.value):(n=t.value,n instanceof c?n:new c((function(e){e(n)}))).then(o,r)}i((d=d.apply(t,s||[])).next())}));var t,s,c,d}))})),e.addCommandCreator({namespace:"Camera",name:"getPose",args:[]},(()=>new R))}(n,_n,new Tn(H,le,Ke,Nn)),function(e,t,n,o){o.getDependencies().then((([e,o,r])=>{n.addBinding(_,(function(i={}){return a=this,s=void 0,d=function*(){if(!r.isPano())throw Error("Camera.lookAtScreenCoords must be called from Inside mode");const a=n.screenPositionToNDC(i.x,i.y,o.width,o.height),s=new t.Vector3(0,0,-1).applyQuaternion(o.pose.rotation),c=n.ndcToWorldPosition(o,new t.Vector2(a.x,a.y),1).normalize(),d=s.clone().setY(0).angleTo(c.clone().setY(0)),u=Math.asin(c.y-s.y),h=d*Math.sign(a.x),p=u;return n.rotateCamera(e,{xAngle:h,yAngle:p,zAngle:0,rotationSpeed:M})},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{r(d.next(e))}catch(e){t(e)}}function o(e){try{r(d.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof c?r:new c((function(e){e(r)}))).then(n,o)}r((d=d.apply(a,s||[])).next())}));var a,s,c,d}))})),e.addCommandCreator({namespace:"Camera",name:"lookAtScreenCoords",args:["x","y"]},(function(e={}){if(e.x=e.x||0,e.y=e.y||0,isNaN(e.x)||isNaN(e.y))throw new Error(`${JSON.stringify(e)} does not contain valid screen coordinates`);return new _({x:e.x,y:e.y})}))}(n,k,_n,new Tn(Ye,H,Ke)),function(e,n,o){o.getDependencies().then((([o,r,i,a])=>{const s=[{position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:t.TRANSITIONING}],c=(()=>{let t=0,d=!1;const u=()=>(n.getPose(s[0],o,r,i,a),s);return()=>{const n=Date.now(),o=t+100;if(n>o){d=!1,t=n;try{e.broadcast(F.MOVE,u)}catch(e){V.debug("failed to broadcast pose, one of the module dependencies are probably not loaded yet")}}else d||(setTimeout((()=>c()),o-n),d=!0)}})();o.onChanged(c),i.onChanged(c)})),e.addEnumToInterface({namespace:"Camera",name:"Event",values:F})}(n,_n,new Tn(H,le,Ke,Nn)),function(t,n,o){o.getDependencies().then((([t])=>n.addBinding(U,(o=>{return r=this,i=void 0,s=function*(){const r=o.direction;if(!z(e,o.direction))throw new Error(`${o.direction} is not a valid direction`);yield t.navigateInLocalDirection(n.directionConverter.toVector(r))},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function o(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,o)}c((s=s.apply(r,i||[])).next())}));var r,i,a,s})))),t.addEnumToInterface({namespace:"Camera",name:"Direction",values:e}),t.addCommandCreator({namespace:"Camera",name:"moveInDirection",args:["direction"]},(e=>new U(e||{})))}(n,_n,new Tn(ft)),function(e,t,n,o){o.getDependencies().then((([e,o])=>{n.addBinding(q,(n=>{return r=this,i=void 0,s=function*(){const r=o.pose.position,i=n.x-r.x,a=n.z-r.z,s=new t.Vector2(i,a),c=s.length();s.setLength(.005),yield e.startTranslateTransition(c/.005,s,!1)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function o(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,o)}c((s=s.apply(r,i||[])).next())}));var r,i,a,s}))})),e.addCommandCreator({namespace:"Camera",name:"pan",args:["position"]},(e=>{if((e=e||{}).position=e.position||{},e.position.x=e.position.x-0,e.position.z=e.position.z-0,isNaN(e.position.x)||isNaN(e.position.z))throw new Error(`${JSON.stringify(e)} does not contain a valid position to pan`);return new q({x:e.position.x,z:e.position.z})}))}(n,k,_n,new Tn(Ye,H)),function(e,t,n,o){const r=C.create(o,new Z,new S(Q,t,n.viewmodeConverter));e.addObservableToInterface({namespace:"Camera",name:"pose"},r)}(n,k,_n,new Tn(H,le,Ke,Nn)),function(e,t,n,o){const r=t.MathUtils.degToRad(80)/1e3;o.getDependencies().then((([e,t,o])=>{n.addBinding(J,(t=>ne(this,void 0,void 0,(function*(){return yield n.rotateCamera(e,t)})))),n.addBinding(te,(r=>ne(this,void 0,void 0,(function*(){return yield n.orientCamera(t,e,o,r)}))))}));const i=e=>{const n=(e=e||{}).options||{},o=t.MathUtils.degToRad(e.xAngle||0),i=t.MathUtils.degToRad(e.yAngle||0),a=t.MathUtils.degToRad(e.zAngle||0);let s=r;if(n.speed){if(isNaN(n.speed)||n.speed<=0)throw new Error(`${JSON.stringify(n)} does not contain valid rotation speed`);s=t.MathUtils.degToRad(n.speed)/1e3}if(isNaN(o)||isNaN(i)||isNaN(a))throw new Error(`${JSON.stringify(e)} does not contain valid rotation angles`);return{xAngle:o,yAngle:i,zAngle:a,rotationSpeed:s}};e.addCommandCreator({namespace:"Camera",name:"rotate",args:["xAngle","yAngle","options"]},(e=>new J(i(e)))),e.addCommandCreator({namespace:"Camera",name:"setRotation",args:["rotation","options"]},(e=>{const t=(e=e||{}).rotation||{};return new te(i({xAngle:t.x,yAngle:t.y,zAngle:t.z,options:e.options}))}))}(n,k,_n,new Tn(Ye,H,Ke)),function(e,t,n,o){const r=o,i=re.create(r,new S(ue,t,n)),a=re.create(r,new S(he,t,n)),s=re.create(r,new S(pe,t,n));e.addCommandToInterface({namespace:"Camera",name:"zoomTo",args:["zoomPct"]},i),e.addCommandToInterface({namespace:"Camera",name:"zoomBy",args:["zoomDelta"]},a),e.addCommandToInterface({namespace:"Camera",name:"zoomReset",args:[]},s)}(n,b,_n,new Tn(H,Ke,jt)),function(e,t,n){const o=C.create(n,new me,new S(fe,t));e.addObservableToInterface({namespace:"Camera",name:"zoom"},o)}(n,b,new Tn(H,Ke)),function(e,t,n){const o=C.create(n,new ge,new S(ve,t));e.addObservableToInterface({namespace:"Floor",name:"current"},o)}(n,b,new Tn($,le,H,Rn)),function(e,t,n,o){e.addEnumToInterface({namespace:"Floor",name:"Event",values:ye}),o.getDependencies().then((([o])=>{const r=[-1,-1];function i(e){if(o){const t=e.to?o.getFloor(e.to):null,n=e.from?o.getFloor(e.from):null;t&&(r[0]=t.index),n&&(r[1]=n.index)}return r}const a=[-1,""];function s(e){if(o){const t=e.floorId?o.getFloor(e.floorId):null;t&&(a[0]=t.index)}return a[1]=e.floorName,a}n.subscribe(t.StartMoveToFloorMessage,(t=>e.broadcast(ye.CHANGE_START,i,t))),n.subscribe(t.EndMoveToFloorMessage,(t=>e.broadcast(ye.CHANGE_END,s,t)))}))}(n,b,_n,new Tn(W)),function(e,t){const n=Te.create(t,new Ie,new S(Ee));e.addCollectionToInterface({namespace:"Floor",name:"data"},n)}(n,new Tn(W,Rn)),function(e,t,n){t.addBinding(Se,(()=>Ce(this,void 0,void 0,(function*(){const[e]=yield n.getDependencies();return function(e){return Ce(this,void 0,void 0,(function*(){try{const{currentFloor:t,totalFloors:n}=e,o=e.getFloorNames();return{currentFloor:t?t.index:-1,floorNames:o,totalFloors:n}}catch(e){throw Error("no floors currently loaded")}}))}(e)})))),e.addCommandCreator({namespace:"Floor",name:"getData",args:[]},(()=>new Se))}(n,_n,new Tn($)),function(e,t,n,o){o.getDependencies().then((([e])=>n.addBinding(be,(o=>{return r=this,i=void 0,s=function*(){if("number"!=typeof o.floorIndex||o.floorIndex<0)throw Error("floor index must be a non-negative number");try{const r="boolean"==typeof o.moveCamera&&!o.moveCamera,i=r?250:void 0;yield n.issueCommand(new t.MoveToFloorIndexCommand(o.floorIndex,r,i));const a=e.currentFloor;return a?a.index:-1}catch(e){throw Error(`Could not move to floor at index ${o.floorIndex}`)}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function o(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,o)}c((s=s.apply(r,i||[])).next())}));var r,i,a,s})))),e.addCommandCreator({namespace:"Floor",name:"moveTo",args:["floorIndex","moveCamera"]},(e=>new be(e)))}(n,b,_n,new Tn($)),function(e,t,n,o){const r=re.create(o,new S(xe,t,n));e.addCommandToInterface({namespace:"Floor",name:"showAll",args:["moveCamera"]},r)}(n,b,_n,new Tn($)),function(e,t,n){t.addBinding(Re,(()=>{return e=this,o=void 0,i=function*(){return t.makeLabelData(...yield n.getDependencies())},new((r=void 0)||(r=Promise))((function(t,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,o||[])).next())}));var e,o,r,i})),e.addCommandCreator({namespace:"Label",name:"getData",args:[]},(()=>new Re))}(n,_n,new Tn(H,W,K,Rn)),function(e,t,n,o){e.addEnumToInterface({namespace:"Label",name:"Event",values:Ne}),o.getDependencies().then((([o,r,i,a,s])=>{const c=()=>[n.makeLabelData(o,i,r,s)];o.onChanged((n=>{a.currentMode===t.Viewmode.Floorplan&&e.broadcast(Ne.POSITION_UPDATED,c,n)}))}))}(n,b,_n,new Tn(H,K,W,Ke,Rn)),function(e){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:Pe}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:Ae}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:De}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:Oe}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:r})}(n),et(n,k,b,_n,new Tn(W,ce,Je)),function(e,t,n,o){n.addBinding(tt,(()=>{return e=this,t=void 0,i=function*(){return o.getDependencies().then((([e,t,o])=>{try{const r=[];return e.iterate((e=>{const{id:i,index:a}=t.getFloor(e.floorId),s=o.getIdFromCwfId(i),c=e.mediaSrc,d=n.mediaConverter.fromTagChunkType(e.mediaType);r.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:nt(e.parsedDescription,n.chunkTypeConverter,n.linkTypeConverter),mediaSrc:c,mediaType:d,media:{type:d,src:c},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:a,floorIndex:a,floorInfo:{id:s,sequence:a},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),r}catch(e){throw Error("problem getting tag data")}}))},new((r=void 0)||(r=Promise))((function(n,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}));var e,t,r,i})),e.addCommandCreator({namespace:"Mattertag",name:"getData",args:[]},(()=>new tt))}(n,0,_n,new Tn(Y,W,Rn)),function(e,t,n,o){const r={},i={};n.addBinding(qe,(e=>ze(this,void 0,void 0,(function*(){const{iconId:o,iconSrc:a}=e;if(!a||"string"!=typeof a)throw Error("icon src is not a valid string");if(!o||"string"!=typeof o)throw Error("icon id is not a valid string");if(i[o])throw Error(o+" already has a registered icon");const s=new je(new Ve.RequestQueue);r[o]=new Promise(((e,r)=>{const c=".svg";if(a.indexOf(c,a.length-c.length)>-1)s.load(a).then((n=>{const r=new t.Texture(n);r.needsUpdate=!0,i[o]=r,e(r.image)}));else{const t=n.loadImage(a,(()=>{i[o]=t,e(t.image)}),(()=>r("Failed to load "+a)))}}))})))),n.addBinding(Be,(e=>ze(this,void 0,void 0,(function*(){const[n]=yield o.getDependencies(),{iconId:a,tagId:s}=e;if(!a||!r[a])throw Error(a+" has not been registered as valid icon id");if(!ke(s))throw new Ge(s);let c;try{c=yield r[a]}catch(e){throw Error(e)}const d=i[a],u=c.naturalWidth/c.naturalHeight,h=new t.Vector3;u>1?h.set(u,1,1):h.set(1,1/u,1),n.setOverrideMaterial(s,d,h)})))),n.addBinding(He,(e=>ze(this,void 0,void 0,(function*(){const[t]=yield o.getDependencies(),{tagId:n}=e;t.setOverrideMaterial(n,null,null)})))),e.addCommandCreator({namespace:"Mattertag",name:"registerIcon",args:["iconId","iconSrc"]},(e=>new qe(e))),e.addCommandCreator({namespace:"Mattertag",name:"editIcon",args:["tagId","iconId"]},(e=>new Be(e))),e.addCommandCreator({namespace:"Mattertag",name:"resetIcon",args:["tagId"]},(e=>new He(e)))}(n,k,_n,new Tn(st)),function(e,t,n,o,r){const i={[Oe.NONE]:n.TagDescriptionChunkType.none,[Oe.PHOTO]:n.TagDescriptionChunkType.photo,[Oe.VIDEO]:n.TagDescriptionChunkType.video,[Oe.RICH]:n.TagDescriptionChunkType.rich};r.getDependencies().then((()=>{o.addBinding(it,(e=>rt(this,void 0,void 0,(function*(){const t=e.tagId;if(!ke(t))throw new Ge(t);if(!e.properties)return;const r=e.properties[ot.LABEL],a=e.properties[ot.MEDIA],s=e.properties[ot.DESCRIPTION];if(null!=r&&"string"!=typeof r)throw Error("Mattertag.editBillboard only accepts a string for the title field");if(null!=s&&"string"!=typeof s)throw Error("Mattertag.editBillboard only accepts a string for the description field");if(null!=a){if("string"!=typeof a.src)throw Error("Mattertag.editBillboard only accepts a string for the media.src field");if(!z(Oe,a.type))throw Error("Mattertag.editBillboard only accepts a value from Mattertag.MediaType for the media.type field")}let c;a&&(c={mediaType:i[a.type],mediaSrc:a.src});const d={label:r,description:s};yield o.issueCommand(new n.EditMattertagCommand(e.tagId,d,c))})))),o.addBinding(at,(e=>rt(this,void 0,void 0,(function*(){const r=e.color;if(null!=r&&!Xe(r))throw Error("Mattertag.editColor only accepts a Color object of the form {r, g, b} for the color field");const i={color:(new t.Color).setRGB(r.r,r.g,r.b)};yield o.issueCommand(new n.EditMattertagCommand(e.tagId,i))}))))})),e.addCommandCreator({namespace:"Mattertag",name:"editBillboard",args:["tag","values"]},(e=>new it(e.tag,e.values))),e.addCommandCreator({namespace:"Mattertag",name:"editColor",args:["tag","color"]},(e=>new at(e.tag,e.color)))}(n,k,b,_n,new Tn(Y)),function(e,t){const n=re.create(t,new S(ct));e.addCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["sid","opacity"]},n)}(n,new Tn(Y,st)),function(e,t,n){const o=Te.create(n,new ht,new S(pt,t));e.addCollectionToInterface({namespace:"Mattertag",name:"data"},o)}(n,_n,new Tn(Y,W,Rn)),function(e,t){const n=re.create(t,new S(yt));e.addCommandToInterface(Object.assign({},lt),n)}(n,new Tn(Y)),function(e,t,n,o){let r;e.addCommandCreator({namespace:"Mattertag",name:"editPosition",args:["sid","options"]},(e=>{if(!r)throw Error("Edit command not bound yet");return r(e)}));const i=new t.Vector3,a=new t.Vector3;o.getDependencies().then((function([e,t,o]){r=({sid:r,options:s})=>{const{stemVector:c,anchorPosition:d}=s,u={};if(!ke(r))throw new Ge(r);const h=e.getTag(r);if(!h)throw Error(`${r} was not found in the mattertag data`);if(d&&(!We(d.x)||!We(d.y)||!We(d.z)))throw Error(`${d} is not a valid Vector3`);if(c&&(!We(c.x)||!We(c.y)||!We(c.z)))throw Error(`${c} is not a valid Vector3`);let p=t.getFloor(h.floorId);a.copy(h.anchorPosition),i.copy(h.anchorNormal),c&&(i.set(c.x,c.y,c.z),u.stemHeight=i.length(),i.normalize()),d&&(a.set(d.x,d.y,d.z),p=t.getFloorAtIndex(Qe(a,t,o)));const l=void 0!==s.floorIndex?s.floorIndex:s.floorId;if(void 0!==l&&(p=t.getFloorAtIndex(l)),!p)throw new Error(`Could not move Mattertag to invalid floor with index: ${l}`);return new n.EditMattertagCommand(r,u,void 0,{floorId:p.id,normal:i,position:a})}}))}(n,k,b,new Tn(Y,W,ce)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"navigateToTag",args:["sid","transitionType"]},(e=>{const o=e.transitionType?n.cameraTransitionConverter.fromSdkTransition(e.transitionType):t.CameraTransitionType.Interpolate;return new It(e.sid,o)})),n.addBinding(It,(e=>{return o=this,r=void 0,a=function*(){try{return yield n.issueCommand(new t.NavigateToMattertagCommand(e.sid,e.transition)),e.sid}catch(t){throw Error(`Could not move to tag with sid ${e.sid}`)}},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}))}(n,b,_n),function(e,t){const n=re.create(t,new S(Et));e.addCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["sid","prevent"]},n)}(n,new Tn(X)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"remove",args:["tags"]},(function(e){const n=[];if(!e.tags)throw Error("invalid list of tags to remove");if(e.tags instanceof Array){const o=e.tags,r=o.length;n.length=r;for(let e=0;e<o.length;++e)n[e]=new t.RemoveMattertagCommand(o[e])}else n.push(new t.RemoveMattertagCommand(e.tags));return new Ct(n)})),n.addBinding(Ct,(e=>{return t=this,o=void 0,i=function*(){const t=[],o=e.removeCommands;t.length=o.length;for(const e of o){const o=yield n.issueCommand(e);o&&t.push(o)}return t},new((r=void 0)||(r=Promise))((function(e,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i}))}(n,b,_n),function(e,t,n,o){o.getDependencies().then((([o])=>{const r=["",!1],i=e=>(r[0]=e.id,r[1]=e.hovering,r);n.subscribe(t.PinHoverChangeMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(Ae.HOVER,i,n)}));const a=[""],s=e=>(a[0]=e.id,a);n.subscribe(t.PinClickedMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(Ae.CLICK,s,n)}));const c=["",""],d=e=>(c[0]=o.openTag,c[1]=e.url,c);n.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast(Ae.LINK_OPEN,d,t)}))}))}(n,b,_n,new Tn(X)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"closeBillboards",args:["tag"]},(e=>new xt(e.tag))),n.getDependencies().then((([e])=>{t.addBinding(bt,(t=>St(this,void 0,void 0,(function*(){const n=t.tag;if(!ke(n))throw new Ge(n);e.openBillboard(n)}))))})),n.getDependencies().then((([e])=>{t.addBinding(xt,(t=>St(this,void 0,void 0,(function*(){const n=t.tag;if(!ke(n))throw new Ge(n);e.closeBillboard(t.tag)}))))}))}(n,_n,new Tn(dt)),function(e,t,n){t.addBinding(At,(()=>Nt(this,void 0,void 0,(function*(){const[e,t]=yield n.getDependencies();return((e,t)=>Nt(void 0,void 0,void 0,(function*(){const n=[];for(const o of e.groups()){const e=o.info,r=t.getFloor(e.floorId);for(let t=1;t<o.count-1;t++){const i=o.get(t-1),a=o.get(t);n.push({sid:e.sid,label:e.text,floor:r.index,start:{x:i.x,y:i.y,z:i.z},end:{x:a.x,y:a.y,z:a.z}})}}return n})))(e,t)})))),e.addCommandCreator({namespace:"Measurements",name:"getData",args:[]},(()=>new At))}(n,_n,new Tn(oe,W)),function(e,t,n){const o=Te.create(n,new Ot(t.MeasuringPhase),new S(Pt));e.addCollectionToInterface({namespace:"Measurements",name:"data"},o)}(n,b,new Tn(oe)),function(e,t){const n=C.create(t,new Dt,new S(Rt));e.addObservableToInterface({namespace:"Measurements",name:"mode"},n)}(n,new Tn(oe)),function(e,t,n){n.addBinding(_t,(e=>{return o=this,r=void 0,a=function*(){return n.issueCommand(new t.ToggleToolCommand(t.Tools.MEASUREMENTS,e.active))},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a})),e.addCommandCreator({namespace:"Measurements",name:"toggleMode",args:["active"]},(e=>new _t(e.active)))}(n,b,_n),function(e,t,n,o){e.addEnumToInterface({namespace:"Mode",name:"Event",values:Mt}),o.getDependencies().then((([o,r])=>{const i=[void 0,void 0],a=e=>{const t=r.currentMode,a=n.sweepUtils.isSweepAligned(o,e.fromSweep),s=n.sweepUtils.isSweepAligned(o,e.toSweep);return i[0]=n.viewmodeConverter.toSdk(t,a),i[1]=n.viewmodeConverter.toSdk(t,s),i};n.subscribe(t.EndMoveToSweepMessage,(t=>{n.sweepUtils.isSweepAligned(o,t.fromSweep)!==n.sweepUtils.isSweepAligned(o,t.toSweep)&&e.broadcast(Mt.CHANGE_END,a,t)}));const s=[void 0,void 0],c=e=>{const t=n.sweepUtils.isCurrentSweepAligned(o);return s[0]=n.viewmodeConverter.toSdk(e.fromMode,t),s[1]=n.viewmodeConverter.toSdk(e.toMode,t),s};n.subscribe(t.BeginSwitchViewmodeMessage,(t=>e.broadcast(Mt.CHANGE_START,c,t)));const d=[void 0,void 0],u=e=>{const t=n.sweepUtils.isCurrentSweepAligned(o);return d[0]=n.viewmodeConverter.toSdk(e.fromMode,t),d[1]=n.viewmodeConverter.toSdk(e.toMode,t),d};n.subscribe(t.EndSwitchViewmodeMessage,(t=>e.broadcast(Mt.CHANGE_END,u,t)))}))}(n,b,_n,new Tn(le,Ke)),function(e,t,n,o,i){o.addBinding(kt,(e=>{return t=this,r=void 0,a=function*(){try{e.options=e.options||{};let t=n.CameraTransitionType.Interpolate;const r=e.options.transition;return void 0===r||isNaN(r)||(t=r),yield o.issueCommand(new n.ChangeViewmodeCommand(e.mode,t,{position:e.options.position,rotation:e.options.rotation,zoom:e.options.zoom})),e.mode}catch(t){const n=t instanceof Ft?`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`:`Mode.moveTo -> Could not move to ${e.mode}`;if(Lt.error(t,n),t instanceof Ft)throw Error(`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`);throw Error(`Mode.moveTo -> Could not move to ${e.mode}`)}},new((i=void 0)||(i=Promise))((function(e,n){function o(e){try{c(a.next(e))}catch(e){n(e)}}function s(e){try{c(a.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,s)}c((a=a.apply(t,r||[])).next())}));var t,r,i,a}));const a=new Gt(t,n.CommandViewmode,o.conversionUtils,o.cameraTransitionConverter);e.addCommandCreator({namespace:"Mode",name:"moveTo",args:["mode","options"]},(e=>new kt(a.validateMoveToModeInput(e)))),e.addEnumToInterface({namespace:"Mode",name:"Mode",values:n.CommandViewmode}),e.addEnumToInterface({namespace:"Mode",name:"TransitionType",values:r})}(n,k,b,_n,new Tn),zt(n,_n,new Tn(ae,le,W,Nn)),Bt(n,b,_n,new Tn(ae,de)),function(e,t,n,o){e.addEnumToInterface({namespace:"Model",name:"Event",values:Ut});const r={sid:"",sweeps:[],modelSupportsVr:!1},i=[r];o.getDependencies().then((o=>{n.subscribe(t.ModelDataLoadedMessage,(t=>{e.broadcast(Ut.MODEL_LOADED,((e,t,o)=>a=>(n.makeModelData(a.sid,a.vrSupported,e.getSweepList(),t,o,r),i))(...o),t)}))}))}(n,b,_n,new Tn(le,W,Nn)),function(e,t,n,o){const r=C.create(o,new $t,new S(Kt,t,n));e.addEnumToInterface({namespace:"Pointer",name:"Colliders",values:Ht}),e.addObservableToInterface({namespace:"Pointer",name:"intersection"},r)}(n,k,b,new Tn(se,W,ce)),function(e,t,n,o,r){const i=new Yt(new t.Camera,o.encodeRenderTarget),a=new S(Zt,i,n,o),s=re.create(r,a),c=re.create(r,new S(ie,a,"Camera.takeScreenshot deprecated, please use Renderer.takeScreenshot"));e.addCommandToInterface({namespace:"Renderer",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},s),e.addCommandToInterface({namespace:"Camera",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},c)}(n,k,b,_n,new Tn(j,qt,wt)),function(e,t,n,o,r){const i=re.create(r,new S(Qt,t,n,o));e.addCommandToInterface({namespace:"Renderer",name:"takeEquirectangular",args:[]},i)}(n,k,b,_n,new Tn(qt,wt,Ke,le,Xt)),function(e,t,n,o){const r=re.create(o,new S(Jt,t,n));e.addCommandToInterface({namespace:"Renderer",name:"getScreenPosition",args:["worldPosition"]},r)}(n,b,_n,new Tn(qt)),function(e,t,n,o){const r=re.create(o,new S(tn,t,n));e.addCommandToInterface({namespace:"Renderer",name:"getWorldPositionData",args:["screenPosition","height","includeHiddenFloors"]},r)}(n,b,_n,new Tn(W,Ze)),function(e,t){const n=C.create(t,new nn,new S(on));e.addObservableToInterface({namespace:"Room",name:"current",objectFactory:"current.room"},n)}(n,new Tn(ce,H,le,W,Ke,Mn)),function(e,t){const n=Te.create(t,new rn,new S(an));e.addCollectionToInterface({namespace:"Room",name:"data",elementFactory:"collection.room"},n)}(n,new Tn(ce,W,Mn)),function(e){e.addEnumToInterface({namespace:"Scene",name:"InteractionType",values:en})}(n),function(e,t,n){t.addBinding(sn,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();return t.registerFactory(e.name,e.factory)},new((r=void 0)||(r=Promise))((function(e,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"register",args:["name","factory"]},(e=>new sn(e)))}(n,_n,new Tn(gt)),function(e,t,n){t.addBinding(cn,(()=>{return e=this,t=void 0,r=function*(){const[e]=yield n.getDependencies();return e.createNode()},new((o=void 0)||(o=Promise))((function(n,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}));var e,t,o,r})),e.addCommandCreator({namespace:"Scene",name:"createNode",args:["userContext"]},(e=>new cn(e)))}(n,_n,new Tn(gt)),function(e,t,n){t.addBinding(dn,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();return t.sceneTags().getObjects(e.tags)},new((r=void 0)||(r=Promise))((function(e,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"query",args:["tags"]},(e=>new dn(e)))}(n,_n,new Tn(gt,mt)),function(e,t,n,o){o.getDependencies().then((([e])=>{n.addBinding(un,(n=>{return o=this,r=void 0,a=function*(){n.callback(e.cwfRenderer.renderer,t,e.getScene().effectComposer)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}))})),e.addCommandCreator({namespace:"Scene",name:"configure",args:["callback"]},(e=>new un(e)))}(n,k,_n,new Tn(qt)),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(hn,(t=>{return n=this,o=void 0,i=function*(){return e.getSignedUrls().getImageBitmap(t.path,t.width,t.height,t.options)},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{c(i.next(e))}catch(e){t(e)}}function s(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i}))})),e.addCommandCreator({namespace:"Scene",name:"getImage",args:["path","width","height","options"]},(e=>new hn(e)))}(n,_n,new Tn(ut)),function(e,t,n){t.addBinding(pn,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();return t.deserialize(e.text)},new((r=void 0)||(r=Promise))((function(e,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"deserialize",args:["text"]},(e=>new pn(e)))}(n,_n,new Tn(gt)),function(e,t,n){t.addBinding(ln,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();return t.serialize(t.supportedSerializerVersions.V_2_0,e.objects)},new((r=void 0)||(r=Promise))((function(e,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"serialize",args:["objects"]},(e=>new ln(e)))}(n,_n,new Tn(gt)),function(e,t,n){t.addBinding(mn,(e=>{return t=this,o=void 0,i=function*(){if(!We(e.count))throw Error("count is not a valid number");const[t]=yield n.getDependencies(),o=[];for(let n=0;n<e.count;n++)o.push(t.createNode());return o},new((r=void 0)||(r=Promise))((function(e,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"createNodes",args:["count","userContext"]},(e=>new mn(e)))}(n,_n,new Tn(gt)),function(e,t,n){t.addBinding(fn,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();if(!Array.isArray(e.components))throw Error("components must be an array");for(const n of e.components)t.registerFactory(n.name,n.factory)},new((r=void 0)||(r=Promise))((function(e,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"registerComponents",args:["components"]},(e=>new fn(e)))}(n,_n,new Tn(gt)),function(e,t,n){t.addBinding(wn,(e=>{return t=this,o=void 0,i=function*(){if(!We(e.count))throw Error("count is not a valid number");const[t]=yield n.getDependencies(),o=[];for(let n=0;n<e.count;n++)o.push(t.createObject());return o},new((r=void 0)||(r=Promise))((function(e,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function s(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"createObjects",args:["count"]},(e=>new wn(e)))}(n,_n,new Tn(gt)),function(e,t,n){const o=new Map,r=new Map;return function(i,a){!function(e,t,n,o){const r=new Map,i=re.create(new Tn(t,n),new S(An)),a=re.create(new Tn(t,r),new S(On)),s=re.create(Tn.extend(o,t),new S(gn));e.addCommand("Sensor.addSource",i),e.addCommand("sensor.dispose",a),e.addCommand("sensor.showDebug",s);const c={[yn.CAMERA]:new Sn},d=re.create(Tn.extend(o,t,r),new S(Cn,e,c));e.addCommandToInterface(Object.assign({},In),d),e.addEnumToInterface({namespace:"Sensor",name:"SensorType",values:yn})}(i,o,r,a),function(e,t,n,o,r){const i=new Tn(t),a={[o.SPHERE]:new Bn,[o.BOX]:new Hn,[o.CYLINDER]:new jn},s=re.create(i,new S(qn,a));e.addCommand("Sensor.updateSource",s);const c={[Dn.SPHERE]:new Vn(o,r.sphere,n),[Dn.BOX]:new zn(o,r.box,n),[Dn.CYLINDER]:new Un(o,r.cylinder,n)},d=re.create(i,new S(Gn,c));e.addCommandToInterface(Object.assign({},Pn),d),e.addEnumToInterface({namespace:"Sensor",name:"SourceType",values:Dn})}(i,r,e,t,n)}}(k,b.SourceType,b.sensorVolumes)(n,new Tn(vt)),function(e,t,n,o){n.addBinding(t.SettingGetCommand,(e=>{return t=this,n=void 0,i=function*(){const[t]=yield o.getDependencies();return t.tryGetProperty(e.key,void 0)},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,n||[])).next())}));var t,n,r,i})),e.addCommandCreator({namespace:"Settings",name:"get",args:["key"]},(e=>new t.SettingGetCommand(e.key)))}(n,b,_n,new Tn(Tt)),function(e,t,n,o){n.addBinding(t.SettingUpdateCommand,(e=>{return t=this,n=void 0,i=function*(){if(!e.key||"string"!=typeof e.key)throw Error("Settings: invalid key");const[t]=yield o.getDependencies();return t.updateSetting(e.key,e.value),t.tryGetProperty(e.key,void 0)},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((i=i.apply(t,n||[])).next())}));var t,n,r,i})),e.addCommandCreator({namespace:"Settings",name:"update",args:["key","value"]},(e=>new t.SettingUpdateCommand(e.key,e.value)))}(n,b,_n,new Tn(Tt)),function(e,t,n){n.getDependencies().then((([n])=>{new Yn(t.waitForUpdate,n).calcAndBroadcast(e)})),e.addEnumToInterface({namespace:"Stat",name:"Event",values:Wn})}(n,_n,new Tn(de)),function(e){e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:r}),e.addEnumToInterface({namespace:"Sweep",name:"Alignment",values:$n}),e.addEnumToInterface({namespace:"Sweep",name:"Placement",values:Kn})}(n),function(e,t,n,o){const r=C.create(o,new Jn,new S(eo,t,n));e.addObservableToInterface({namespace:"Sweep",name:"current"},r)}(n,b,_n,new Tn(le,Ke,W,Nn,Rn)),function(e,t,n,o){e.addEnumToInterface({namespace:"Sweep",name:"Event",values:Zn});const r=["",""],i=()=>r;n.subscribe(t.BeginMoveToSweepMessage,(t=>no(this,void 0,void 0,(function*(){const n=yield o;t.fromSweep&&t.fromSweep!==t.toSweep&&(r[0]=t.fromSweep?n.getIdFromCwfId(t.fromSweep):t.fromSweep,r[1]=n.getIdFromCwfId(t.toSweep),e.broadcast(Zn.EXIT,i,t))})))),n.subscribe(t.BeginSwitchViewmodeMessage,(n=>{n.fromMode===t.Viewmode.Panorama&&n.toMode!==t.Viewmode.Panorama&&(r[0]=a[1],r[1]=void 0,e.broadcast(Zn.EXIT,i))}));const a=["",""],s=()=>a;n.subscribe(t.EndMoveToSweepMessage,(t=>no(this,void 0,void 0,(function*(){const n=yield o;a[0]=t.fromSweep?n.getIdFromCwfId(t.fromSweep):t.fromSweep,a[1]=n.getIdFromCwfId(t.toSweep),e.broadcast(Zn.ENTER,s)}))))}(n,b,_n,Nn),function(e,t,n,o){const i=re.create(o,new S(oo,t,n));e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:r}),e.addCommandToInterface({namespace:"Sweep",name:"moveTo",args:["sweep","options"]},i)}(n,b,_n,new Tn(le,Nn)),function(e,t,n){const o=Te.create(n,new ro,new S(io,t.conversionUtils,t.sweepPlacementConverter));e.addCollectionToInterface({namespace:"Sweep",name:"data"},o)}(n,_n,new Tn(le,W,Nn,Rn)),function(e,t){const n=re.create(t,new S(so)),o=re.create(t,new S(co));e.addCommandToInterface({namespace:"Sweep",name:"enable",args:["sweepIds"],varArg:!0},n),e.addCommandToInterface({namespace:"Sweep",name:"disable",args:["sweepIds"],varArg:!0},o)}(n,new Tn(le,Ue,Nn)),function(e,t,n){e.addEnumToInterface({namespace:"Tour",name:"Event",values:to}),n.subscribe(t.TourStartedMessage,(()=>e.broadcast(to.STARTED))),n.subscribe(t.TourStoppedMessage,(()=>e.broadcast(to.STOPPED))),n.subscribe(t.TourEndedMessage,(()=>e.broadcast(to.ENDED)));const o=[-1],r=e=>(o[0]=e.index,o);n.subscribe(t.TourSteppedMessage,(t=>e.broadcast(to.STEPPED,r,t)))}(n,b,_n),function(e,t,n,o){!function(e,t,n){t.addBinding(yo,(()=>vo(this,void 0,void 0,(function*(){return n.getDependencies().then((([n,o])=>vo(this,void 0,void 0,(function*(){const n=yield Promise.all(o.getEnabledSnapshots().map((n=>function(e,t,n){return vo(this,void 0,void 0,(function*(){let o=n.viewmodeConverter.toSdk(e.metadata.cameraMode);if(!o||o===n.commandModeConverter.toSdk(t.CommandViewmode.TRANSITIONING))throw Error("Failed to convert snapshot, invalid viewmode");return o===n.commandModeConverter.toSdk(t.CommandViewmode.INSIDE)&&e.is360&&(o=n.commandModeConverter.toSdk(t.CommandViewmode.OUTSIDE)),{sid:e.sid,thumbnailUrl:yield e.thumbnailUrl.get(),imageUrl:yield e.imageUrl.get(),is360:e.is360,name:e.name,mode:o,zoom:e.metadata.ssZoom,position:e.metadata.cameraPosition,rotation:n.conversionUtils.quaternionToRotation(e.metadata.cameraQuaternion)}}))}(n,e,t))));if(0===n.length)throw Error("No tour data found");return n}))))}))))}(t,n,o),e.addCommandCreator({namespace:"Tour",name:"getData",args:[]},(()=>new yo));const r=o,i=re.create(r,new S(mo)),a=re.create(r,new S(fo)),s=re.create(r,new S(wo)),c=re.create(r,new S(go,!0)),d=re.create(r,new S(go,!1));e.addCommandToInterface({namespace:"Tour",name:"start",args:["index"]},i),e.addCommandToInterface({namespace:"Tour",name:"stop",args:[]},a),e.addCommandToInterface({namespace:"Tour",name:"step",args:["index"]},s),e.addCommandToInterface({namespace:"Tour",name:"prev",args:[]},c),e.addCommandToInterface({namespace:"Tour",name:"next",args:[]},d)}(n,b,_n,new Tn(Vt,$e))}}(),o}()}));