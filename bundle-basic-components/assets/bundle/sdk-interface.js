/*! For license information please see sdk-interface.js.LICENSE.txt */
!function(e,t){for(var n in t)e[n]=t[n];t.__esModule&&Object.defineProperty(e,"__esModule",{value:!0})}(this,function(){var e={277:function(e,t,n){var o,r,i;i=function(){var e,t,n=document,o=n.getElementsByTagName("head")[0],r={},i={},s={},a={};function c(e,t){for(var n=0,o=e.length;n<o;++n)if(!t(e[n]))return!1;return 1}function d(e,t){c(e,(function(e){return t(e),1}))}function u(t,n,o){t=t.push?t:[t];var l=n&&n.call,p=l?n:o,m=l?t.join(""):n,f=t.length;function g(e){return e.call?e():r[e]}function w(){if(!--f)for(var e in r[m]=1,p&&p(),s)c(e.split("|"),g)&&!d(s[e],g)&&(s[e]=[])}return setTimeout((function(){d(t,(function t(n,o){return null===n?w():(o||/^https?:\/\//.test(n)||!e||(n=-1===n.indexOf(".js")?e+n+".js":e+n),a[n]?(m&&(i[m]=1),2==a[n]?w():setTimeout((function(){t(n,!0)}),0)):(a[n]=1,m&&(i[m]=1),void h(n,w)))}))}),0),u}function h(e,r){var i,s=n.createElement("script");s.onload=s.onerror=s.onreadystatechange=function(){s.readyState&&!/^c|loade/.test(s.readyState)||i||(s.onload=s.onreadystatechange=null,i=1,a[e]=2,r())},s.async=1,s.src=t?e+(-1===e.indexOf("?")?"?":"&")+t:e,o.insertBefore(s,o.lastChild)}return u.get=h,u.order=function(e,t,n){!function o(r){r=e.shift(),e.length?u(r,o):u(r,t,n)}()},u.path=function(t){e=t},u.urlArgs=function(e){t=e},u.ready=function(e,t,n){e=e.push?e:[e];var o,i=[];return!d(e,(function(e){r[e]||i.push(e)}))&&c(e,(function(e){return r[e]}))?t():(o=e.join("|"),s[o]=s[o]||[],s[o].push(t),n&&n(i)),u},u.done=function(e){u([null],e)},u},e.exports?e.exports=i():void 0===(r="function"==typeof(o=i)?o.call(t,n,t,e):o)||(e.exports=r)},371:function(e,t,n){"use strict";var o,r,i,s,a,c,d,u;n.r(t),n.d(t,{setup:function(){return Po}}),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(o||(o={}));class h{constructor(e){this.directionMap={[o.FORWARD]:e.FORWARD.clone(),[o.LEFT]:e.LEFT.clone(),[o.RIGHT]:e.RIGHT.clone(),[o.BACK]:e.BACK.clone(),[o.UP]:e.UP.clone(),[o.DOWN]:e.DOWN.clone()}}toVector(e){return this.directionMap[e]}}!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(r||(r={}));class l{constructor(e){this.toSdkTransitionMap={[e.Interpolate]:r.FLY,[e.FadeToBlack]:r.FADEOUT,[e.Instant]:r.INSTANT},this.fromSdkTransitionMap={[r.FLY]:e.Interpolate,[r.FADEOUT]:e.FadeToBlack,[r.INSTANT]:e.Instant}}toSdkTransition(e){return this.toSdkTransitionMap[e]}fromSdkTransition(e){return this.fromSdkTransitionMap[e]}}!function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(i||(i={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(s||(s={}));class p{constructor(e,t){this.toSdkAlignmentMap={[e.ALIGNED]:i.ALIGNED,[e.UNALIGNED]:i.UNALIGNED},this.toSdkPlacementMap={[t.UNPLACED]:s.UNPLACED,[t.AUTO]:s.AUTO,[t.MANUAL]:s.MANUAL}}toSdkAlignment(e){return this.toSdkAlignmentMap[e]}toSdkPlacement(e){return this.toSdkPlacementMap[e]}}!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(a||(a={}));class m{constructor(e){this.CwfViewmode=e}toSdk(e,t){switch(e){case this.CwfViewmode.Panorama:return t?a.INSIDE:a.OUTSIDE;case this.CwfViewmode.Dollhouse:return a.DOLLHOUSE;case this.CwfViewmode.Floorplan:return a.FLOORPLAN;case this.CwfViewmode.Transition:return a.TRANSITIONING;case this.CwfViewmode.Outdoor:return a.OUTSIDE;default:return a.INSIDE}}fromSdk(e){switch(e){case a.INSIDE:case a.OUTSIDE:return this.CwfViewmode.Panorama;case a.DOLLHOUSE:return this.CwfViewmode.Dollhouse;case a.FLOORPLAN:return this.CwfViewmode.Floorplan;case a.TRANSITIONING:return this.CwfViewmode.Transition}}}class f{constructor(e){this.CommandMode=e}toSdk(e,t){switch(e){case this.CommandMode.INSIDE:return t?a.INSIDE:a.OUTSIDE;case this.CommandMode.DOLLHOUSE:return a.DOLLHOUSE;case this.CommandMode.FLOORPLAN:return a.FLOORPLAN;case this.CommandMode.TRANSITIONING:return a.TRANSITIONING;case this.CommandMode.OUTSIDE:return a.OUTSIDE;default:return a.INSIDE}}fromSdk(e){switch(e){case a.INSIDE:return this.CommandMode.INSIDE;case a.OUTSIDE:return this.CommandMode.OUTSIDE;case a.DOLLHOUSE:return this.CommandMode.DOLLHOUSE;case a.FLOORPLAN:return this.CommandMode.FLOORPLAN;case a.TRANSITIONING:return this.CommandMode.TRANSITIONING}}}class g{constructor(e){this.THREE=e,this.tempEuler=new e.Euler}quaternionToRotation(e,t){const n=this.tempEuler.setFromQuaternion(e,g.eulerOrder),o=t||{};return o.x=this.THREE.MathUtils.radToDeg(n.x),o.y=this.THREE.MathUtils.radToDeg(n.y),o.z=this.THREE.MathUtils.radToDeg(n.z),o}rotationToQuaternion(e,t){const n=t||new this.THREE.Quaternion;return this.tempEuler.x=this.THREE.MathUtils.degToRad(e.x),this.tempEuler.y=this.THREE.MathUtils.degToRad(e.y),this.tempEuler.z=this.THREE.MathUtils.degToRad(e.z||0),this.tempEuler.order=g.eulerOrder,n.setFromEuler(this.tempEuler)}}g.eulerOrder="YXZ";class w{constructor(e){this.CwfSweepAlignmentType=e}isSweepAligned(e,t){if(!e||!t)return!1;const n=t&&e.getSweep(t);return!!n&&n.alignmentType===this.CwfSweepAlignmentType.ALIGNED}isCurrentSweepAligned(e){return this.isSweepAligned(e,e.currentSweep)}}!function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(c||(c={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(d||(d={}));class v{constructor(e){this.toSdkPhaseMap={[e.UNINITIALIZED]:d.UNINITIALIZED,[e.WAITING]:d.WAITING,[e.LOADING]:d.LOADING,[e.STARTING]:d.STARTING,[e.PLAYING]:d.PLAYING,[e.ERROR]:d.ERROR},this.fromSdkPhaseMap={[d.UNINITIALIZED]:e.UNINITIALIZED,[d.WAITING]:e.WAITING,[d.LOADING]:e.LOADING,[d.STARTING]:e.STARTING,[d.PLAYING]:e.PLAYING,[d.ERROR]:e.ERROR}}toSdkAppPhase(e){return this.toSdkPhaseMap[e]}fromSdkAppPhase(e){return this.fromSdkPhaseMap[e]}}class y{constructor(e){this.toSdkApplicationMap={[e.SHOWCASE]:c.SHOWCASE,[e.WORKSHOP]:c.WORKSHOP,[e.WEBVR]:c.WEBVR,[e.UNKNOWN]:c.UNKNOWN},this.fromSdkApplicationMap={[c.SHOWCASE]:e.SHOWCASE,[c.WORKSHOP]:e.WORKSHOP,[c.WEBVR]:e.WEBVR,[c.UNKNOWN]:e.UNKNOWN}}toSdkApplication(e){return this.toSdkApplicationMap[e]}fromSdkApplication(e){return this.fromSdkApplicationMap[e]}}!function(e){e.PHASE_CHANGE="application.phasechange",e.APP_CHANGE="application.appchange"}(u||(u={}));class T{constructor(e,t,n){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=n.create(),this.freshDataCache=n.create()}static create(e,t,n){return o=this,r=void 0,s=function*(){const o=yield e.getDependencies();return new T(o,t,n)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class t{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}this.observers.add(e),1===this.observers.size&&(this.currentData.update(...this.dependencies),this.changeSubscription=this.subscriptionFactory.create(new t(this),...this.dependencies)),e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&this.changeSubscription.cancel())}onChanged(){if(this.freshDataCache.update(...this.dependencies),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}class E{constructor(e,...t){this.ctor=e,this.args=t}create(){return new this.ctor(...this.args)}}const C=(e,t=[])=>{if(void 0!==e){if(e in t)return{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if("object"==typeof e){const o=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const r in e){if("propertyObservers"===(n=r)||"changeObservers"===n||"isObservable"===n||"childChangeFunctions"===n||"isObservableProxy"===n||"diffRoot"===n||"elementChangedHandlers"===n||"knownKeysMap"===n||"knownKeysList"===n||"isVector2"===n||"isVector3"===n||"isQuaternion"===n||"onPropertyChanged"===n||"removeOnPropertyChanged"===n||"onChanged"===n||"target"===n)continue;const i=e[r];i instanceof Date?o[r]=new Date(i):"function"!=typeof i&&(o[r]="object"==typeof i?C(i,t.concat(e)):i)}return o}return e}var n},I=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const n in t)if(!(n in e))return!0;for(const n in e)if(I(e[n],t[n]))return!0;return!1};class S{create(e,t){return t.onChanged((()=>e.onChanged()))}}class b{constructor(e,t){this._data={phase:d.UNINITIALIZED,phaseTimes:{},application:c.SHOWCASE},this.AppPhase=e.AppPhase,this.appPhaseConverter=t.appPhaseConverter,this.applicationConverter=t.applicationConverter}get data(){return this._data}equals(e){return!I(this,e)}copy(e){this._data.phase=e.data.phase,function(e,t,...n){for(const o of n)e[o]=t[o]}(this.data.phaseTimes,e.data.phaseTimes),this._data.application=e.data.application}update(e){this._data.phase=this.appPhaseConverter.toSdkAppPhase(e.phase),this._data.application=this.applicationConverter.toSdkApplication(e.application),this._data.phaseTimes[d.WAITING]=e.phaseTimes[this.AppPhase.WAITING],this._data.phaseTimes[d.LOADING]=e.phaseTimes[this.AppPhase.LOADING],this._data.phaseTimes[d.PLAYING]=e.phaseTimes[this.AppPhase.PLAYING],this._data.phaseTimes[d.STARTING]=e.phaseTimes[this.AppPhase.STARTING],this._data.phaseTimes[d.UNINITIALIZED]=e.phaseTimes[this.AppPhase.UNINITIALIZED],this._data.phaseTimes[d.ERROR]=e.phaseTimes[this.AppPhase.ERROR]}}class x{}class N extends x{constructor(){super(),this.id="GET_APP_STATE"}}class O extends x{constructor(){super(),this.id="GET_APP_PHASE_TIMES"}}class A extends x{constructor(){super(),this.id="GET_POSE"}}const D=40*Math.PI/180/1e3;class P extends x{constructor(e){super(),this.payload=e}}var M;!function(e){e.MOVE="camera.move"}(M||(M={}));const R=window.navigationStart||Date.now();var _;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(_||(_={}));class L{constructor(e){this.timers={},this.handlers={[_.DEBUG]:console.debug,[_.INFO]:console.info,[_.WARN]:console.warn,[_.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){return L.level>=e&&console?(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix()):()=>{}}get debug(){return this.message(_.DEBUG)}get debugWarn(){return this.message(L.level>=_.DEBUG?_.WARN:__PRODUCTION__?_.DEBUG:_.INFO)}get info(){return this.message(_.INFO)}get warn(){return this.message(_.WARN)}get error(){return this.message(_.ERROR)}time(e){L.level>=_.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(L.level>=_.DEBUG){const t=this.timers[e];if(!t)return;const n=(Date.now()-t)/1e3;this.debug(e,n+"s")}}getPrefix(){const e=(Date.now()-R)/1e3+"s";return`${this.prefix} ${e}`}}L.level=_.INFO;const k=new L("broadcast.move");function G(e,t){return Object.values(e).includes(t)}class V extends x{constructor(e){super(),this.id="MOVE_DIRECTION",this.payload=e}}class z extends x{constructor(e){super(),this.id="PAN",this.payload={x:e.x,z:e.z}}}class F{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}function U(e,t){e.x=t.x,e.y=t.y}function H(e,t){U(e,t),e.z=t.z}class B extends Error{constructor(e){super(e),this.name="BaseException",Object.setPrototypeOf(this,new.target.prototype)}}class j extends B{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}const q=(e,t,n=1e-5)=>Math.abs(e-t)<=n,W=(e,t,n=1e-5)=>q(e.x,t.x,n)&&q(e.y,t.y,n),$=(e,t,n=1e-5)=>W(e,t,n)&&q(e.z,t.z,n);class K{create(e,t,n,o){const r=()=>e.onChanged();return new F(t.onChanged(r),n.onChanged(r),o.onChanged(r))}}class X{constructor(e,t){this._data={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:a.TRANSITIONING},this.THREE=e,this.viewmodeConverter=t,this.tempEuler=new e.Euler}get data(){return this._data}equals(e){const t=1e-5;return $(e._data.position,this._data.position,t)&&W(e._data.rotation,this._data.rotation,t)&&((e,t,n=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,o)=>!q(e,t[o],n))))(e._data.projection,this._data.projection,t)&&e._data.sweep===this._data.sweep&&e._data.mode===this._data.mode}update(e,t,n){const o=this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ"),r=t.currentSweep&&t.isSweepUnaligned(t.currentSweep);H(this._data.position,e.pose.position),this._data.rotation.x=this.THREE.MathUtils.radToDeg(o.x),this._data.rotation.y=this.THREE.MathUtils.radToDeg(o.y),this._data.projection=Float32Array.from(e.pose.projection.asThreeMatrix4().transpose().elements),this._data.sweep=t.currentSweep,this._data.mode=this.viewmodeConverter.toSdk(n.currentMode,!r)}copy(e){H(this._data.position,e.data.position),U(this._data.rotation,e.data.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new j;const n=t.length;for(let o=0;o<n;++o)e[o]=t[o]}(this._data.projection,e.data.projection),this._data.sweep=e.data.sweep,this._data.mode=e.data.mode}}class Z extends x{constructor(e){super(),this.id="ROTATE",this.payload={xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,rotationSpeed:e.rotationSpeed}}}function Y(e,t,n){const o=new e.Euler,r=new e.Euler;return function(e,i,s,a){return c=this,d=void 0,h=function*(){if(s.currentMode!==t.Panorama)throw Error("Camera.setRotation is only available in Panorama mode");const c=a.xAngle%(.5*Math.PI),d=a.yAngle%(2*Math.PI),u=e.pose.rotation;o.setFromQuaternion(u,"YXZ");let h=d-o.y;return Math.abs(h)>Math.PI&&(h-=2*Math.sign(h)*Math.PI),r.set(c-o.x,h,0,"YXZ"),r.y%=2*Math.PI,n(i,{xAngle:-r.y,yAngle:r.x,zAngle:0,rotationSpeed:a.rotationSpeed})},new((u=void 0)||(u=Promise))((function(e,t){function n(e){try{r(h.next(e))}catch(e){t(e)}}function o(e){try{r(h.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof u?r:new u((function(e){e(r)}))).then(n,o)}r((h=h.apply(c,d||[])).next())}));var c,d,u,h}}class Q extends Z{}var J=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const ee=new L("sdk command");class te{constructor(e,t){this.dependencies=e,this.executor=t.create()}static create(e,t){return n=this,o=void 0,i=function*(){const n=yield e.getDependencies();return new te(n,t)},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i}exec(e,t){const n=this.executor.validateInput(e,...this.dependencies);this.executor.exec(n,t,...this.dependencies)}}class ne{constructor(e,t){this.deprecationWarning=t,this.executor=e.create()}validateInput(e,...t){return ee.warn(this.deprecationWarning),this.executor.validateInput(e,...t)}exec(e,t,...n){this.executor.exec(e,t,...n)}}const oe=function(e,t,n){return Math.max(t,Math.min(e,n))};function re(e,t,n){return t<=e&&e<=n}var ie=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const se=new L("command.zoom");class ae{constructor(e,t){this.Viewmode=e.Viewmode,this.ZoomSetCommand=e.ZoomSetCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomPct-0;if(isNaN(t))throw Error(t+" is not a valid zoom level");return t<.7&&3<t&&(e.zoomPct=oe(t,.7,3),se.warn(t,"is outside the valid zoom range of [0.7, 3]")),e}exec(e,t,n,o){return ie(this,void 0,void 0,(function*(){ue(this.Viewmode,o.currentMode),yield this.issueCommand(new this.ZoomSetCommand(e.zoomPct)),t.return(n.zoom())}))}}class ce{constructor(e,t){this.Viewmode=e.Viewmode,this.ZoomInCommand=e.ZoomInCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomDelta-0;if(isNaN(t))throw Error(t+" is not a valid zoom delta");return e.zoomDelta=t||0,e}exec(e,t,n,o){return ie(this,void 0,void 0,(function*(){ue(this.Viewmode,o.currentMode),yield this.issueCommand(new this.ZoomInCommand(e.zoomDelta)),t.return(n.zoom())}))}}class de{constructor(e,t){this.Viewmode=e.Viewmode,this.ZoomResetCommand=e.ZoomResetCommand,this.issueCommand=t.issueCommand}validateInput(e){return e}exec(e,t,n,o){return ie(this,void 0,void 0,(function*(){ue(this.Viewmode,o.currentMode),yield this.issueCommand(new this.ZoomResetCommand),t.return()}))}}function ue(e,t){if(t!==e.Panorama)throw Error("Zoom controls are currently only supported in Panorama mode")}class he{create(e,t){return t.onChanged((()=>e.onChanged()))}}class le{constructor(e){this._data={level:1},this.Viewmode=e.Viewmode}get data(){return this._data}equals(e){return this._data.level===e.data.level}copy(e){this._data.level=e.data.level}update(e,t){t.currentMode===this.Viewmode.Panorama&&(this._data.level=e.zoom())}}function pe(e,t){const n=new e.Euler;return function(o,r,i,s){const a=n.setFromQuaternion(r.pose.rotation,"YXZ"),c=i.currentSweep&&i.isSweepUnaligned(i.currentSweep);return o.position.x=r.pose.position.x,o.position.y=r.pose.position.y,o.position.z=r.pose.position.z,o.rotation.x=e.MathUtils.radToDeg(a.x),o.rotation.y=e.MathUtils.radToDeg(a.y),o.projection=Float32Array.from(r.pose.projection.asThreeMatrix4().transpose().elements),o.sweep=i.currentSweep,o.mode=t.toSdk(s.currentMode,!c),o}}class me{constructor(){this.wasInTransition=!1,this.currentFloor=""}create(e,t,n,o){return new F(t.onChanged((()=>this.throttleCurrentFloorChanges(e,t))),o.onChanged((()=>this.throttleCameraTranstionChanges(e,o,n))),n.onChanged((()=>this.throttleCameraTranstionChanges(e,o,n))))}throttleCameraTranstionChanges(e,t,n){const o=t.transition.active||n.transition.active;o!==this.wasInTransition&&(this.wasInTransition=o,e.onChanged())}throttleCurrentFloorChanges(e,t){const n=t.currentFloorId;n!==this.currentFloor&&(this.currentFloor=n,e.onChanged())}}class fe{constructor(e){this._data={id:void 0,sequence:void 0,name:""},this.SweepAlignmentType=e.SweepAlignmentType,this.SweepPlacementType=e.SweepPlacementType}get data(){return this._data}equals(e){const t=this.data,n=e.data;return t.id===n.id&&t.sequence===n.sequence&&t.name===n.name}copy(e){this._data.id=e.data.id,this._data.sequence=e.data.sequence,this._data.name=e.data.name}update(e,t,n){const o=e.currentFloor,r=t.currentSweep&&t.getSweep(t.currentSweep);n.transition.active&&!t.transitionActive||function(){if(t.transitionActive&&t.transition.to&&t.transition.from){const e=t.getSweep(t.transition.to),n=t.getSweep(t.transition.from);return e.floorId!==n.floorId}return!1}()?(this._data.id="",this._data.sequence=void 0,this._data.name=""):r&&r.alignmentType===this.SweepAlignmentType.UNALIGNED&&r.placementType===this.SweepPlacementType.UNPLACED?(this._data.id=void 0,this._data.sequence=void 0,this._data.name=""):o?(this._data.id=o.id,this._data.sequence=o.index,this._data.name=o.name):(this._data.id="",this._data.sequence=-1,this._data.name="all")}}var ge;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(ge||(ge={}));class we{constructor(e,t,n){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=n.create(),this.freshData=n.create()}static create(e,t,n){return o=this,r=void 0,s=function*(){const o=yield e.getDependencies();return new we(o,t,n)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}getData(){return this.currentData.data}observe(e){return this.addObserver(e),new class{constructor(e){this.sdkCollection=e,this.renew()}renew(){this.sdkCollection.addObserver(e)}cancel(){this.sdkCollection.removeObserver(e)}}(this)}addObserver(e){class t{constructor(e){this.sdkCollection=e}onChanged(){const{freshData:e,currentData:t,dependencies:n}=this.sdkCollection;e.update(...n);let o=!1;for(const n in e.data)if(t.data.hasOwnProperty(n)){if(!t.isItemEqual(e,n))for(const t of this.sdkCollection.observers)t.onUpdated(n,e.data[n]),o=!0}else for(const t of this.sdkCollection.observers)t.onAdded(n,e.data[n]),o=!0;for(const n in t.data)if(!e.data.hasOwnProperty(n))for(const e of this.sdkCollection.observers)e.onRemoved(n),o=!0;if(o)for(const e of this.sdkCollection.observers)e.onCollectionUpdated();const r=t;this.sdkCollection.currentData=this.sdkCollection.freshData,this.sdkCollection.freshData=r}}if(!this.observers.has(e))if(this.observers.add(e),1===this.observers.size){const e=new t(this);this.changeSubscription=this.subscriptionFactory.create(e,...this.dependencies),e.onChanged()}else for(const t in this.currentData.data)e.onAdded(t,this.currentData.data[t])}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&(this.changeSubscription.cancel(),this.currentData.clear()))}}class ve{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ye{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],o=e.data[t];return n.id===o.id&&n.name===o.name&&n.sequence===o.sequence}update(e){for(const t of e.getCollection()){const e=this._data[t.id]||{};e.id=t.id,e.sequence=t.index,e.name=t.name,this._data[t.id]=e}for(const t in this.data)e.getFloor(t)||delete this._data[t]}clear(){this._data={}}}var Te=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class Ee extends x{constructor(){super(...arguments),this.id="GET_FLOORS_DATA"}}class Ce extends x{constructor(e){super(),this.id="MOVE_TO_FLOOR",this.payload=e}}class Ie{constructor(e,t){this.issueCommand=t.issueCommand,this.ShowAllFloorsCommand=e.ShowAllFloorsCommand}validateInput(e){return e}exec(e,t,n){return o=this,r=void 0,s=function*(){try{yield this.issueCommand(new this.ShowAllFloorsCommand({moveCamera:!0}));const e=n.currentFloor;t.return(e?e.index:-1)}catch(e){t.throw("Could not show all floors")}},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}}var Se,be,xe,Ne,Oe,Ae,De;class Pe extends x{constructor(){super(...arguments),this.id="LABEL_GET"}}function Me(e,t){return function(n,o,r){const i=r.getCollection(),s=[],a=new e.Vector2;for(const r of i){t(n,r.position,a);const{id:i,index:c}=o.getFloor(r.floorId),d=C(r);s.push(Object.assign(Object.assign({},d),{position:(new e.Vector3).copy(r.position),screenPosition:a,floor:c,floorInfo:{id:i,sequence:c}}))}return s}}!function(e){e.VISIBILITY_CHANGED="label.visibilitychange",e.POSITION_UPDATED="label.positionupdated"}(Se||(Se={})),function(e){e.text="text",e.link="link",e.photo="photo",e.video="video",e.rich="rich",e.none="none",e.error="error"}(be||(be={})),function(e){e.parse=t=>null!==t&&t in e?e[t]:e.none}(be||(be={})),function(e){e[e.NAVIGATION=0]="NAVIGATION",e[e.MODEL=1]="MODEL",e[e.EXT_LINK=2]="EXT_LINK"}(xe||(xe={})),xe.NAVIGATION,xe.MODEL,xe.EXT_LINK,function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(Ne||(Ne={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(Oe||(Oe={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(Ae||(Ae={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(De||(De={}));class Re{constructor(e){this.toSdkMediaMap={[e.PHOTO]:Oe.PHOTO,[e.VIDEO]:Oe.VIDEO,[e.RICH]:Oe.RICH},this.toSdkMediaFromChunk={[be.error]:Oe.NONE,[be.link]:Oe.NONE,[be.none]:Oe.NONE,[be.photo]:Oe.PHOTO,[be.rich]:Oe.RICH,[be.text]:Oe.NONE,[be.video]:Oe.VIDEO}}toSdkMedia(e){return this.toSdkMediaMap[e]}fromTagChunkType(e){return this.toSdkMediaFromChunk[e]}}class _e{constructor(){this.toSdkChunkTypeMap={[be.error]:Ae.NONE,[be.link]:Ae.LINK,[be.none]:Ae.NONE,[be.photo]:Ae.NONE,[be.rich]:Ae.NONE,[be.text]:Ae.TEXT,[be.video]:Ae.NONE}}toSdkChunkType(e){return this.toSdkChunkTypeMap[e]}}class Le{constructor(){this.toSdkLinkTypeMap={[xe.NAVIGATION]:De.NAVIGATION,[xe.MODEL]:De.MODEL,[xe.EXT_LINK]:De.EXT_LINK}}toSdkLinkType(e){return this.toSdkLinkTypeMap[e]}}function ke(e){return"string"==typeof e}class Ge extends B{constructor(e){super("Expected tagId parameter to be of type string; got "+(Array.isArray(e)?"Array":typeof e))}}var Ve=n(331),ze=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const Fe=new L("sdk.editIcon");class Ue extends x{constructor(e){super(),this.payload=e,this.id="REGISTER_MATTERTAG_ICON"}}class He extends x{constructor(e){super(),this.payload=e,this.id="EDIT_MATTERTAG_ICON"}}class Be extends x{constructor(e){super(),this.payload=e,this.id="RESET_MATTERTAG_ICON"}}class je{constructor(e){this.queue=e}load(e){return ze(this,void 0,void 0,(function*(){const t=yield this.queue.get(e,{responseType:"text"}),n=document.createElement("div");n.innerHTML=t;const o=n.querySelector("svg");if(!o)throw Error("Failed trying to load "+e+"as an svg.");const r=o.getAttribute("width"),i=o.getAttribute("height");return r||i?(i&&!r&&(Fe.warn(e,"does not have a defined width. Defaulting width equal to height"),o.setAttribute("width",i)),r&&!i&&(Fe.warn(e,"does not have a defined height. Defaulting height equal to width"),o.setAttribute("height",r))):(Fe.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),o.setAttribute("width",je.defaultResolution),o.setAttribute("height",je.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([o.outerHTML],{type:"image/svg+xml"}))}))}))}}function qe(e){if(null==e||isNaN(e))return!1;if("number"==typeof e)return!0;const t=parseFloat(e);return!isNaN(t)&&"number"==typeof t}function We(e){return e-0}function $e(e){return!!e&&!!("object"==typeof e&&"x"in e&&"y"in e&&"z"in e&&qe(e.x)&&qe(e.y)&&qe(e.z))}je.defaultResolution="128";const Ke=new L("util");function Xe(e){return!!((t=e)&&"object"==typeof t&&"r"in t&&"g"in t&&"b"in t&&qe(t.r)&&qe(t.g)&&qe(t.b))&&(re(e.r,0,1)||Ke.warn("The color provided should have an r value be in the range of [0, 1]"),re(e.g,0,1)||Ke.warn("The color provided should have an g value be in the range of [0, 1]"),re(e.b,0,1)||Ke.warn("The color provided should have an b value be in the range of [0, 1]"),(n=e).r=oe(n.r,0,1),n.g=oe(n.g,0,1),n.b=oe(n.b,0,1),!0);var t,n}const Ze=new L("mattertag-util");function Ye(e,t,n){const o=n.roomIdsFromPoint(e);let r=1/0,i="";for(const t of o){const o=n.get(t),s=e.y-o.min.y;s<r&&(r=s,i=o.floorId)}try{return t.getFloor(i).index}catch(e){return Ze.debug("Unable to deduce floor index from position; defaulting to floor 0"),0}}class Qe extends x{constructor(e){super(),this.payload=e,this.id="BATCH_ADD_MATTERTAG"}}function Je(e,t,n,o,r){const i={[Oe.NONE]:n.TagDescriptionChunkType.none,[Oe.PHOTO]:n.TagDescriptionChunkType.photo,[Oe.VIDEO]:n.TagDescriptionChunkType.video,[Oe.RICH]:n.TagDescriptionChunkType.rich};function s(e,o,r){if(!$e(e.anchorPosition))throw Error("anchorPosition is not a valid Vector3");if(!$e(e.stemVector))throw Error("stemVector is not a valid Vector3");const s=(new t.Vector3).copy(e.anchorPosition),a=(new t.Vector3).copy(e.stemVector),c=a.length();a.normalize();let d=void 0!==e.floorIndex?e.floorIndex:e.floorId;void 0===d&&(d=Ye(s,o,r));const u=o.getFloorAtIndex(d);if(!u)throw new Error(`Could not add Mattertag on invalid floor with index: ${d}`);const h=Xe(e.color)?new t.Color(e.color.r,e.color.g,e.color.b):n.Color.MATTERTAG_BLUE,l=e.description,p=e.label,m=!e.hasOwnProperty("stemVisible")||e.stemVisible;let f;return e.media&&(f={mediaType:i[e.media.type]||n.TagDescriptionChunkType.none,mediaSrc:e.media.src||""}),new n.AddMattertagCommand({position:s,normal:a,floorId:u.id},{color:h,description:l,label:p,stemHeight:c,stemVisible:m,enabled:!0},f)}e.addCommandCreator({namespace:"Mattertag",name:"add",args:["tags"]},(e=>{const t=Array.isArray(e.tags)?e.tags:[e.tags];return new Qe(t)})),o.addBinding(Qe,(e=>{return t=this,n=void 0,a=function*(){const[t,n]=yield r.getDependencies(),i=function(e,t,n){const o=[],r=e,i=r.length;o.length=i;for(let e=0;e<r.length;++e)try{o[e]=s(r[e],t,n)}catch(t){throw Error(`Error in tag ${e} - ${t.message}`)}return o}(e,t,n),a=[];a.length=i.length;for(let t=0;t<i.length;++t){const n=yield o.issueCommand(i[t]);a[t]=n;const r=e[t];r.iconId&&(yield o.issueCommand(new He({tagId:n,iconId:r.iconId})))}return a},new((i=void 0)||(i=Promise))((function(e,o){function r(e){try{c(a.next(e))}catch(e){o(e)}}function s(e){try{c(a.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}c((a=a.apply(t,n||[])).next())}));var t,n,i,a}))}class et extends x{constructor(){super(...arguments),this.id="MATTERTAG_GET"}}function tt(e,t,n){function o(e){if(e)return{label:e.label,type:n.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const r=[];for(const n of e)r.push({type:t.toSdkChunkType(n.type),link:o(n.link),text:n.text});return r}var nt,ot=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};!function(e){e.LABEL="label",e.DESCRIPTION="description",e.MEDIA="media"}(nt||(nt={}));class rt extends x{constructor(e,t){super(),this.payload={tagId:e,properties:t}}}class it extends x{constructor(e,t){super(),this.payload={tagId:e,color:t}}}const st=new L("command.editOpacity");class at{validateInput(e,t){const n=e.sid;if(!ke(n))throw new Ge(n);if(!t.getTag(n))throw Error(e.sid+" is not a valid Mattertag sid");if("number"!=typeof e.opacity||isNaN(e.opacity))throw Error(e.opacity+" is not a valid opacity value");let o=e.opacity;return(o<0||1<o)&&(st.warn(o,"is outside the valid range of [0, 1]"),o=oe(o,0,1)),{sid:n,opacity:o}}exec(e,t,n,o){o.changeDiscOpacity(e.sid,e.opacity),t.return()}}function ct(e,t,n){return(n=n||{}).x=e[t].x,n.y=e[t].y,n.z=e[t].z,n}function dt(e,t){return(t=t||{}).id=e.id,t.sequence=e.index,t}class ut{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ht{constructor(e){this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!I(this.data[t],e.data[t])}update(e,t){for(const r of e.getTagList()){const i=e.getTag(r),s=t.getFloor(i.floorId),a=this.data[i.sid]||{};a.sid=i.sid,a.enabled=i.enabled,a.anchorPosition=ct(i,"anchorPosition",a.anchorPosition),a.stemVector=ct(i,"stemVector",a.stemVector),a.stemVisible=i.stemVisible,a.label=i.label,a.description=i.description,a.media=this.getMedia(i,a.media),a.color=(n=i,"color",(o=(o=a.color)||{}).r=n.color.r,o.g=n.color.g,o.b=n.color.b,o),a.floorIndex=s?s.index:-1,a.floorInfo=dt(s,a.floorInfo),this.data[i.sid]=a}var n,o;for(const t in this.data)e.getTag(t)||delete this.data[t]}clear(){this._data={}}getMedia(e,t){const n=this.mediaConverter.toSdkMedia(e.mediaType);return(t=t||{}).src=e.mediaSrc,t.type=n||Oe.NONE,t}}const lt={namespace:"Mattertag",name:"injectHTML",subRoutine:"mattertag.inject",args:["tagId","html","options"]};var pt,mt;(mt=pt||(pt={})).LOADED="inject.loaded",mt.SETUP="inject.setup",mt.RESOLVE="inject.resolve";const ft=new Set;function gt(e){return!!e&&"string"==typeof e}ft.add(0);var wt,vt,yt,Tt=n(277);class Et{constructor(e){this.messageReceiver=e}notify(e){this.messageReceiver.onMessageReceived(e)}}class Ct{constructor(){this.values={}}add(e,t){this.getValuesAtKey(e).push(t)}remove(e,t){const n=this.values[e];if(n){const e=n.indexOf(t);e>-1&&n.splice(e,1)}}getValuesAtKey(e){const t=this.values[e]||[];return this.values[e]=t,t}valuesPerKey(e){return this.getValuesAtKey(e).length}get keys(){return Object.keys(this.values)}}class It{constructor(e,t){this.sourceId=e,this.listenerBridge=t,this.observers=new Ct}init(){const e=new class{constructor(e){this.messenger=e}onMessageReceived(e){this.messenger.onMessageReceived(e)}}(this),t=new Et(e);this.listenerBridge.listen(t)}dispose(){this.listenerBridge.stopListening()}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e,t,n){n.send(Object.assign(Object.assign({},e),{fromId:this.sourceId,toId:t,timestamp:Date.now()}))}onMessageReceived(e){const t=e.type,n=this.observers.getValuesAtKey(t);if(n)for(const t of n)t.notify(e.payload,e.timestamp)}}class St{constructor(e){this.sourceWindow=e,this.messageObserver=null,this.onMessage=e=>{this.messageObserver&&this.messageObserver.notify(e.data)}}listen(e){this.messageObserver||(this.messageObserver=e,this.sourceWindow.addEventListener("message",this.onMessage))}stopListening(){this.sourceWindow.removeEventListener("message",this.onMessage),this.messageObserver=null}}class bt{constructor(e,t="*"){this.targetWindow=e,this.targetOrigin=t}send(e){this.targetWindow.postMessage(e,this.targetOrigin)}}class xt{constructor(e,t,n){this.sourceId=e,this.targetId=t,this.messageBridge=n,this.observers=new Ct}init(){const e=new class{constructor(e){this.messenger=e}onMessageReceived(e){this.messenger.onMessageReceived(e)}}(this),t=new Et(e);this.messageBridge.listen(t)}dispose(){this.messageBridge.stopListening()}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e){const t=this.sourceId,n=this.targetId;this.messageBridge.send(Object.assign(Object.assign({},e),{fromId:t,toId:n,timestamp:Date.now()}))}onMessageReceived(e){if(!this.filterMessageId(e))return;const t=e.type,n=this.observers.getValuesAtKey(t);if(n)for(const t of n)t.notify(e.payload,e.timestamp)}filterMessageId(e){const t=e.toId,n=e.fromId;return t instanceof Array?t.indexOf(this.sourceId)>-1:t===this.sourceId&&n===this.targetId}}class Nt{constructor(e,t,n="*"){this.listener=new St(e),this.sender=new bt(t,n)}listen(e){this.listener.listen(e)}stopListening(){this.listener.stopListening()}send(e){this.sender.send(e)}}class Ot{constructor(e,t,n,o,r="*"){this.sourceId=e,this.sourceWindow=t,this.targetId=n,this.targetWindow=o,this.targetOrigin=r}createMessenger(){const e=new Nt(this.sourceWindow,this.targetWindow,this.targetOrigin);return new xt(this.sourceId,this.targetId,e)}}!function(e){e.CONNECT="postmessage.connect"}(wt||(wt={})),function(e){e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject"}(vt||(vt={}));class At{constructor(e){this.type=wt.CONNECT,this.payload={applicationKey:e}}}class Dt{constructor(e){this.receiver=e,this.messageType=vt.HANDSHAKE}notify(e){this.receiver.handshake()}}class Pt{constructor(e){this.receiver=e,this.messageType=vt.ACCEPT}notify(e){const{scriptUrl:t,warning:n,targetId:o,targetOrigin:r}=e,i=e.interface;this.receiver.accept(t,i,o,r,n)}}class Mt{constructor(e){this.receiver=e,this.messageType=vt.REJECT}notify(e){this.receiver.reject(e.reason)}}!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.HANDSHAKE=2]="HANDSHAKE",e[e.CONNECTED=3]="CONNECTED",e[e.REJECTED=4]="REJECTED"}(yt||(yt={}));class Rt{constructor(e,t){this.messenger=e,this.target=t,this.connectionState=yt.IDLE,this.connectionPoll=void 0;const n=new class{constructor(e){this.connector=e}handshake(){this.connector.handshake()}accept(e,t,n,o,r){this.connector.accept(e,t,n,o,r)}reject(e){this.connector.reject(e)}}(this);this.handshakeObserver=new Dt(n),this.acceptObserver=new Pt(n),this.rejectObserver=new Mt(n),this.connectionPromise=new Promise(((e,t)=>{this.resolveConnection=e,this.rejectConnection=t}))}connect(e){return this.connectionState===yt.IDLE&&(this.connectionState=yt.CONNECTING,this.messenger.addObserver(this.handshakeObserver),this.messenger.addObserver(this.acceptObserver),this.messenger.addObserver(this.rejectObserver),this.connectionPoll=window.setInterval((()=>{this.messenger.send(new At(e),-1,this.target)}),500)),this.connectionPromise}cancelConnecting(){this.connectionState<yt.CONNECTED&&(this.stopConnectPolling(),this.rejectConnection("User manually cancelled connection"))}handshake(){this.connectionState<yt.HANDSHAKE&&(this.connectionState=yt.HANDSHAKE,this.stopConnectPolling(),this.messenger.removeObserver(this.handshakeObserver))}accept(e,t,n,o,r){this.connectionState<yt.CONNECTED&&(this.connectionState=yt.CONNECTED,this.messenger.removeObserver(this.handshakeObserver),this.messenger.removeObserver(this.acceptObserver),this.messenger.removeObserver(this.rejectObserver),this.stopConnectPolling(),this.resolveConnection({targetId:n,targetOrigin:o,scriptUrl:e,serializedInterface:t,warning:r}))}reject(e){this.connectionState<yt.CONNECTED&&(this.connectionState=yt.REJECTED,this.messenger.removeObserver(this.handshakeObserver),this.messenger.removeObserver(this.acceptObserver),this.messenger.removeObserver(this.rejectObserver),this.stopConnectPolling(),this.rejectConnection(e))}stopConnectPolling(){clearInterval(this.connectionPoll),this.connectionPoll=void 0}}var _t,Lt,kt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};!function(e){e.connect=function(e,n){return kt(this,void 0,void 0,(function*(){if("string"!=typeof n)return Promise.reject("invalid key");const o=(r=e)instanceof Window?r:r.contentWindow?r.contentWindow:null;var r;if(!o)return Promise.reject("invalid window");const i=Math.floor(1e6*Math.random()),s=new St(window),a=new bt(o),c=new It(i,s);c.init();const d=new Rt(c,a);let u;try{u=yield d.connect(n)}catch(e){throw Error(`${n}@${window.location.href} - ${e}`)}finally{d.cancelConnecting(),c.dispose()}return h=yield function(e){return kt(this,void 0,void 0,(function*(){if(!e)throw new Error("Unabled to load the sdk");const n=t[e];if(n)return n;const o=new Promise(((t,n)=>{try{Tt(e,(function(){const e=window["sdk-client"];delete window["sdk-client"],e&&e.SdkBuilder&&"function"==typeof e.SdkBuilder&&t(e.SdkBuilder)}))}catch(t){n(`Could not load the sdk from ${e}`)}}));return t[e]=o,o}))}(u.scriptUrl),l=new Ot(i,window,u.targetId,o,u.targetOrigin),p=u.serializedInterface,new h(l).build(p);var h,l,p}))};const t={}}(_t||(_t={})),function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(Lt||(Lt={}));class Gt{validateInput(e,t){const n=e.tagId;if(!gt(n))throw new Ge(n);if(!t.getTag(n))throw Error(e.tagId+" is not a valid tagId");if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!qe(e.clientId))throw Error("Unexpected error: unable to create iframe");const o=e.options||{};let r="string"==typeof o.windowPath?o.windowPath:"";if(r&&r.split(".").filter((e=>"parent"!==e&&"opener"!==e)).length>0)throw Error(r+" is an unsupported window path");r.length>0&&"."!==r[0]&&(r="."+r);try{if(!Function("return window"+r)().postMessage)throw Error("invalid window")}catch(e){throw Error("problem finding a valid window with path: "+r)}const i={on:"on",off:"off",send:"send"};o.messageFcnMapping&&(gt(o.messageFcnMapping.on)&&(i.on=o.messageFcnMapping.on),gt(o.messageFcnMapping.off)&&(i.off=o.messageFcnMapping.off),gt(o.messageFcnMapping.send)&&(i.send=o.messageFcnMapping.send));const s={w:0,h:0};if(o.size){const e=We(o.size.w+""),t=We(o.size.h+"");isNaN(e)||isNaN(t)||(s.w=e,s.h=t)}return{tagId:n,clientId:e.clientId,html:e.html,options:{size:s,windowPath:r,messageFcnMapping:i}}}exec(e,t,n){const o=function(){let e;do{e=Math.floor(1e6*Math.random())}while(ft.has(e));return ft.add(e),e}(),r=function(){const e=document.createElement("iframe");return e.src="./mattertag/mattertag.postMessage.html",e.sandbox.add("allow-scripts"),e}();r.addEventListener("load",(function(){const n=r.contentWindow;t.return({messengerType:Lt.POSTMESSAGE,iframeId:o}),n.postMessage({type:pt.SETUP,id:o,targetId:e.clientId,customHTML:e.html,windowPath:e.options.windowPath,messageFcnMapping:e.options.messageFcnMapping},"*")})),n.getTag(e.tagId).widgetFrame={size:{width:e.options.size.w,height:e.options.size.h},frame:new Vt(r)},n.commit()}}class Vt{constructor(e){this.iframe=e}mount(e){e.appendChild(this.iframe)}unmount(){this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe)}}class zt extends x{constructor(e,t){super(),this.id="NAVIGATE_TO_MATTERTAG";const n=t;this.payload={sid:e,transition:n}}}class Ft{validateInput(e,t){const n=e.sid;if(!ke(n))throw new Ge(n);if(!t.mattertags.getTag(n))throw Error(e.sid+" is not a valid tag sid");const o={opening:!1,navigating:!1};if("object"==typeof e.prevent&&e.prevent){const t=e.prevent;o.opening=!!t.opening,o.navigating=!!t.navigating}return{sid:n,prevent:o}}exec(e,t,n){e.prevent.opening=!e.prevent.opening,e.prevent.navigating=!e.prevent.navigating,n.setTagCapabilities(e.sid,e.prevent),t.return()}}var Ut;class Ht extends x{constructor(e){super(),this.id="BATCH_REMOVE_MATTERTAG",this.payload={removeCommands:e}}}!function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(Ut||(Ut={}));var Bt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class jt extends x{constructor(e){super(),this.id="MATTERTAG_OPEN",this.payload={tag:e}}}class qt extends x{constructor(e){super(),this.id="MATTERTAG_CLOSE",this.payload={tag:e}}}var Wt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class $t extends x{constructor(){super(...arguments),this.id="MEASUREMENTS_GET"}}class Kt{constructor(e){this.CwfMeasuringPhase=e}create(e,t){let n=t.groupCount,o=t.phase;const r=()=>{const r=t.groupCount,i=t.phase;n===r&&o!==this.CwfMeasuringPhase.EDITING||i!==this.CwfMeasuringPhase.IDLE||(e.onChanged(),n=r),o=i};return new F(t.onPhaseChanged(r),t.onSelectedGroupIndexChanged(r))}}class Xt{constructor(){this.data={}}update(e){for(const t of e.groups())this.createMeasurement(t);for(const t in this.data)e.getGroupInfoBySid(t)||delete this.data[t]}isItemEqual(e,t){return!I(this.data[t],e.data[t])}clear(){this.data={}}createMeasurement(e){const t=e.info.sid,n=this.data[t]||{},o=n.points||[];!function(e,t){let n=0;for(const o of t){const t=e[n]||{};t.x=o.x,t.y=o.y,t.z=o.z,e[n]=t,++n}e.length=n}(o,e),n.sid=t,n.points=o,this.data[t]=n}}class Zt{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Yt{constructor(){this._data={active:!1}}get data(){return this._data}equals(e){return this._data.active===e.data.active}copy(e){this._data.active=e.data.active}update(e){this._data.active=e.modeActive()}}var Qt;class Jt extends x{constructor(e){super(),this.id="SDK_MEASUREMENT_TOGGLE",this.payload={active:e}}}!function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(Qt||(Qt={}));class en extends B{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}const tn=new L("move-to-mode-command");class nn extends x{constructor(e){super(),this.id="MOVE_TO_MODE",this.payload=e}}class on{constructor(e,t,n,o){this.THREE=e,this.CmdViewmode=t,this.conversion=n,this.transitionTypeConverter=o}validateMoveToModeInput(e){if(!e)throw Error("Mode.moveTo -> no arguments provided -- mode is required");e.options||(e.options={});const t=e.mode;if(!G(this.CmdViewmode,e.mode))throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);if(t===this.CmdViewmode.TRANSITIONING)throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);e.options&&e.options.rotation&&(e.options.rotation.z=e.options.rotation.z||0);const n=this.validatePayloadOptions(e.options);return{mode:t,options:{transition:n.transition,position:n.position,rotation:n.rotation,zoom:n.zoom}}}validatePayloadOptions(e){let t,n,o,r;if(e){if(e.transition&&(o=this.transitionTypeConverter.fromSdkTransition(e.transition),void 0===o))throw Error(`Mode.moveTo -> ${e.transition} is not a valid transition style`);e.rotation&&$e(e.rotation)&&(t=this.conversion.rotationToQuaternion(e.rotation)),e.position&&$e(e.position)&&(n=new this.THREE.Vector3(parseFloat(e.position.x),parseFloat(e.position.y),parseFloat(e.position.z))),e.zoom&&!isNaN(e.zoom)&&(r=oe(e.zoom,1,30))}return{rotation:t,position:n,transition:o,zoom:r}}}class rn extends x{constructor(){super(...arguments),this.id="GET_MODEL_DATA"}}function sn(e,t,n){t.addBinding(rn,(()=>{return e=this,o=void 0,i=function*(){return function(e,n,o){const r={sid:"",sweeps:[],modelSupportsVr:!1};try{const i=n.getSweepList(),s=e.model;return t.makeModelData(s.sid,s.options.isVR,i,o,r),r}catch(e){throw Error("no model currently loaded")}}(...yield n.getDependencies())},new((r=void 0)||(r=Promise))((function(t,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(e,o||[])).next())}));var e,o,r,i})),e.addCommandCreator({namespace:"Model",name:"getData",args:[]},(()=>new rn))}var an,cn;class dn extends x{constructor(){super(...arguments),this.id="GET_MODEL_DETAILS"}}function un(e,t,n,o){o.getDependencies().then((e=>n.addBinding(dn,(()=>{return n=this,o=void 0,i=function*(){return function(e,n){function o(e,t){if(n.tryGetProperty(e,!0))return t}const r=e.model;return{sid:r.sid,name:o(t.OptionsKey.DetailsModelName,r.details.name),presentedBy:o(t.OptionsKey.PresentedBy,r.details.presentedBy),summary:o(t.OptionsKey.DetailsSummary,r.details.summary),formattedAddress:o(t.OptionsKey.DetailsAddress,r.details.formattedAddress),contactEmail:o(t.OptionsKey.DetailsEmail,r.details.contact.email),contactName:o(t.OptionsKey.DetailsName,r.details.contact.name),phone:o(t.OptionsKey.DetailsPhone,r.details.contact.phone),formattedContactPhone:o(t.OptionsKey.DetailsPhone,r.details.contact.formattedPhone),externalUrl:o(t.OptionsKey.DetailsExternalUrl,r.details.externalUrl)}}(...e)},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i})))),e.addCommandCreator({namespace:"Model",name:"getDetails",args:[]},(()=>new dn))}function hn(e,t){return function(n,o,r,i,s){s.sweeps=[];for(const n of r){const o=n.floorId?i.getFloor(n.floorId).index:-1;s.sweeps.push({uuid:n.id,sid:n.id,alignmentType:t.toSdkAlignment(n.alignmentType),placementType:t.toSdkPlacement(n.placementType),neighbors:n.neighbours,position:(a=n,null!==a.position?{x:a.position.x,y:a.position.y,z:a.position.z}:null),rotation:e.quaternionToRotation(n.rotation),floor:o})}var a;return s.sid=n,s.modelSupportsVr=o,s}}!function(e){e.MODEL_LOADED="model.loaded"}(an||(an={})),function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(cn||(cn={}));class ln{create(e,t){return t.onChanged((()=>e.onChanged()))}}class pn{constructor(e,t){this.colliderTypes=t,this.ZERO=new e.Vector3(0,0,0),this.tempVec=new e.Vector3,this._data={position:{x:0,y:0,z:0},normal:{x:0,y:0,z:0},object:cn.NONE,floorId:void 0,floorIndex:void 0}}get data(){return this._data}equals(e){const t=1e-5,n=e.data.position,o=this._data.position,r=e.data.normal,i=this._data.normal;return $(n,o,t)&&$(r,i,t)&&e.data.object===this._data.object}update(e,t,n){const o=e.hit;o?(H(this._data.position,o.point),H(this._data.normal,o.face.normal),this._data.floorId=void 0,o.object instanceof this.colliderTypes.ModelColliderTarget?(this._data.object=cn.MODEL,this._data.floorId=function(e,t,n,o){let r;if(function(e){const{object:t}=e;return"object"==typeof t&&"floorId"in t}(e))return r=t.getFloor(e.object.floorId),r.index;o.copy(e.point);const i=n.roomIdsFromPoint(o);if(!i.length)return;const s=i.find((t=>{const o=n.get(t);return o&&o.mesh===e.object}))||i[0];return r=t.getFloor(n.get(s).floorId),r.index}(o,t,n,this.tempVec)):o.object instanceof this.colliderTypes.PinHeadMesh?this._data.object=cn.TAG:o.object instanceof this.colliderTypes.PuckCollider?this._data.object=cn.SWEEP:this._data.object=cn.UNKNOWN):(H(this._data.position,this.ZERO),H(this._data.normal,this.ZERO),this._data.object=cn.NONE,this._data.floorId=void 0),this._data.floorIndex=this._data.floorId}copy(e){H(this._data.position,e.data.position),H(this._data.normal,e.data.normal),this._data.object=e.data.object,this._data.floorId=e.data.floorId,this._data.floorIndex=e.data.floorIndex}}class mn{constructor(e,t){this.captureCamera=e,this.encodeRenderTarget=t}capture(e,t,n,o){return r=this,i=void 0,a=function*(){const{camera:r,scene:i}=t.getScene();return r.getWorldPosition(this.captureCamera.position),r.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(r.projectionMatrix),this.captureCamera.layers.mask=e.visibleObjects.mask,o.setSize(e.resolution.width,e.resolution.height),n.render(o.target,i,this.captureCamera),yield this.encodeRenderTarget(o)},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,o)}c((a=a.apply(r,i||[])).next())}));var r,i,s,a}}var fn;!function(e){e.Base64JPG="screenshot.base64.jpg",e.ArrayBufferJPG="screenshot.arraybuffer.jpg"}(fn||(fn={}));class gn{constructor(e,t,n){this.RenderLayers=t.RenderLayers,this.screenCapturer=e,this.requestTarget=n.requestTarget,this.getRenderLayer=n.getRenderLayer,this.jpegAsBase64=n.jpegAsBase64}validateInput(e,t,n,o){return{resolution:this.validateResolution(e.resolution,t,n),visibleObjects:this.buildVisibilityOptions(e.visibleObjects),returnType:e.returnType===fn.ArrayBufferJPG?fn.ArrayBufferJPG:fn.Base64JPG}}exec(e,t,n,o,r){return i=this,s=void 0,c=function*(){const n=yield this.requestTarget(),i=yield this.screenCapturer.capture({resolution:e.resolution,visibleObjects:this.buildVisibilityLayers(e.visibleObjects)},o,r,n);e.returnType===fn.ArrayBufferJPG&&t.return(i.buffer),t.return(this.jpegAsBase64(i))},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,o)}r((c=c.apply(i,s||[])).next())}));var i,s,a,c}validateResolution(e,t,n){const o={width:0,height:0};if(!e)return o.width=t.width,o.height=t.height,o;if(!function(e){const t=e;return!!t&&"number"==typeof t.width&&"number"==typeof t.height}(e))throw Error('"resolution" provided was not valid. Expected .width and .height to be numbers.');o.width=e.width,o.height=e.height;const r=n.maxTextureSize;if(e.width<=0||e.width>r)throw Error('"resolution.width" provided was outside the valid range of [0, '+r+"]");if(e.height<=0||e.height>r)throw Error('"resolution.height" provided was outside the valid range of [0, '+r+"]");return o}buildVisibilityOptions(e){const t=e||{};return{measurements:!!t.measurements,mattertags:!!t.mattertags,sweeps:!!t.sweeps,views:!!t.views}}buildVisibilityLayers(e){const t=this.RenderLayers.ALL;return e.mattertags||t.removeLayers(this.getRenderLayer("pins")),e.measurements||t.removeLayers(this.getRenderLayer("measurements")),e.sweeps||t.removeLayers(this.getRenderLayer("sweep-pucks")),e.views||(t.removeLayers(this.getRenderLayer("sweep-portal-mesh")),t.removeLayers(this.getRenderLayer("sweep-pin-mesh"))),t}}class wn{constructor(e,t,n){this.Viewmode=t.Viewmode,this.requestTarget=n.requestTarget,this.encodeRenderTarget=n.encodeRenderTarget,this.jpegAsBase64=n.jpegAsBase64,this.getXmp=n.getXmp,this.getOrientedAngleTo=n.getOrientedAngleTo,this.forward=new e.Vector3(0,0,-1),this.sweepForward=new e.Vector3,this.viewForward=new e.Vector3}validateInput(e){return e}exec(e,t,n,o,r,i,s){return a=this,c=void 0,u=function*(){if(!i.currentSweep||r.currentMode!==this.Viewmode.Panorama)throw new Error("Can only capture equirectangular projections while stationary in a sweep");const e=n.getScene().camera,a=i.getSweep(i.currentSweep),c=yield s.load(a);this.sweepForward.copy(this.forward),this.sweepForward.copy(this.forward).applyQuaternion(a.rotation).setY(0);const d=this.getOrientedAngleTo(this.sweepForward,e.getWorldDirection(this.viewForward).setY(0))+Math.PI,u=yield this.requestTarget();u.setSize(wn.equirectangularRes.width,wn.equirectangularRes.height),o.renderEquirectangular(c,u.target,d);const h=yield this.encodeRenderTarget(u,this.getXmp(u.width,u.height,0,0));t.return(this.jpegAsBase64(h))},new((d=void 0)||(d=Promise))((function(e,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function o(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof d?r:new d((function(e){e(r)}))).then(n,o)}r((u=u.apply(a,c||[])).next())}));var a,c,d,u}}wn.equirectangularRes={width:4096,height:2048};class vn{constructor(e,t){this.issueCommand=t.issueCommand,this.GetScreenPositionCommand=e.GetScreenPositionCommand}validateInput(e){if(!$e(e.worldPosition))throw Error(`Renderer.getScreenPosition: 'worldPosition' was specified but was not a valid Vector3; got ${e.worldPosition}`);return e}exec(e,t){return n=this,o=void 0,i=function*(){const n=yield this.issueCommand(new this.GetScreenPositionCommand(e));t.return(n)},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i}}class yn{constructor(e,t){this.GetFloorIntersectCommand=e.GetFloorIntersectCommand,this.issueCommand=t.issueCommand}validateInput(e){if(!function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e){const t=e;return qe(t.x)&&qe(t.y)}return!1}(e.screenPosition))throw Error(`Renderer.getWorldPositionData: 'screenPosition' was not a valid Vector2; got ${e.screenPosition}`);return e}exec(e,t,n){return o=this,r=void 0,s=function*(){const o=yield this.issueCommand(new this.GetFloorIntersectCommand(e)),r=n.getFloorAtIndex(o.floorIndex);r?t.return({position:o.position,floorInfo:{id:r.id,sequence:r.index},floor:o.floorIndex}):t.return({position:o.position,floorInfo:{id:"",sequence:-1},floor:-1})},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}}class Tn{constructor(){this.wasTransitioning360=!1,this.cameraPosition={x:0,y:0,z:0}}create(e,t,n,o){return new F(n.onChanged((()=>this.throttleCameraPositionChanges(e,n))),o.onChanged((()=>this.throttleSweepChanges(e,o))))}throttleCameraPositionChanges(e,t){const n=t.pose.position;n.x===this.cameraPosition.x&&n.y===this.cameraPosition.y&&n.z===this.cameraPosition.z||(this.cameraPosition.x=n.x,this.cameraPosition.y=n.y,this.cameraPosition.z=n.z,e.onChanged())}throttleSweepChanges(e,t){const n=t.transition;t.transitionActive?(t.isSweepUnaligned(n.from)||t.isSweepUnaligned(n.to))&&(this.wasTransitioning360=!0):this.wasTransitioning360&&!t.isSweepUnaligned(t.currentSweep)&&(e.onChanged(),this.wasTransitioning360=!1)}}class En{constructor(){this.currentRooms={rooms:[]}}get data(){return this.currentRooms}equals(e){return this.data.rooms.length===e.data.rooms.length&&this.currentRooms.rooms.every((t=>e.data.rooms.findIndex((e=>e.id===t.id))>-1))}copy(e){this.currentRooms.rooms.length=e.data.rooms.length,function(e,t){const n=t.length;e.length=n;for(let o=0;o<n;++o)e[o]=t[o]}(this.currentRooms.rooms,e.data.rooms)}update(e,t,n,o,r){if(r.isPano()&&n.isSweepUnaligned(n.currentSweep)||n.transitionActive&&(n.isSweepUnaligned(n.transition.to)||n.isSweepUnaligned(n.transition.from)))return void(this.currentRooms.rooms.length=0);const i=e.roomIdsFromPoint(t.pose.position);this.currentRooms.rooms.length=i.length;for(let t=0;t<i.length;++t){const n=i[t],r=e.get(n),s=this.currentRooms.rooms[t]||{};s.id=r.id,s.bounds=s.bounds||{},s.bounds.min=ct(r,"min",s.bounds.min),s.bounds.max=ct(r,"max",s.bounds.max);const a=o.getFloor(r.floorId);s.floorInfo=dt(a,s.floorInfo),this.currentRooms.rooms[t]=s}}}class Cn{create(e,t,n){return{renew(){},cancel(){}}}}class In{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],o=e.data[t];return n.id===o.id&&$(n.bounds.min,o.bounds.min)&&$(n.bounds.max,o.bounds.max)}update(e,t){for(const n of e.rooms()){const e=this._data[n.id]||{};e.id=n.id,e.bounds=e.bounds||{},e.bounds.min=ct(n,"min",e.bounds.min),e.bounds.max=ct(n,"max",e.bounds.max);const o=t.getFloor(n.floorId);e.floorInfo=dt(o,e.floorInfo),this._data[n.id]=e}for(const t in this.data)e.get(t)||delete this._data[t]}clear(){this._data={}}}class Sn extends x{constructor(e){super(),this.id="SCENE_REGISTER",this.payload=e}}class bn extends x{constructor(e){super(),this.id="SCENE_CREATE_NODE",this.payload=e}}class xn extends x{constructor(e){super(),this.id="SCENE_QUERY",this.payload=e}}class Nn extends x{constructor(e){super(),this.id="SCENE_CONFIGURE",this.payload=e}}class On extends x{constructor(e){super(),this.id="SCENE_GETIMAGE",this.payload=e}}class An extends x{constructor(e){super(),this.id="SCENE_EXPORT",this.payload=e}}class Dn extends x{constructor(e){super(),this.id="SCENE_EXPORT",this.payload=e}}class Pn extends x{constructor(e){super(),this.id="SCENE_CREATE_NODES",this.payload=e}}class Mn extends x{constructor(e){super(),this.id="SCENE_REGISTER_COMPONENTS",this.payload=e}}class Rn{validateInput(e,t,n){if(!gt(e.sensorId)||!n.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!function(e){return"boolean"==typeof e}(e.show))throw Error(`Sensor.showDebug: 'show' was not a boolean; got ${e.show}`);return{sensorId:e.sensorId,show:e.show}}exec(e,t,n,o){if(e.show){const t=o.get(e.sensorId);n.setDebugSensor(t)}else n.setDebugSensor(null);t.return()}}class _n{constructor(){this.sourceMap=new Map,this.reverseSourceLookup=new Map,this.sourceId=0,this._data={}}get data(){return this._data}isItemEqual(e,t){return e.data[t].inRange===this.data[t].inRange&&e.data[t].inView===this.data[t].inView}update(e){for(const[t,n]of e.readings){const e=this.addOrGetSourceId(t),o=this._data[e]||{};o.inRange=n.inRange,o.inView=n.inView,o.distanceSquared=n.distanceSq,o.direction=ct(n,"direction",o.direction),this._data[e]=o}for(const t in this.data){const n=this.reverseSourceLookup.get(t);n&&!e.readings.get(n)&&(this.sourceMap.delete(n),this.reverseSourceLookup.delete(t),delete this._data[t])}}clear(){this._data={}}addOrGetSourceId(e){const t=this.sourceMap.get(e);if(t)return t;const n="source-"+ ++this.sourceId;return this.sourceMap.set(e,n),this.reverseSourceLookup.set(n,e),n}}var Ln;class kn{constructor(...e){this.dependencies=e}getDependencies(){return e=this,t=void 0,o=function*(){return Promise.all(this.dependencies)},new((n=void 0)||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}static extend(e,...t){return new kn(...e.dependencies,...t)}static combine(e,t){return new kn(...e.dependencies,...t.dependencies)}}!function(e){e.CAMERA="sensor.sensortype.camera"}(Ln||(Ln={}));const Gn={namespace:"Sensor",name:"createSensor",subRoutine:"sensor.create",args:[]};class Vn{constructor(){this._data={origin:{x:0,y:0,z:0},forward:{x:0,y:0,z:-1}}}get data(){return this._data}equals(e){const t=1e-5;return $(this.data.origin,e.data.origin,t)&&$(this.data.forward,e.data.forward,t)}copy(e){H(this._data.origin,e.data.origin),H(this._data.forward,e.data.forward)}update(e){H(this._data.origin,e.frustum.origin),H(this._data.forward,e.frustum.forward)}}class zn{constructor(e,t){this.sdkModule=e,this.sensorFactories=t}validateInput(e){if(!G(Ln,e.type))throw Error(e.type+" is not a valid sensor type");return this.sensorFactories[e.type].validateInput(e)}exec(e,t,n,o,r){return i=this,s=void 0,c=function*(){const i=this.sensorFactories[e.type].create(e,n),s="sensor-"+ ++zn.nextSensorId;o.set(s,i);const a=T.create(new kn(i),new Un,new E(Vn)),c=this.sdkModule.addObservable(s,a),d=we.create(new kn(i),new Hn,new E(_n)),u=this.sdkModule.addCollection(s,d);r.set(s,{dispose(){c.dispose(),u.dispose()}}),t.return({sensorId:s})},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,o)}r((c=c.apply(i,s||[])).next())}));var i,s,a,c}}zn.nextSensorId=0;class Fn{validateInput(e){return e}create(e,t){return t.createCameraBoundSensor()}}class Un{create(e,t){return t.frustum.observe(new Bn(e))}}class Hn{create(e,t){return t.onReadingsUpdated(new Bn(e))}}class Bn{constructor(e){this.dependencyObserver=e}notify(){this.dependencyObserver.onChanged()}}class jn{validateInput(e,t,n){if(!gt(e.sensorId)||!t.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!function(e,t){return!!Array.isArray(e)&&e.every(t)}(e.sourceIds,gt))throw Error("dev error: this should not occur unless the sdk was not setup properly");for(const t of e.sourceIds)if(!n.has(t))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId,sourceIds:e.sourceIds}}exec(e,t,n,o){const r=n.get(e.sensorId),i=e.sourceIds.map(o.get,o);r.addSource(...i),t.return()}}class qn{validateInput(e,t){if(!gt(e.sensorId)||!t.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId}}exec(e,t,n,o){o.get(e.sensorId).dispose(),n.get(e.sensorId).dispose(),t.return()}}const Wn={namespace:"Sensor",name:"createSource",subRoutine:"source.create",args:["type","options"]};var $n;!function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}($n||($n={}));class Kn{constructor(e,t,n){this.radius=1/0,this.type=e.SPHERE,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{origin:this._volume.origin,radius:this._volume.radius}}}class Xn{constructor(e,t,n){this.type=e.BOX,this._volume=t,this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion,this.THREE=n}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{center:this._volume.center,size:this._volume.size,orientation:this.convertQuaternionToOrientation(this._volume.orientation)}}updateOrientation(e){this.eulerCache.set(e.pitch*this.THREE.MathUtils.DEG2RAD,e.yaw*this.THREE.MathUtils.DEG2RAD,e.roll*this.THREE.MathUtils.DEG2RAD,"YXZ"),this.quaternionCache.setFromEuler(this.eulerCache),this._volume.updateOrientation(this.quaternionCache)}convertQuaternionToOrientation(e){return this.eulerCache.setFromQuaternion(this.quaternionCache.set(e.x,e.y,e.z,e.w)).reorder("YXZ"),{yaw:this.eulerCache.y*this.THREE.MathUtils.RAD2DEG,pitch:this.eulerCache.x*this.THREE.MathUtils.RAD2DEG,roll:this.eulerCache.z*this.THREE.MathUtils.RAD2DEG}}}class Zn{constructor(e,t,n){this.type=e.CYLINDER,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{basePoint:this._volume.basePoint,height:this._volume.height,radius:this._volume.radius}}}function Yn(e){return!!e&&"object"==typeof e}function Qn(e){if(e&&"object"==typeof e&&"yaw"in e&&"pitch"in e&&"roll"in e){const t=e;return qe(t.yaw)&&qe(t.pitch)&&qe(t.roll)}return!1}class Jn{constructor(e){this.sourceFactories=e}validateInput(e,t){if(!G($n,e.type))throw Error(e.type+" is not a valid source type");return this.sourceFactories[e.type].validateInput(e)}exec(e,t,n){const o=this.sourceFactories[e.type].create(e),r="source-"+ ++Jn.nextSourceId;n.set(r,o),t.return({sourceId:r,type:e.type,volume:o.describeVolume()})}}Jn.nextSourceId=0;class eo{constructor(e,t,n){this.sourceType=e,this.sphereVolumeFactory=t,this.THREE=n}validateInput(e){if(Yn(e.options)){if(e.options.origin&&!$e(e.options.origin))throw Error(`Source.Box: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(e.options.radius&&(!qe(e.options.radius)||e.options.radius<0))throw Error(`Source.Sphere: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`)}const t=e.options||{};return{type:e.type,options:{origin:t.origin||{x:0,y:0,z:0},radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Kn(this.sourceType,new this.sphereVolumeFactory,this.THREE),n=t.volume;return n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),t}}class to{constructor(e,t,n){this.sourceType=e,this.boxVolumeFactory=t,this.THREE=n}validateInput(e){if(Yn(e.options)){if(e.options.center&&!$e(e.options.center))throw Error(`Source.Box: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&(!$e(e.options.size)||e.options.size.x<0||e.options.size.y<0||e.options.size.z<0))throw Error(`Source.Box: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!Qn(e.options.orientation))throw Error(`Source.Box: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`)}const t=e.options||{};return{type:e.type,options:{center:t.center||{x:0,y:0,z:0},size:t.size||{x:1/0,y:1/0,z:1/0},orientation:t.orientation||{yaw:0,pitch:0,roll:0}}}}create(e){const t=new Xn(this.sourceType,new this.boxVolumeFactory,this.THREE),n=t.volume;return n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),t}}class no{constructor(e,t,n){this.sourceType=e,this.cylinderVolumeFactory=t,this.THREE=n}validateInput(e){if(Yn(e.options)){if(e.options.basePoint&&!$e(e.options.basePoint))throw Error(`Source.Cylinder: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&!(qe(e.options.height)&&e.options.height<0))throw Error(`Source.Cylinder: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&!(qe(e.options.radius)&&e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{basePoint:t.basePoint||{x:0,y:0,z:0},height:t.hasOwnProperty("height")?t.height:1/0,radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Zn(this.sourceType,new this.cylinderVolumeFactory,this.THREE),n=t.volume;return n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),t}}class oo{constructor(e){this.sourceUpdaters=e}validateInput(e,t){if(!gt(e.sourceId)||!t.has(e.sourceId))throw Error("dev error: this should not occur unless the sdk was not setup properly");const n=t.get(e.sourceId);return this.sourceUpdaters[n.type].validateInput(e)}exec(e,t,n){const o=n.get(e.sourceId);this.sourceUpdaters[o.type].update(e,o),t.return()}}class ro{validateInput(e){if(!Yn(e.options))throw Error("Source.Sphere.update: invalid options provided to .update");if(!$e(e.options.origin))throw Error(`Source.Sphere.update: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(!qe(e.options.radius)||e.options.radius<0)throw Error(`Source.Sphere.update: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),n.notify()}}class io{validateInput(e){if(!Yn(e.options))throw Error("Source.Box.update: invalid options provided to .update");if(e.options.center&&!$e(e.options.center))throw Error(`Source.Box.update: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&!($e(e.options.size)&&e.options.size.x<0&&e.options.size.y<0&&e.options.size.z<0))throw Error(`Source.Box.update: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!Qn(e.options.orientation))throw Error(`Source.Box.update: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`);return e}update(e,t){const n=t.volume;n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),n.notify()}}class so{validateInput(e){if(!Yn(e.options))throw Error("Source.Cylinder.update: invalid options provided to .update");if(e.options.basePoint&&!$e(e.options.basePoint))throw Error(`Source.Cylinder.update: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&!qe(e.options.height))throw Error(`Source.Cylinder.update: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&!qe(e.options.radius))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),n.notify()}}var ao;!function(e){e.FPS="stat.fps"}(ao||(ao={}));class co{constructor(e,t){this.perfStatInterval=1e3,this.elapsedTime=0,this.frameCount=0,this.lastCalcTime=0,this.fps=[0],this.waitForUpdate=e,this.perfStatInterval=t.tryGetProperty("perfInterval",this.perfStatInterval)}calcAndBroadcast(e){return t=this,n=void 0,r=function*(){yield this.waitForUpdate();const t=Date.now(),n=t-this.lastCalcTime;this.lastCalcTime=t,this.elapsedTime+=n,this.frameCount++,this.elapsedTime>=this.perfStatInterval&&(this.fps[0]=1e3*this.frameCount/this.elapsedTime,this.elapsedTime=0,this.frameCount=0,e.broadcast(ao.FPS,(()=>this.fps))),this.calcAndBroadcast(e)},new((o=void 0)||(o=Promise))((function(e,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}c((r=r.apply(t,n||[])).next())}));var t,n,o,r}}var uo,ho=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"});class lo{constructor(){this.currentSweep="",this.sweepTransitionActive=!1,this.currentMode=null,this.modeTransitionActive=!1}create(e,t,n){return new F(t.onChanged((()=>this.throttleSweepDataChanges(e,t))),n.onChanged((()=>this.throttleViewmodeDataChanges(e,n))))}throttleSweepDataChanges(e,t){const n=t.currentSweep||"",o=t.transition.active&&t.transition.to!==t.transition.from;this.currentSweep===n&&this.sweepTransitionActive===o||(this.currentSweep=n,this.sweepTransitionActive=o,e.onChanged())}throttleViewmodeDataChanges(e,t){const n=t.currentMode,o=t.transition.active;this.currentMode===n&&this.modeTransitionActive===o||(this.currentMode=n,this.modeTransitionActive=o,e.onChanged())}}class po{constructor(e,t){this.currentSweep=Object.assign(Object.assign({},po.empty),{floorInfo:Object.assign({},po.empty.floorInfo),neighbors:[],position:Object.assign({},po.empty.position),rotation:Object.assign({},po.empty.rotation)}),this.Viewmode=e.Viewmode,this.sweepPlacementConverter=t.sweepPlacementConverter}get data(){return this.currentSweep}equals(e){const t=ho.epsilon;return this.currentSweep.id===e.data.id&&this.currentSweep.enabled===e.data.enabled&&this.currentSweep.alignmentType===e.data.alignmentType&&this.currentSweep.placementType===e.data.placementType&&this.currentSweep.floorInfo.id===e.data.floorInfo.id&&this.currentSweep.floorInfo.sequence===e.data.floorInfo.sequence&&this.compareNeighbors(e.currentSweep)&&$(this.currentSweep.position,e.data.position,t)&&$(this.currentSweep.rotation,e.data.rotation,t)}copy(e){this.copySweep(e.data)}update(e,t,n){const o=e.currentSweepObject;if(!o||e.transition.active||t.transition.active||t.currentMode!==this.Viewmode.Panorama&&t.currentMode!==this.Viewmode.Outdoor)return void this.copySweep(po.empty);let r;try{r=n.getFloor(o.floorId||"")}catch(e){r={id:void 0,index:void 0}}this.currentSweep.uuid=o.id,this.currentSweep.sid=o.id,this.currentSweep.id=o.id,this.currentSweep.enabled=o.enabled,this.currentSweep.alignmentType=this.sweepPlacementConverter.toSdkAlignment(o.alignmentType),this.currentSweep.placementType=this.sweepPlacementConverter.toSdkPlacement(o.placementType),this.currentSweep.neighbors=[...o.neighbours],H(this.currentSweep.position,o.position),H(this.currentSweep.rotation,o.rotation),this.currentSweep.alignmentType===i.UNALIGNED&&this.currentSweep.placementType===s.UNPLACED?(this.currentSweep.floorInfo.id=void 0,this.currentSweep.floorInfo.sequence=void 0):(this.currentSweep.floorInfo.id=r.id,this.currentSweep.floorInfo.sequence=r.index)}copySweep(e){this.currentSweep.uuid=e.id,this.currentSweep.sid=e.id,this.currentSweep.id=e.id,this.currentSweep.enabled=e.enabled,this.currentSweep.alignmentType=e.alignmentType,this.currentSweep.placementType=e.placementType,this.currentSweep.floorInfo.id=e.floorInfo.id,this.currentSweep.floorInfo.sequence=e.floorInfo.sequence,this.currentSweep.neighbors=[...e.neighbors],H(this.currentSweep.position,e.position),H(this.currentSweep.rotation,e.rotation)}compareNeighbors(e){const t=this.currentSweep.neighbors.length;for(let n=0;n<t;++n)if(this.currentSweep.neighbors[n]!==e.neighbors[n])return!1;return t===e.neighbors.length}}po.empty={uuid:"",sid:"",id:"",enabled:!1,alignmentType:i.ALIGNED,placementType:s.UNPLACED,floorInfo:{id:void 0,sequence:void 0},neighbors:[],position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(uo||(uo={}));var mo;class fo{constructor(e,t){this.NavigateToSweepCommand=e.NavigateToSweepCommand,this.issueCommand=t.issueCommand,this.cameraTransitionConverter=t.cameraTransitionConverter,this.conversion=t.conversionUtils}validateInput(e,t){if(!e.sweep||!gt(e.sweep)||!t.getSweep(e.sweep))throw Error(`Sweep.moveTo: 'sweep' was not a valid sweep id; got ${e.sweep}`);const n=e.options||{};if(n.rotation&&!function(e){const t=e;return!!t&&!("z"in t&&!qe(t.z))&&qe(t.x)&&qe(t.y)}(n.rotation))throw Error(`Sweep.moveTo: 'options.rotation' was specified but was not a valid Rotation; got ${n.rotation}`);if(n.transition&&!G(r,n.transition))throw Error(`Sweep.moveTo: options.transition was specified but was not a valid transition type; got ${n.transition}`);if(n.transitionTime&&(!qe(n.transitionTime)||n.transitionTime<=0))throw Error(`Sweep.moveTo: options.transitionTime was specified but was not a valid, positive time; got ${n.transitionTime}`);return{sweep:e.sweep,options:{rotation:n.rotation,transition:n.transition,transitionTime:n.transitionTime||void 0}}}exec(e,t,n){return o=this,r=void 0,s=function*(){const n=e.options.rotation?this.conversion.rotationToQuaternion(e.options.rotation):void 0,o=e.options.transition,r=e.options.transition?this.cameraTransitionConverter.fromSdkTransition(o):void 0,i=e.options.transitionTime,s=yield this.issueCommand(new this.NavigateToSweepCommand({sweep:e.sweep,rotation:n,transition:r,transitionTime:i}));t.return(s)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}}class go{create(e,t){return t.onChanged((()=>e.onChanged()))}}class wo{constructor(e,t){this._data={},this.conversionUtils=e,this.sweepPlacementConverter=t}get data(){return this._data}isItemEqual(e,t){return!I(this.data[t],e.data[t])}update(e,t){for(const n of e.sweeps()){const{id:e,index:o}=n.floorId?t.getFloor(n.floorId):{id:"",index:-1},r=this.data[n.id]||{};r.uuid=n.id,r.sid=n.id,r.id=n.id,r.enabled=n.enabled,r.alignmentType=this.sweepPlacementConverter.toSdkAlignment(n.alignmentType),r.neighbors=n.neighbours,r.position=vo(n,r.position),r.rotation=this.conversionUtils.quaternionToRotation(n.rotation,r.rotation),r.floorInfo={id:e,sequence:o},this.data[n.id]=r}for(const t in this.data)e.getSweep(t)||delete this.data[t]}clear(){this._data={}}}function vo(e,t){return(t=t||{}).x=e.position.x,t.y=e.position.y,t.z=e.position.z,t}class yo{validateInput(e,t){return{sweepIds:Co(e.sweepIds,t)}}exec(e,t,n,o){for(const t of e.sweepIds)Io(t,!0,n,o);t.return()}}class To{validateInput(e,t){return{sweepIds:Co(e.sweepIds,t)}}exec(e,t,n,o){for(const t of e.sweepIds)Io(t,!1,n,o);t.return()}}function Eo(e,t){if(!gt(e))throw Error(e+" is not a valid string input");if(!t.containsSweep(e))throw Error(e+" does not map to a valid sweep in this model");return e}function Co(e,t){if(!Array.isArray(e))throw Error();for(const n of e)Eo(n,t);return e}function Io(e,t,n,o){o.setVisible(e,t);const r=n.getSweep(e);r.enabled=t,r.commit()}!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(mo||(mo={}));const So=new L("sdk: tours");class bo{validateInput(e){return void 0!==e.index&&isNaN(e.index)&&(So.warn(e.index,"is not a valid number"),e.index=void 0),void 0!==e.steps&&isNaN(e.steps)&&(So.warn(e.steps,"is not a valid number"),e.steps=void 0),e}exec(e,t,n,o){if(0===o.getSnapshotCount())throw Error("No tour data found");if(!n.canChangeTourLocation())throw Error("TourStart ignored, cannot change location at this time, another transition is active");try{n.startTour(e.index,e.steps,e.loop),t.return()}catch(e){t.throw(`Error occurred while starting tour - ${e}`)}}}class xo{validateInput(e){return e}exec(e,t,n){n.stopTour().then((()=>t.return())).catch((e=>{t.throw(`Error occurred while stopping tour - ${e}`)}))}}class No{validateInput(e,t,n){const o=e.index;if(!qe(o))throw Error(o+" is not a valid tour snapshot index");if(o<0||o>n.getSnapshotCount())throw Error(`${o} is outside of the range of tour snapshots: [0 , ${n.getSnapshotCount()-1}]`);return{index:o}}exec(e,t,n,o){if(0===o.getSnapshotCount())throw Error("No tour data found");if(!n.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");n.tourGoTo(e.index).then((()=>t.return())).catch((e=>{t.throw(`Error occurred while jumping to new tour location - ${e}`)}))}}class Oo{constructor(e){this.forward=e}validateInput(e){return e}exec(e,t,n,o){if(0===o.getSnapshotCount())throw Error("No tour data found");if(!n.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");(this.forward?n.tourGoNext(!1):n.tourGoPrevious(!1)).then((()=>t.return())).catch((e=>{t.throw(`Error while trying to travel to the next tour snapshot - ${e}`)}))}}var Ao=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class Do extends x{constructor(){super(...arguments),this.id="GET_TOUR_DATA"}}function Po(e,t,n,C,I){const{THREE:x}=t,{appPhaseModule:R,applicationData:_,cameraData:L,canvasData:F,floorData:U,floorViewData:H,labelData:B,mattertagData:j,mattertagViewData:q,measurementModeData:W,modelData:$,raycasterData:ee,roomData:oe,settingsData:re,sweepData:ie,sweepViewData:se,tourData:ue,viewmodeData:be,commonControlsModule:xe,floorCasterModule:Fe,mattertagDataModule:We,mattertagMeshModule:$e,mattertagViewDataModule:Ke,modelDataModule:Ze,modelMeshModule:Qe,navigationModule:st,renderToTextureModule:ct,sceneModule:dt,sensorModule:pt,settingsModule:mt,tourControlsModule:ft,webglRendererModule:gt,zoomControlModule:wt,sweepTextureLoader:vt}=I,yt=new g(x),Tt=new m(n.Viewmode),Et=function(e){return function(t,n){return o=this,r=void 0,s=function*(){const o=n.rotationSpeed;let r=0;const i=Math.abs(n.xAngle),s=Math.abs(n.yAngle),a=Math.max(i,s);if(a>=Math.PI){const e=a/Math.PI,t=Math.floor(e),n=i/e,o=s/e,c=i-n*t,d=s-o*t;r=Math.acos(Math.cos(n)*Math.cos(o))*t+Math.acos(Math.cos(c)*Math.cos(d))}else r=Math.acos(Math.cos(Math.abs(n.xAngle))*Math.cos(Math.abs(n.yAngle)));if(r){const i=new e.Vector2(-n.xAngle,n.yAngle);return i.multiplyScalar(o/r),t.startRotateTransition(r/o,i,!1)}},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}}(x),Ct=new p(n.SweepAlignmentType,n.SweepPlacementType),It=Object.assign(Object.assign({},C),{conversionUtils:new g(x),directionConverter:new h(n.Vectors),getPose:pe(x,Tt),rotateCamera:Et,orientCamera:Y(x,n.Viewmode,Et),appPhaseConverter:new v(n.AppPhase),applicationConverter:new y(n.Application),mediaConverter:new Re(n.MattertagMediaType),chunkTypeConverter:new _e,linkTypeConverter:new Le,sweepPlacementConverter:Ct,viewmodeConverter:Tt,commandModeConverter:new f(n.CommandViewmode),cameraTransitionConverter:new l(n.CameraTransitionType),makeLabelData:Me(x,C.worldToScreenPosition),makeModelData:hn(yt,Ct),sweepUtils:new w(n.SweepAlignmentType)});var St;(St=e).addEnumToInterface({namespace:"App",name:"Phase",values:d}),St.addEnumToInterface({namespace:"App",name:"Event",values:u}),St.addEnumToInterface({namespace:"App",name:"Application",values:c}),function(e,t,n){const o=[void 0],r=e=>(o[0]=n.appPhaseConverter.toSdkAppPhase(e.phase),o);n.subscribe(t.AppPhaseChangeMessage,(t=>{e.broadcast(u.PHASE_CHANGE,r,t)}))}(e,n,It),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(N,(()=>{return n=this,o=void 0,i=function*(){try{const n=e.getData();return{phase:t.appPhaseConverter.toSdkAppPhase(n.phase),application:t.applicationConverter.toSdkApplication(n.application)}}catch(e){throw Error("Error: Can't get application data at this time")}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i}))})),e.addCommandCreator({namespace:"App",name:"getState",args:[]},(()=>new N))}(e,It,new kn(R)),function(e,t,n){t.addBinding(O,(()=>{return e=this,o=void 0,i=function*(){const e={[d.WAITING]:null,[d.LOADING]:null,[d.STARTING]:null,[d.PLAYING]:null,[d.ERROR]:null},[o]=yield n.getDependencies();for(const n in o.phaseTimes){const r=Number(n);e[t.appPhaseConverter.toSdkAppPhase(r)]=o.phaseTimes[r]}return e},new((r=void 0)||(r=Promise))((function(t,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(e,o||[])).next())}));var e,o,r,i})),e.addCommandCreator({namespace:"App",name:"getLoadTimes",args:[]},(()=>new O))}(e,It,new kn(_)),function(e,t,n,o){const r=T.create(o,new S,new E(b,t,n));e.addObservableToInterface({namespace:"App",name:"state"},r)}(e,n,It,new kn(_)),function(e,t,n){n.getDependencies().then((([e,n,o])=>{const r={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:a.TRANSITIONING};t.addBinding(A,(()=>{return i=this,s=void 0,c=function*(){return t.getPose(r,e,n,o)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,o)}r((c=c.apply(i,s||[])).next())}));var i,s,a,c}))})),e.addCommandCreator({namespace:"Camera",name:"getPose",args:[]},(()=>new A))}(e,It,new kn(L,ie,be)),function(e,t,n,o){o.getDependencies().then((([e,o,r])=>{n.addBinding(P,(function(i={}){return s=this,a=void 0,d=function*(){if(!r.isPano())throw Error("Camera.lookAtScreenCoords must be called from Inside mode");const s=n.screenPositionToNDC(i.x,i.y,o.width,o.height),a=new t.Vector3(0,0,-1).applyQuaternion(o.pose.rotation),c=n.ndcToWorldPosition(o,new t.Vector2(s.x,s.y),1).normalize(),d=a.clone().setY(0).angleTo(c.clone().setY(0)),u=Math.asin(c.y-a.y),h=d*Math.sign(s.x),l=u;return n.rotateCamera(e,{xAngle:h,yAngle:l,zAngle:0,rotationSpeed:D})},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{r(d.next(e))}catch(e){t(e)}}function o(e){try{r(d.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof c?r:new c((function(e){e(r)}))).then(n,o)}r((d=d.apply(s,a||[])).next())}));var s,a,c,d}))})),e.addCommandCreator({namespace:"Camera",name:"lookAtScreenCoords",args:["x","y"]},(function(e={}){if(e.x=e.x||0,e.y=e.y||0,isNaN(e.x)||isNaN(e.y))throw new Error(`${JSON.stringify(e)} does not contain valid screen coordinates`);return new P({x:e.x,y:e.y})}))}(e,x,It,new kn(xe,L,be)),function(e,t,n){n.getDependencies().then((([n,o,r])=>{const i=[{position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:a.TRANSITIONING}],s=(()=>{let a=0,c=!1;const d=()=>(t.getPose(i[0],n,o,r),i);return()=>{const t=Date.now(),n=a+100;if(t>n){c=!1,a=t;try{e.broadcast(M.MOVE,d)}catch(e){k.debug("failed to broadcast pose, one of the module dependencies are probably not loaded yet")}}else c||(setTimeout((()=>s()),n-t),c=!0)}})();n.onChanged(s),r.onChanged(s)})),e.addEnumToInterface({namespace:"Camera",name:"Event",values:M})}(e,It,new kn(L,ie,be)),function(e,t,n){n.getDependencies().then((([e])=>t.addBinding(V,(n=>{return r=this,i=void 0,a=function*(){const r=n.direction;if(!G(o,n.direction))throw new Error(`${n.direction} is not a valid direction`);yield e.navigateInLocalDirection(t.directionConverter.toVector(r))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,o)}c((a=a.apply(r,i||[])).next())}));var r,i,s,a})))),e.addEnumToInterface({namespace:"Camera",name:"Direction",values:o}),e.addCommandCreator({namespace:"Camera",name:"moveInDirection",args:["direction"]},(e=>new V(e||{})))}(e,It,new kn(st)),function(e,t,n,o){o.getDependencies().then((([e,o])=>{n.addBinding(z,(n=>{return r=this,i=void 0,a=function*(){const r=o.pose.position,i=n.x-r.x,s=n.z-r.z,a=new t.Vector2(i,s),c=a.length();a.setLength(.005),yield e.startTranslateTransition(c/.005,a,!1)},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,o)}c((a=a.apply(r,i||[])).next())}));var r,i,s,a}))})),e.addCommandCreator({namespace:"Camera",name:"pan",args:["position"]},(e=>{if((e=e||{}).position=e.position||{},e.position.x=e.position.x-0,e.position.z=e.position.z-0,isNaN(e.position.x)||isNaN(e.position.z))throw new Error(`${JSON.stringify(e)} does not contain a valid position to pan`);return new z({x:e.position.x,z:e.position.z})}))}(e,x,It,new kn(xe,L)),function(e,t,n,o){const r=T.create(o,new K,new E(X,t,n.viewmodeConverter));e.addObservableToInterface({namespace:"Camera",name:"pose"},r)}(e,x,It,new kn(L,ie,be)),function(e,t,n,o){const r=t.MathUtils.degToRad(80)/1e3;o.getDependencies().then((([e,t,o])=>{n.addBinding(Z,(t=>J(this,void 0,void 0,(function*(){return yield n.rotateCamera(e,t)})))),n.addBinding(Q,(r=>J(this,void 0,void 0,(function*(){return yield n.orientCamera(t,e,o,r)}))))}));const i=e=>{const n=(e=e||{}).options||{},o=t.MathUtils.degToRad(e.xAngle||0),i=t.MathUtils.degToRad(e.yAngle||0),s=t.MathUtils.degToRad(e.zAngle||0);let a=r;if(n.speed){if(isNaN(n.speed)||n.speed<=0)throw new Error(`${JSON.stringify(n)} does not contain valid rotation speed`);a=t.MathUtils.degToRad(n.speed)/1e3}if(isNaN(o)||isNaN(i)||isNaN(s))throw new Error(`${JSON.stringify(e)} does not contain valid rotation angles`);return{xAngle:o,yAngle:i,zAngle:s,rotationSpeed:a}};e.addCommandCreator({namespace:"Camera",name:"rotate",args:["xAngle","yAngle","options"]},(e=>new Z(i(e)))),e.addCommandCreator({namespace:"Camera",name:"setRotation",args:["rotation","options"]},(e=>{const t=(e=e||{}).rotation||{};return new Q(i({xAngle:t.x,yAngle:t.y,zAngle:t.z,options:e.options}))}))}(e,x,It,new kn(xe,L,be)),function(e,t,n,o){const r=o,i=te.create(r,new E(ae,t,n)),s=te.create(r,new E(ce,t,n)),a=te.create(r,new E(de,t,n));e.addCommandToInterface({namespace:"Camera",name:"zoomTo",args:["zoomPct"]},i),e.addCommandToInterface({namespace:"Camera",name:"zoomBy",args:["zoomDelta"]},s),e.addCommandToInterface({namespace:"Camera",name:"zoomReset",args:[]},a)}(e,n,It,new kn(L,be,wt)),function(e,t,n){const o=T.create(n,new he,new E(le,t));e.addObservableToInterface({namespace:"Camera",name:"zoom"},o)}(e,n,new kn(L,be)),function(e,t,n){const o=T.create(n,new me,new E(fe,t));e.addObservableToInterface({namespace:"Floor",name:"current"},o)}(e,n,new kn(H,ie,L)),function(e,t,n,o){e.addEnumToInterface({namespace:"Floor",name:"Event",values:ge}),o.getDependencies().then((([o])=>{const r=[-1,-1];function i(e){if(o){const t=e.to?o.getFloor(e.to):null,n=e.from?o.getFloor(e.from):null;t&&(r[0]=t.index),n&&(r[1]=n.index)}return r}const s=[-1,""];function a(e){if(o){const t=e.floorId?o.getFloor(e.floorId):null;t&&(s[0]=t.index)}return s[1]=e.floorName,s}n.subscribe(t.StartMoveToFloorMessage,(t=>e.broadcast(ge.CHANGE_START,i,t))),n.subscribe(t.EndMoveToFloorMessage,(t=>e.broadcast(ge.CHANGE_END,a,t)))}))}(e,n,It,new kn(U)),function(e,t){const n=we.create(t,new ve,new E(ye));e.addCollectionToInterface({namespace:"Floor",name:"data"},n)}(e,new kn(U)),function(e,t,n){t.addBinding(Ee,(()=>Te(this,void 0,void 0,(function*(){const[e]=yield n.getDependencies();return function(e){return Te(this,void 0,void 0,(function*(){try{const{currentFloor:t,totalFloors:n}=e,o=e.getFloorNames();return{currentFloor:t?t.index:-1,floorNames:o,totalFloors:n}}catch(e){throw Error("no floors currently loaded")}}))}(e)})))),e.addCommandCreator({namespace:"Floor",name:"getData",args:[]},(()=>new Ee))}(e,It,new kn(H)),function(e,t,n,o){o.getDependencies().then((([e])=>n.addBinding(Ce,(o=>{return r=this,i=void 0,a=function*(){if("number"!=typeof o.floorIndex||o.floorIndex<0)throw Error("floor index must be a non-negative number");try{const r="boolean"==typeof o.moveCamera&&!o.moveCamera,i=r?250:void 0;yield n.issueCommand(new t.MoveToFloorIndexCommand(o.floorIndex,r,i));const s=e.currentFloor;return s?s.index:-1}catch(e){throw Error(`Could not move to floor at index ${o.floorIndex}`)}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,o)}c((a=a.apply(r,i||[])).next())}));var r,i,s,a})))),e.addCommandCreator({namespace:"Floor",name:"moveTo",args:["floorIndex","moveCamera"]},(e=>new Ce(e)))}(e,n,It,new kn(H)),function(e,t,n,o){const r=te.create(o,new E(Ie,t,n));e.addCommandToInterface({namespace:"Floor",name:"showAll",args:["moveCamera"]},r)}(e,n,It,new kn(H)),function(e,t,n){t.addBinding(Pe,(()=>{return e=this,o=void 0,i=function*(){const[e,o,r]=yield n.getDependencies();return t.makeLabelData(e,o,r)},new((r=void 0)||(r=Promise))((function(t,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(e,o||[])).next())}));var e,o,r,i})),e.addCommandCreator({namespace:"Label",name:"getData",args:[]},(()=>new Pe))}(e,It,new kn(L,U,B)),function(e,t,n,o){e.addEnumToInterface({namespace:"Label",name:"Event",values:Se}),o.getDependencies().then((([o,r,i,s])=>{const a=()=>[n.makeLabelData(o,i,r)];o.onChanged((n=>{s.currentMode===t.Viewmode.Floorplan&&e.broadcast(Se.POSITION_UPDATED,a,n)}))}))}(e,n,It,new kn(L,B,U,be)),function(e){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:Ae}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:Ne}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:De}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:Oe}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:r})}(e),Je(e,x,n,It,new kn(U,oe,We)),function(e,t,n,o){n.addBinding(et,(()=>{return e=this,t=void 0,i=function*(){return o.getDependencies().then((([e,t,o])=>{try{const t=[];return e.iterate((e=>{const{id:r,index:i}=o.getFloor(e.floorId),s=e.mediaSrc,a=n.mediaConverter.fromTagChunkType(e.mediaType);t.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:tt(e.parsedDescription,n.chunkTypeConverter,n.linkTypeConverter),mediaSrc:s,mediaType:a,media:{type:a,src:s},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:i,floorIndex:i,floorInfo:{id:r,sequence:i},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),t}catch(e){throw Error("problem getting tag data")}}))},new((r=void 0)||(r=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}));var e,t,r,i})),e.addCommandCreator({namespace:"Mattertag",name:"getData",args:[]},(()=>new et))}(e,0,It,new kn(j,re,U)),function(e,t,n,o){const r={},i={};n.addBinding(Ue,(e=>ze(this,void 0,void 0,(function*(){const{iconId:o,iconSrc:s}=e;if(!s||"string"!=typeof s)throw Error("icon src is not a valid string");if(!o||"string"!=typeof o)throw Error("icon id is not a valid string");if(i[o])throw Error(o+" already has a registered icon");const a=new je(new Ve.gO);r[o]=new Promise(((e,r)=>{const c=".svg";if(s.indexOf(c,s.length-c.length)>-1)a.load(s).then((n=>{const r=new t.Texture(n);r.needsUpdate=!0,i[o]=r,e(r.image)}));else{const t=n.loadImage(s,(()=>{i[o]=t,e(t.image)}),(()=>r("Failed to load "+s)))}}))})))),n.addBinding(He,(e=>ze(this,void 0,void 0,(function*(){const[n]=yield o.getDependencies(),{iconId:s,tagId:a}=e;if(!s||!r[s])throw Error(s+" has not been registered as valid icon id");if(!ke(a))throw new Ge(a);let c;try{c=yield r[s]}catch(e){throw Error(e)}const d=i[s],u=c.naturalWidth/c.naturalHeight,h=new t.Vector3;u>1?h.set(u,1,1):h.set(1,1/u,1),n.setOverrideMaterial(a,d,h)})))),n.addBinding(Be,(e=>ze(this,void 0,void 0,(function*(){const[t]=yield o.getDependencies(),{tagId:n}=e;t.setOverrideMaterial(n,null,null)})))),e.addCommandCreator({namespace:"Mattertag",name:"registerIcon",args:["iconId","iconSrc"]},(e=>new Ue(e))),e.addCommandCreator({namespace:"Mattertag",name:"editIcon",args:["tagId","iconId"]},(e=>new He(e))),e.addCommandCreator({namespace:"Mattertag",name:"resetIcon",args:["tagId"]},(e=>new Be(e)))}(e,x,It,new kn($e)),function(e,t,n,o,r){const i={[Oe.NONE]:n.TagDescriptionChunkType.none,[Oe.PHOTO]:n.TagDescriptionChunkType.photo,[Oe.VIDEO]:n.TagDescriptionChunkType.video,[Oe.RICH]:n.TagDescriptionChunkType.rich};r.getDependencies().then((()=>{o.addBinding(rt,(e=>ot(this,void 0,void 0,(function*(){const t=e.tagId;if(!ke(t))throw new Ge(t);if(!e.properties)return;const r=e.properties[nt.LABEL],s=e.properties[nt.MEDIA],a=e.properties[nt.DESCRIPTION];if(null!=r&&"string"!=typeof r)throw Error("Mattertag.editBillboard only accepts a string for the title field");if(null!=a&&"string"!=typeof a)throw Error("Mattertag.editBillboard only accepts a string for the description field");if(null!=s){if("string"!=typeof s.src)throw Error("Mattertag.editBillboard only accepts a string for the media.src field");if(!G(Oe,s.type))throw Error("Mattertag.editBillboard only accepts a value from Mattertag.MediaType for the media.type field")}let c;s&&(c={mediaType:i[s.type],mediaSrc:s.src});const d={label:r,description:a};yield o.issueCommand(new n.EditMattertagCommand(e.tagId,d,c))})))),o.addBinding(it,(e=>ot(this,void 0,void 0,(function*(){const r=e.color;if(null!=r&&!Xe(r))throw Error("Mattertag.editColor only accepts a Color object of the form {r, g, b} for the color field");const i={color:(new t.Color).setRGB(r.r,r.g,r.b)};yield o.issueCommand(new n.EditMattertagCommand(e.tagId,i))}))))})),e.addCommandCreator({namespace:"Mattertag",name:"editBillboard",args:["tag","values"]},(e=>new rt(e.tag,e.values))),e.addCommandCreator({namespace:"Mattertag",name:"editColor",args:["tag","color"]},(e=>new it(e.tag,e.color)))}(e,x,n,It,new kn(j)),function(e,t){const n=te.create(t,new E(at));e.addCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["sid","opacity"]},n)}(e,new kn(j,$e)),function(e,t,n){const o=we.create(n,new ut,new E(ht,t));e.addCollectionToInterface({namespace:"Mattertag",name:"data"},o)}(e,It,new kn(j,U)),function(e,t){const n=te.create(t,new E(Gt));e.addCommandToInterface(Object.assign({},lt),n)}(e,new kn(j)),function(e,t,n,o){let r;e.addCommandCreator({namespace:"Mattertag",name:"editPosition",args:["sid","options"]},(e=>{if(!r)throw Error("Edit command not bound yet");return r(e)}));const i=new t.Vector3,s=new t.Vector3;o.getDependencies().then((function([e,t,o]){r=({sid:r,options:a})=>{const{stemVector:c,anchorPosition:d}=a,u={};if(!ke(r))throw new Ge(r);const h=e.getTag(r);if(!h)throw Error(`${r} was not found in the mattertag data`);if(d&&(!qe(d.x)||!qe(d.y)||!qe(d.z)))throw Error(`${d} is not a valid Vector3`);if(c&&(!qe(c.x)||!qe(c.y)||!qe(c.z)))throw Error(`${c} is not a valid Vector3`);let l=t.getFloor(h.floorId);s.copy(h.anchorPosition),i.copy(h.anchorNormal),c&&(i.set(c.x,c.y,c.z),u.stemHeight=i.length(),i.normalize()),d&&(s.set(d.x,d.y,d.z),l=t.getFloorAtIndex(Ye(s,t,o)));const p=void 0!==a.floorIndex?a.floorIndex:a.floorId;if(void 0!==p&&(l=t.getFloorAtIndex(p)),!l)throw new Error(`Could not move Mattertag to invalid floor with index: ${p}`);return new n.EditMattertagCommand(r,u,void 0,{floorId:l.id,normal:i,position:s})}}))}(e,x,n,new kn(j,U,oe)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"navigateToTag",args:["sid","transitionType"]},(e=>{const o=e.transitionType?n.cameraTransitionConverter.fromSdkTransition(e.transitionType):t.CameraTransitionType.Interpolate;return new zt(e.sid,o)})),n.addBinding(zt,(e=>{return o=this,r=void 0,s=function*(){try{return yield n.issueCommand(new t.NavigateToMattertagCommand(e.sid,e.transition)),e.sid}catch(t){throw Error(`Could not move to tag with sid ${e.sid}`)}},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}))}(e,n,It),function(e,t){const n=te.create(t,new E(Ft));e.addCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["sid","prevent"]},n)}(e,new kn(q)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"remove",args:["tags"]},(function(e){const n=[];if(!e.tags)throw Error("invalid list of tags to remove");if(e.tags instanceof Array){const o=e.tags,r=o.length;n.length=r;for(let e=0;e<o.length;++e)n[e]=new t.RemoveMattertagCommand(o[e])}else n.push(new t.RemoveMattertagCommand(e.tags));return new Ht(n)})),n.addBinding(Ht,(e=>{return t=this,o=void 0,i=function*(){const t=[],o=e.removeCommands;t.length=o.length;for(const e of o){const o=yield n.issueCommand(e);o&&t.push(o)}return t},new((r=void 0)||(r=Promise))((function(e,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i}))}(e,n,It),function(e,t,n,o){o.getDependencies().then((([o])=>{const r=["",!1],i=e=>(r[0]=e.id,r[1]=e.hovering,r);n.subscribe(t.PinHoverChangeMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(Ut.HOVER,i,n)}));const s=[""],a=e=>(s[0]=e.id,s);n.subscribe(t.PinClickedMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(Ut.CLICK,a,n)}));const c=["",""],d=e=>(c[0]=o.openTag,c[1]=e.url,c);n.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast(Ut.LINK_OPEN,d,t)}))}))}(e,n,It,new kn(q)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"closeBillboards",args:["tag"]},(e=>new qt(e.tag))),n.getDependencies().then((([e])=>{t.addBinding(jt,(t=>Bt(this,void 0,void 0,(function*(){const n=t.tag;if(!ke(n))throw new Ge(n);e.openBillboard(n)}))))})),n.getDependencies().then((([e])=>{t.addBinding(qt,(t=>Bt(this,void 0,void 0,(function*(){const n=t.tag;if(!ke(n))throw new Ge(n);e.closeBillboard(t.tag)}))))}))}(e,It,new kn(Ke)),function(e,t,n){t.addBinding($t,(()=>Wt(this,void 0,void 0,(function*(){const[e,t]=yield n.getDependencies();return((e,t)=>Wt(void 0,void 0,void 0,(function*(){const n=[];for(const o of e.groups()){const e=o.info,r=t.getFloor(e.floorId);for(let t=1;t<o.count-1;t++){const i=o.get(t-1),s=o.get(t);n.push({sid:e.sid,label:e.text,floor:r.index,start:{x:i.x,y:i.y,z:i.z},end:{x:s.x,y:s.y,z:s.z}})}}return n})))(e,t)})))),e.addCommandCreator({namespace:"Measurements",name:"getData",args:[]},(()=>new $t))}(e,It,new kn(W,U)),function(e,t,n){const o=we.create(n,new Kt(t.MeasuringPhase),new E(Xt));e.addCollectionToInterface({namespace:"Measurements",name:"data"},o)}(e,n,new kn(W)),function(e,t){const n=T.create(t,new Zt,new E(Yt));e.addObservableToInterface({namespace:"Measurements",name:"mode"},n)}(e,new kn(W)),function(e,t,n){n.addBinding(Jt,(e=>{return o=this,r=void 0,s=function*(){return n.issueCommand(new t.ToggleToolCommand(t.Tools.MEASUREMENTS,e.active))},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s})),e.addCommandCreator({namespace:"Measurements",name:"toggleMode",args:["active"]},(e=>new Jt(e.active)))}(e,n,It),function(e,t,n,o){e.addEnumToInterface({namespace:"Mode",name:"Event",values:Qt}),o.getDependencies().then((([o,r])=>{const i=[void 0,void 0],s=e=>{const t=r.currentMode,s=n.sweepUtils.isSweepAligned(o,e.fromSweep),a=n.sweepUtils.isSweepAligned(o,e.toSweep);return i[0]=n.viewmodeConverter.toSdk(t,s),i[1]=n.viewmodeConverter.toSdk(t,a),i};n.subscribe(t.EndMoveToSweepMessage,(t=>{n.sweepUtils.isSweepAligned(o,t.fromSweep)!==n.sweepUtils.isSweepAligned(o,t.toSweep)&&e.broadcast(Qt.CHANGE_END,s,t)}));const a=[void 0,void 0],c=e=>{const t=n.sweepUtils.isCurrentSweepAligned(o);return a[0]=n.viewmodeConverter.toSdk(e.fromMode,t),a[1]=n.viewmodeConverter.toSdk(e.toMode,t),a};n.subscribe(t.BeginSwitchViewmodeMessage,(t=>e.broadcast(Qt.CHANGE_START,c,t)));const d=[void 0,void 0],u=e=>{const t=n.sweepUtils.isCurrentSweepAligned(o);return d[0]=n.viewmodeConverter.toSdk(e.fromMode,t),d[1]=n.viewmodeConverter.toSdk(e.toMode,t),d};n.subscribe(t.EndSwitchViewmodeMessage,(t=>e.broadcast(Qt.CHANGE_END,u,t)))}))}(e,n,It,new kn(ie,be)),function(e,t,n,o,i){o.addBinding(nn,(e=>{return t=this,r=void 0,s=function*(){try{e.options=e.options||{};let t=n.CameraTransitionType.Interpolate;const r=e.options.transition;return void 0===r||isNaN(r)||(t=r),yield o.issueCommand(new n.ChangeViewmodeCommand(e.mode,t,{position:e.options.position,rotation:e.options.rotation,zoom:e.options.zoom})),e.mode}catch(t){const n=t instanceof en?`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`:`Mode.moveTo -> Could not move to ${e.mode}`;if(tn.error(t,n),t instanceof en)throw Error(`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`);throw Error(`Mode.moveTo -> Could not move to ${e.mode}`)}},new((i=void 0)||(i=Promise))((function(e,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}c((s=s.apply(t,r||[])).next())}));var t,r,i,s}));const s=new on(t,n.CommandViewmode,o.conversionUtils,o.cameraTransitionConverter);e.addCommandCreator({namespace:"Mode",name:"moveTo",args:["mode","options"]},(e=>new nn(s.validateMoveToModeInput(e)))),e.addEnumToInterface({namespace:"Mode",name:"Mode",values:n.CommandViewmode}),e.addEnumToInterface({namespace:"Mode",name:"TransitionType",values:r})}(e,x,n,It,new kn),sn(e,It,new kn($,ie,U)),un(e,n,It,new kn($,re)),function(e,t,n,o){e.addEnumToInterface({namespace:"Model",name:"Event",values:an});const r={sid:"",sweeps:[],modelSupportsVr:!1},i=[r];o.getDependencies().then((o=>{n.subscribe(t.ModelDataLoadedMessage,(t=>{e.broadcast(an.MODEL_LOADED,((e,t)=>o=>(n.makeModelData(o.sid,o.vrSupported,e.getSweepList(),t,r),i))(...o),t)}))}))}(e,n,It,new kn(ie,U)),function(e,t,n,o){const r=T.create(o,new ln,new E(pn,t,n));e.addEnumToInterface({namespace:"Pointer",name:"Colliders",values:cn}),e.addObservableToInterface({namespace:"Pointer",name:"intersection"},r)}(e,x,n,new kn(ee,U,oe)),function(e,t,n,o,r){const i=new mn(new t.Camera,o.encodeRenderTarget),s=new E(gn,i,n,o),a=te.create(r,s),c=te.create(r,new E(ne,s,"Camera.takeScreenshot deprecated, please use Renderer.takeScreenshot"));e.addCommandToInterface({namespace:"Renderer",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},a),e.addCommandToInterface({namespace:"Camera",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},c)}(e,x,n,It,new kn(F,gt,ct)),function(e,t,n,o,r){const i=te.create(r,new E(wn,t,n,o));e.addCommandToInterface({namespace:"Renderer",name:"takeEquirectangular",args:[]},i)}(e,x,n,It,new kn(gt,ct,be,ie,vt)),function(e,t,n,o){const r=te.create(o,new E(vn,t,n));e.addCommandToInterface({namespace:"Renderer",name:"getScreenPosition",args:["worldPosition"]},r)}(e,n,It,new kn(gt)),function(e,t,n,o){const r=te.create(o,new E(yn,t,n));e.addCommandToInterface({namespace:"Renderer",name:"getWorldPositionData",args:["screenPosition","height","includeHiddenFloors"]},r)}(e,n,It,new kn(U,Fe)),function(e,t){const n=T.create(t,new Tn,new E(En));e.addObservableToInterface({namespace:"Room",name:"current",objectFactory:"current.room"},n)}(e,new kn(oe,L,ie,U,be)),function(e,t){const n=we.create(t,new Cn,new E(In));e.addCollectionToInterface({namespace:"Room",name:"data",elementFactory:"collection.room"},n)}(e,new kn(oe,U)),function(e,t,n){t.addBinding(Sn,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();return t.registerFactory(e.name,e.factory)},new((r=void 0)||(r=Promise))((function(e,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"register",args:["name","factory"]},(e=>new Sn(e)))}(e,It,new kn(dt)),function(e,t,n){t.addBinding(bn,(()=>{return e=this,t=void 0,r=function*(){const[e]=yield n.getDependencies();return e.createNode()},new((o=void 0)||(o=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}));var e,t,o,r})),e.addCommandCreator({namespace:"Scene",name:"createNode",args:["userContext"]},(e=>new bn(e)))}(e,It,new kn(dt)),function(e,t,n){t.addBinding(xn,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();return t.sceneTags().getObjects(e.tags)},new((r=void 0)||(r=Promise))((function(e,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"query",args:["tags"]},(e=>new xn(e)))}(e,It,new kn(dt,Qe)),function(e,t,n,o){o.getDependencies().then((([e])=>{n.addBinding(Nn,(n=>{return o=this,r=void 0,s=function*(){n.callback(e.cwfRenderer.renderer,t,e.getScene().effectComposer)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,r||[])).next())}));var o,r,i,s}))})),e.addCommandCreator({namespace:"Scene",name:"configure",args:["callback"]},(e=>new Nn(e)))}(e,x,It,new kn(gt)),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(On,(t=>{return n=this,o=void 0,i=function*(){return e.getSignedUrls().getImageBitmap(t.path,t.width,t.height,t.options)},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(n,o||[])).next())}));var n,o,r,i}))})),e.addCommandCreator({namespace:"Scene",name:"getImage",args:["path","width","height","options"]},(e=>new On(e)))}(e,It,new kn(Ze)),function(e,t,n){t.addBinding(An,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();return t.deserialize((()=>t.createNode()),e.text)},new((r=void 0)||(r=Promise))((function(e,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"deserialize",args:["text"]},(e=>new An(e)))}(e,It,new kn(dt)),function(e,t,n){t.addBinding(Dn,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();t.serialize(t.supportedSerializerVersions.V_1_0,e.objects)},new((r=void 0)||(r=Promise))((function(e,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"serialize",args:["objects"]},(e=>new Dn(e)))}(e,It,new kn(dt)),function(e,t,n){t.addBinding(Pn,(e=>{return t=this,o=void 0,i=function*(){if(!qe(e.count))throw Error("count is not a valid number");const[t]=yield n.getDependencies(),o=[];for(let n=0;n<e.count;n++)o.push(t.createNode());return o},new((r=void 0)||(r=Promise))((function(e,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"createNodes",args:["count","userContext"]},(e=>new Pn(e)))}(e,It,new kn(dt)),function(e,t,n){t.addBinding(Mn,(e=>{return t=this,o=void 0,i=function*(){const[t]=yield n.getDependencies();if(!Array.isArray(e.components))throw Error("components must be an array");for(const n of e.components)t.registerFactory(n.name,n.factory)},new((r=void 0)||(r=Promise))((function(e,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,o||[])).next())}));var t,o,r,i})),e.addCommandCreator({namespace:"Scene",name:"registerComponents",args:["components"]},(e=>new Mn(e)))}(e,It,new kn(dt)),function(e,t,n){const o=new Map,r=new Map;return function(i,s){!function(e,t,n,o){const r=new Map,i=te.create(new kn(t,n),new E(jn)),s=te.create(new kn(t,r),new E(qn)),a=te.create(kn.extend(o,t),new E(Rn));e.addCommand("Sensor.addSource",i),e.addCommand("sensor.dispose",s),e.addCommand("sensor.showDebug",a);const c={[Ln.CAMERA]:new Fn},d=te.create(kn.extend(o,t,r),new E(zn,e,c));e.addCommandToInterface(Object.assign({},Gn),d),e.addEnumToInterface({namespace:"Sensor",name:"SensorType",values:Ln})}(i,o,r,s),function(e,t,n,o,r){const i=new kn(t),s={[o.SPHERE]:new ro,[o.BOX]:new io,[o.CYLINDER]:new so},a=te.create(i,new E(oo,s));e.addCommand("Sensor.updateSource",a);const c={[$n.SPHERE]:new eo(o,r.sphere,n),[$n.BOX]:new to(o,r.box,n),[$n.CYLINDER]:new no(o,r.cylinder,n)},d=te.create(i,new E(Jn,c));e.addCommandToInterface(Object.assign({},Wn),d),e.addEnumToInterface({namespace:"Sensor",name:"SourceType",values:$n})}(i,r,e,t,n)}}(x,n.SourceType,n.sensorVolumes)(e,new kn(pt)),function(e,t,n,o){n.addBinding(t.SettingGetCommand,(e=>{return t=this,n=void 0,i=function*(){const[t]=yield o.getDependencies();return t.tryGetProperty(e.key,void 0)},new((r=void 0)||(r=Promise))((function(e,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}));var t,n,r,i})),e.addCommandCreator({namespace:"Settings",name:"get",args:["key"]},(e=>new t.SettingGetCommand(e.key)))}(e,n,It,new kn(mt)),function(e,t,n,o){n.addBinding(t.SettingUpdateCommand,(e=>{return t=this,n=void 0,i=function*(){if(!e.key||"string"!=typeof e.key)throw Error("Settings: invalid key");const[t]=yield o.getDependencies();return t.updateSetting(e.key,e.value),t.tryGetProperty(e.key,void 0)},new((r=void 0)||(r=Promise))((function(e,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}));var t,n,r,i})),e.addCommandCreator({namespace:"Settings",name:"update",args:["key","value"]},(e=>new t.SettingUpdateCommand(e.key,e.value)))}(e,n,It,new kn(mt)),function(e,t,n){n.getDependencies().then((([n])=>{new co(t.waitForUpdate,n).calcAndBroadcast(e)})),e.addEnumToInterface({namespace:"Stat",name:"Event",values:ao})}(e,It,new kn(re)),function(e){e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:r}),e.addEnumToInterface({namespace:"Sweep",name:"Alignment",values:i}),e.addEnumToInterface({namespace:"Sweep",name:"Placement",values:s})}(e),function(e,t,n,o){const r=T.create(o,new lo,new E(po,t,n));e.addObservableToInterface({namespace:"Sweep",name:"current"},r)}(e,n,It,new kn(ie,be,U)),function(e,t,n){let o,r;e.addEnumToInterface({namespace:"Sweep",name:"Event",values:uo});const i=["",""],s=()=>(i[0]=o,i[1]=r,i);n.subscribe(t.BeginMoveToSweepMessage,(t=>{t.fromSweep&&t.fromSweep!==t.toSweep&&(r=t.toSweep,e.broadcast(uo.EXIT,s,t))})),n.subscribe(t.BeginSwitchViewmodeMessage,(n=>{n.fromMode===t.Viewmode.Panorama&&n.toMode!==t.Viewmode.Panorama&&(r=void 0,e.broadcast(uo.EXIT,s,n))}));const a=["",""],c=e=>(a[0]=e.fromSweep,a[1]=e.toSweep,a);n.subscribe(t.EndMoveToSweepMessage,(t=>{o=t.toSweep,e.broadcast(uo.ENTER,c,t)}))}(e,n,It),function(e,t,n,o){const i=te.create(o,new E(fo,t,n));e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:r}),e.addCommandToInterface({namespace:"Sweep",name:"moveTo",args:["sweep","options"]},i)}(e,n,It,new kn(ie)),function(e,t,n){const o=we.create(n,new go,new E(wo,t.conversionUtils,t.sweepPlacementConverter));e.addCollectionToInterface({namespace:"Sweep",name:"data"},o)}(e,It,new kn(ie,U)),function(e,t){const n=te.create(t,new E(yo)),o=te.create(t,new E(To));e.addCommandToInterface({namespace:"Sweep",name:"enable",args:["sweepIds"],varArg:!0},n),e.addCommandToInterface({namespace:"Sweep",name:"disable",args:["sweepIds"],varArg:!0},o)}(e,new kn(ie,se)),function(e,t,n){e.addEnumToInterface({namespace:"Tour",name:"Event",values:mo}),n.subscribe(t.TourStartedMessage,(()=>e.broadcast(mo.STARTED))),n.subscribe(t.TourStoppedMessage,(()=>e.broadcast(mo.STOPPED))),n.subscribe(t.TourEndedMessage,(()=>e.broadcast(mo.ENDED)));const o=[-1],r=e=>(o[0]=e.index,o);n.subscribe(t.TourSteppedMessage,(t=>e.broadcast(mo.STEPPED,r,t)))}(e,n,It),function(e,t,n,o){!function(e,t,n){t.addBinding(Do,(()=>Ao(this,void 0,void 0,(function*(){return n.getDependencies().then((([n,o])=>Ao(this,void 0,void 0,(function*(){const n=yield Promise.all(o.getEnabledSnapshots().map((n=>function(e,t,n){return Ao(this,void 0,void 0,(function*(){let o=n.viewmodeConverter.toSdk(e.metadata.cameraMode);if(!o||o===n.commandModeConverter.toSdk(t.CommandViewmode.TRANSITIONING))throw Error("Failed to convert snapshot, invalid viewmode");return o===n.commandModeConverter.toSdk(t.CommandViewmode.INSIDE)&&e.is360&&(o=n.commandModeConverter.toSdk(t.CommandViewmode.OUTSIDE)),{sid:e.sid,thumbnailUrl:yield e.thumbnailUrl.get(),imageUrl:yield e.imageUrl.get(),is360:e.is360,name:e.name,mode:o,zoom:e.metadata.ssZoom,position:e.metadata.cameraPosition,rotation:n.conversionUtils.quaternionToRotation(e.metadata.cameraQuaternion)}}))}(n,e,t))));if(0===n.length)throw Error("No tour data found");return n}))))}))))}(t,n,o),e.addCommandCreator({namespace:"Tour",name:"getData",args:[]},(()=>new Do));const r=o,i=te.create(r,new E(bo)),s=te.create(r,new E(xo)),a=te.create(r,new E(No)),c=te.create(r,new E(Oo,!0)),d=te.create(r,new E(Oo,!1));e.addCommandToInterface({namespace:"Tour",name:"start",args:["index"]},i),e.addCommandToInterface({namespace:"Tour",name:"stop",args:[]},s),e.addCommandToInterface({namespace:"Tour",name:"step",args:["index"]},a),e.addCommandToInterface({namespace:"Tour",name:"prev",args:[]},c),e.addCommandToInterface({namespace:"Tour",name:"next",args:[]},d)}(e,n,It,new kn(ft,ue))}},331:function(e,t){"use strict";var n,o;t.gO=t.eE=t.ru=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(n=t.ru||(t.ru={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(o=t.eE||(t.eE={}));var r=function(){function e(e){var t=void 0===e?{}:e,n=t.retries,o=void 0===n?3:n,r=t.concurrency,i=void 0===r?6:r;this.totalBytesDownloaded=0,this.queue=[],this.retries=o,this.concurrency=i}return e.prototype.get=function(e,t){return this.request("GET",e,t)},e.prototype.head=function(e,t){return this.request("HEAD",e,t)},e.prototype.options=function(e,t){return this.request("OPTIONS",e,t)},e.prototype.post=function(e,t){return this.request("POST",e,t)},e.prototype.put=function(e,t){return this.request("PUT",e,t)},e.prototype.patch=function(e,t){return this.request("PATCH",e,t)},e.prototype.delete=function(e,t){return this.request("DELETE",e,t)},e.prototype.request=function(e,t,n){var o=new i(e,t,n);return this.enqueue(o),o.promise},e.prototype.update=function(){for(var e;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=o.PENDING;this.updateTimeout=null},e.prototype.enqueue=function(e){var t=this,n=0;for(n=0;n<this.queue.length&&!(this.queue[n].priority<e.priority);n++);this.queue.splice(n,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((function(){t.update()}),1))},e.prototype.dequeue=function(e){var t=this.queue.indexOf(e);if(-1===t)throw new Error("Can't dequeue request not in queue");this.queue.splice(t,1),this.update()},e.prototype.getNextPendingRequest=function(){for(var e=0;e<this.queue.length&&e<this.concurrency;e++){var t=this.queue[e];if(t.status===o.PENDING)return t}return null},e.prototype.getNextOverflowingGet=function(){for(var e=this.concurrency;e<this.queue.length;e++){var t=this.queue[e];if(t.status===o.SENDING&&t.priority!==n.HIGHEST&&"GET"===t.method)return t}return null},e.prototype.shouldRetryStatusCode=function(t){return!e.doNotRetryStatusCodes[t]},e.prototype.sendRequest=function(e){var t=this;e.status=o.SENDING,e.send().then((function(n){e.status=o.DONE,t.dequeue(e),e.contentLength&&e.contentLength>0&&(t.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(n)})).catch((function(n){var r=null!==e.maxRetries?e.maxRetries:t.retries,i=e.sendAttempts<r;if("object"==typeof n){var s=n.status_code||0;i=i&&t.shouldRetryStatusCode(s)}i?(e.status=o.PENDING,t.update(),console.warn("Retried "+e.url),console.warn(n)):(e.status=o.FAILED,t.dequeue(e),console.warn("Failed "+e.url),e.onFail(n))}))},e.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0},e}();t.gO=r;var i=function(){function e(e,t,r){var i=this;void 0===r&&(r={}),this.sendAttempts=0,this.status=o.PENDING,this.contentLength=0,this.url=t,this.method=e,this.auth=r.auth||null,this.withCredentials=r.withCredentials||!1,this.priority=r.priority||n.MEDIUM,this.responseType=r.responseType||null,this.body=r.body||null,this.headers=r.headers||{},this.maxRetries=r.maxRetries||null,this.onProgress=r.onProgress,this.promise=new Promise((function(e,t){i.onDone=e,i.onFail=t}))}return e.prototype.send=function(){var e=this,t=this.xhr=function(e,t,n){var o;if("undefined"!=typeof XMLHttpRequest)(o=new XMLHttpRequest).withCredentials=n;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");o=new XDomainRequest}return o.open(e,t,!0),o}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)t.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');t.responseType="blob"}for(var n in"json"===this.responseType&&t.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&t.setRequestHeader("Authorization",this.auth),this.headers)t.setRequestHeader(n,this.headers[n]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),t.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(t.onprogress=this.onProgress),new Promise((function(n,o){t.onreadystatechange=function(r){if(4===t.readyState){if(200===t.status||201===t.status||204===t.status)return e.parseResponse(e.xhr).then((function(e){n(e)}));0!==t.status&&o({status_code:t.status})}},t.onerror=function(e){o(e)},t.send(e.body),e.sendAttempts++}))},e.prototype.parseResponse=function(e){var t=this;return new Promise((function(n,o){try{var r=e.response;if(t.contentLength=e.getResponseHeader("Content-Length"),"json"===t.responseType&&"object"!=typeof r)n(JSON.parse(e.responseText));else if("image"===t.responseType){var i=URL.createObjectURL(r);(r=new Image).src=i,r.crossOrigin="Anonymous",r.onload=function(){URL.revokeObjectURL(i),n(r)}}else n(r)}catch(e){o({error:"Payload was not valid JSON"})}}))},e.prototype.abort=function(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.xhr.abort()},e}()}},t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}return n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(371)}());